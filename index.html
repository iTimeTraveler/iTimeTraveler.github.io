<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iTimeTraveler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta name="description" content="Someone knock at the door.">
<meta property="og:type" content="website">
<meta property="og:title" content="iTimeTraveler">
<meta property="og:url" content="http://github.com/index.html">
<meta property="og:site_name" content="iTimeTraveler">
<meta property="og:description" content="Someone knock at the door.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iTimeTraveler">
<meta name="twitter:description" content="Someone knock at the door.">
  
    <link rel="alternate" href="/atom.xml" title="iTimeTraveler" type="application/atom+xml">
  

  

  <link rel="icon" href="/gallery/avatar/0.jpg">
  <link rel="apple-touch-icon" href="/gallery/avatar/0.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="css/style.css">

  <script src="js/jquery-3.1.1.min.js"></script>
  <script src="js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body>


  
    <header id="header">

	<!-- èƒŒæ™¯å›¾æ¨¡å¼ -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="https://source.unsplash.com/collection/954550/1920x1080">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="https://source.unsplash.com/collection/954550/1920x1081">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="https://source.unsplash.com/collection/954550/1921x1080">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img3" src="https://source.unsplash.com/collection/954550/1921x1081">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img3 = new Image();
                      var imageTag3 = document.getElementById("carousel-img3");
                      img3.src = imageTag3.src;
                      img3.onload=function(){
                        if (img3.width / img3.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag3.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag3.style.height = document.body.clientHeight + "px";
                          imageTag3.style.marginLeft = -(document.body.clientHeight * img3.width / img3.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img4" src="https://source.unsplash.com/collection/954550/1920x1082">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img4 = new Image();
                      var imageTag4 = document.getElementById("carousel-img4");
                      img4.src = imageTag4.src;
                      img4.onload=function(){
                        if (img4.width / img4.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag4.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag4.style.height = document.body.clientHeight + "px";
                          imageTag4.style.marginLeft = -(document.body.clientHeight * img4.width / img4.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img5" src="https://source.unsplash.com/collection/954550/1922x1080">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img5 = new Image();
                      var imageTag5 = document.getElementById("carousel-img5");
                      img5.src = imageTag5.src;
                      img5.onload=function(){
                        if (img5.width / img5.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag5.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag5.style.height = document.body.clientHeight + "px";
                          imageTag5.style.marginLeft = -(document.body.clientHeight * img5.width / img5.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img6" src="https://source.unsplash.com/collection/954550/1922x1082">
                  </div>

                  <!-- è‡ªé€‚åº”å¤§å›¾ -->
                  <script>
                      var img6 = new Image();
                      var imageTag6 = document.getElementById("carousel-img6");
                      img6.src = imageTag6.src;
                      img6.onload=function(){
                        if (img6.width / img6.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag6.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag6.style.height = document.body.clientHeight + "px";
                          imageTag6.style.marginLeft = -(document.body.clientHeight * img6.width / img6.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">Ä°leri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- æŠ˜çº¿PolylineèƒŒæ™¯ -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">iTimeTraveler</a></h1>
            <h3>Someone knock at the door.</h3>
            <h5>Mr.Seven</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- è‡ªé€‚åº”ä¸»é¡µèƒŒæ™¯å¤§å›¾ -->
  

 <!-- home_logo_imageå±…ä¸­ -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="index.html">é¦–é¡µ</a>
        
          <a id="beautifont" class="main-nav-link" href="archives">å½’æ¡£</a>
        
          <a id="beautifont" class="main-nav-link" href="categories">åˆ†ç±»</a>
        
          <a id="beautifont" class="main-nav-link" href="tags">æ ‡ç­¾</a>
        
          <a id="beautifont" class="main-nav-link" href="funnysite">é…·ç«™</a>
        
          <a id="beautifont" class="main-nav-link" href="collection">æ”¶è—</a>
        
          <a id="beautifont" class="main-nav-link" href="about">å…³äº</a>
        
          <a id="beautifont" class="main-nav-link" href="/mybooks">ğŸ</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-ã€Javaã€‘NIOçš„æŠ€æœ¯åˆ†äº«"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/05/17/ã€Javaã€‘NIOçš„æŠ€æœ¯åˆ†äº«/">ã€Javaã€‘NIOæŠ€æœ¯åˆ†äº«</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/05/17/ã€Javaã€‘NIOçš„æŠ€æœ¯åˆ†äº«/" class="article-date">
	  <time datetime="2018-05-17T14:20:55.000Z" itemprop="datePublished">2018-05-17</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Java-NIOæŠ€æœ¯åˆ†äº«"><a href="#Java-NIOæŠ€æœ¯åˆ†äº«" class="headerlink" title="Java NIOæŠ€æœ¯åˆ†äº«"></a>Java NIOæŠ€æœ¯åˆ†äº«</h1><h2 id="IO-åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡"><a href="#IO-åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡" class="headerlink" title="IO - åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡"></a>IO - åŒæ­¥ã€å¼‚æ­¥ã€é˜»å¡ã€éé˜»å¡</h2><p>æœ¬æ–‡è®¨è®ºçš„èƒŒæ™¯æ˜¯Linuxç¯å¢ƒä¸‹çš„network IOã€‚åŒæ­¥ï¼ˆSynchronousï¼‰ IOå’Œå¼‚æ­¥ï¼ˆAsynchronousï¼‰ IOï¼Œé˜»å¡ï¼ˆBlockingï¼‰ IOå’Œéé˜»å¡ï¼ˆNon-Blockingï¼‰IOåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>Richard Stevensçš„ã€Š<strong>UNIXÂ® Network Programming Volume 1, Third Edition: The Sockets Networking</strong> ã€‹ä¹¦ä¸­ï¼Œ6.2èŠ‚â€œ<strong>I/O Models</strong> â€ï¼ŒStevensåœ¨è¿™èŠ‚ä¸­è¯¦ç»†è¯´æ˜äº†å„ç§IOçš„ç‰¹ç‚¹å’ŒåŒºåˆ«ã€‚</p>
<p>Stevensåœ¨æ–‡ç« ä¸­ä¸€å…±æ¯”è¾ƒäº†äº”ç§IO Modelï¼š</p>
<ul>
<li>[1] blocking IO - é˜»å¡IO</li>
<li>[2] nonblocking IO - éé˜»å¡IO</li>
<li>[3] IO multiplexing - IOå¤šè·¯å¤ç”¨</li>
<li>[4] signal driven IO - ä¿¡å·é©±åŠ¨IO</li>
<li>[5] asynchronous IO - å¼‚æ­¥IO</li>
</ul>
<p>å…¶ä¸­å‰é¢4ç§IOéƒ½å¯ä»¥å½’ç±»ä¸ºsynchronous IO - åŒæ­¥IOã€‚ç”±äºsignal driven IOåœ¨å®é™…ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥æˆ‘è¿™åªæåŠå‰©ä¸‹çš„å››ç§IO Modelã€‚</p>
<p>ä¸‹é¢ä»¥network IOä¸­çš„readè¯»æ“ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œæ¥è®²è¿°åŒæ­¥ï¼ˆsynchronousï¼‰ IOå’Œå¼‚æ­¥ï¼ˆasynchronousï¼‰ IOã€é˜»å¡ï¼ˆblockingï¼‰ IOå’Œéé˜»å¡ï¼ˆnon-blockingï¼‰IOçš„å¼‚åŒã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¬¡ç½‘ç»œIOè¯»æ“ä½œä¼šæ¶‰åŠä¸¤ä¸ªç³»ç»Ÿå¯¹è±¡ï¼š(1) ç”¨æˆ·è¿›ç¨‹(çº¿ç¨‹)Processï¼›(2)å†…æ ¸å¯¹è±¡kernelï¼Œä¸¤ä¸ªå¤„ç†é˜¶æ®µï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] Waiting <span class="keyword">for</span> the data to be ready - ç­‰å¾…æ•°æ®å‡†å¤‡å¥½</span><br><span class="line">[<span class="number">2</span>] Copying the data <span class="keyword">from</span> the kernel to the process - å°†æ•°æ®ä»å†…æ ¸ç©ºé—´çš„bufferæ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿›ç¨‹çš„buffer</span><br></pre></td></tr></table></figure>
<p>IOæ¨¡å‹çš„å¼‚åŒç‚¹å°±æ˜¯åŒºåˆ†åœ¨è¿™ä¸¤ä¸ªç³»ç»Ÿå¯¹è±¡ã€ä¸¤ä¸ªå¤„ç†é˜¶æ®µçš„ä¸åŒä¸Šã€‚</p>
<h3 id="1-åŒæ­¥IO-ä¹‹-Blocking-IO"><a href="#1-åŒæ­¥IO-ä¹‹-Blocking-IO" class="headerlink" title="1. åŒæ­¥IO ä¹‹ Blocking IO"></a>1. åŒæ­¥IO ä¹‹ Blocking IO</h3><p><img src="https://itimetraveler.github.io/gallery/java-common/blocking-io.png" alt=""></p>
<p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ï¼ˆå¯¹äºç½‘ç»œIOæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ã€‚æ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ã€‚è¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­æ˜¯éœ€è¦ä¸€ä¸ªè¿‡ç¨‹çš„ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p>
<blockquote>
<p>æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚</p>
</blockquote>
<h3 id="2-åŒæ­¥IO-ä¹‹-NonBlocking-IO"><a href="#2-åŒæ­¥IO-ä¹‹-NonBlocking-IO" class="headerlink" title="2. åŒæ­¥IO ä¹‹ NonBlocking IO"></a>2. åŒæ­¥IO ä¹‹ NonBlocking IO</h3><p><img src="https://itimetraveler.github.io/gallery/java-common/nonblocking-io.png" alt=""></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œprocessåœ¨NonBlocking IOè¯»recvfromæ“ä½œçš„ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯ä¸ä¼šblockç­‰å¾…çš„ï¼Œå¦‚æœkernelæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆrecvfromä¼šç«‹åˆ»è¿”å›ä¸€ä¸ªEWOULDBLOCKé”™è¯¯ã€‚å½“kernelå‡†å¤‡å¥½æ•°æ®åï¼Œè¿›å…¥å¤„ç†çš„ç¬¬äºŒé˜¶æ®µçš„æ—¶å€™ï¼Œprocessä¼šç­‰å¾…kernelå°†æ•°æ®copyåˆ°è‡ªå·±çš„bufferï¼Œåœ¨kernelå®Œæˆæ•°æ®çš„copyåprocessæ‰ä¼šä»recvfromç³»ç»Ÿè°ƒç”¨ä¸­è¿”å›ã€‚</p>
<blockquote>
<p>æ‰€ä»¥ï¼Œnonblocking IOçš„ç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹éœ€è¦<strong>ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®</strong>kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚</p>
</blockquote>
<h3 id="3-åŒæ­¥IO-ä¹‹-IO-multiplexing"><a href="#3-åŒæ­¥IO-ä¹‹-IO-multiplexing" class="headerlink" title="3. åŒæ­¥IO ä¹‹ IO multiplexing"></a>3. åŒæ­¥IO ä¹‹ IO multiplexing</h3><p>IOå¤šè·¯å¤ç”¨ï¼Œå°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„selectã€pollã€epollæ¨¡å‹ã€‚ä»ä¸‹å›¾å¯è§ï¼Œåœ¨IOå¤šè·¯å¤ç”¨çš„æ—¶å€™ï¼Œprocessåœ¨ä¸¤ä¸ªå¤„ç†é˜¶æ®µéƒ½æ˜¯blockä½ç­‰å¾…çš„ã€‚åˆçœ‹å¥½åƒIOå¤šè·¯å¤ç”¨æ²¡ä»€ä¹ˆç”¨ï¼Œå…¶å®selectã€pollã€epollçš„ä¼˜åŠ¿åœ¨äºå¯ä»¥ä»¥è¾ƒå°‘çš„ä»£ä»·æ¥åŒæ—¶ç›‘å¬å¤„ç†å¤šä¸ªIOã€‚åœ¨äºä½¿ç”¨å•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOã€‚å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯selectï¼Œpollï¼Œepollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹</p>
<p><img src="https://itimetraveler.github.io/gallery/java-common/io-multiplexing.png" alt=""></p>
<p><code>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«block</code>ï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚ã€‚</p>
<blockquote>
<p>æ‰€ä»¥ï¼ŒI/O å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselect()å‡½æ•°å°±å¯ä»¥è¿”å›ã€‚</p>
</blockquote>
<p>è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (<strong>select</strong> å’Œ <strong>recvfrom</strong>)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (<strong>recvfrom</strong>)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚ï¼‰</p>
<p>åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚</p>
<h3 id="4-å¼‚æ­¥IO"><a href="#4-å¼‚æ­¥IO" class="headerlink" title="4. å¼‚æ­¥IO"></a>4. å¼‚æ­¥IO</h3><p><img src="https://itimetraveler.github.io/gallery/java-common/asynchronus-io.png" alt=""></p>
<p>ä»ä¸Šå›¾çœ‹å‡ºï¼Œå¼‚æ­¥IOè¦æ±‚ç”¨æˆ·è¿›ç¨‹åœ¨<strong>aio_read</strong>æ“ä½œçš„ä¸¤ä¸ªå¤„ç†é˜¶æ®µä¸Šéƒ½ä¸èƒ½ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è¿›ç¨‹è°ƒç”¨aio_readåç«‹åˆ»è¿”å›ï¼Œkernelè‡ªè¡Œå»å‡†å¤‡å¥½æ•°æ®å¹¶å°†æ•°æ®ä»kernelçš„bufferä¸­copyåˆ°ç”¨æˆ·è¿›ç¨‹çš„bufferåœ¨é€šçŸ¥ç”¨æˆ·è¿›ç¨‹è¯»æ“ä½œå®Œæˆäº†ï¼Œç„¶åä¼šå‘é€ä¸€ä¸ªsignalé€šçŸ¥ç”¨æˆ·è¿›ç¨‹å»ç»§ç»­å¤„ç†ã€‚é—æ†¾çš„æ˜¯ï¼Œlinuxçš„ç½‘ç»œIOä¸­æ˜¯ä¸å­˜åœ¨å¼‚æ­¥IOçš„ï¼Œlinuxçš„ç½‘ç»œIOå¤„ç†çš„ç¬¬äºŒé˜¶æ®µæ€»æ˜¯é˜»å¡ç­‰å¾…æ•°æ®copyå®Œæˆçš„ã€‚çœŸæ­£æ„ä¹‰ä¸Šçš„ç½‘ç»œå¼‚æ­¥IOæ˜¯Windowsä¸‹çš„IOCPï¼ˆIOå®Œæˆç«¯å£ï¼‰æ¨¡å‹ã€‚</p>
<blockquote>
<p>æ‰€ä»¥ï¼Œasynchronous IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½<strong>ä¸ä¼šè¢«block</strong>ã€‚</p>
</blockquote>
<p>å„ä¸ªIO Modelçš„æ¯”è¾ƒå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://itimetraveler.github.io/gallery/java-common/compare.png" alt=""></p>
<p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“æ··æ·†non-blocking IOå’Œasynchronous IOï¼Œè®¤ä¸ºæ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯é€šè¿‡ä¸Šå›¾ï¼Œå‡ ç§IOæ¨¡å‹çš„æ¯”è¾ƒï¼Œä¼šå‘ç°non-blocking IOå’Œasynchronous IOçš„åŒºåˆ«è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œnon-blocking IOä»…ä»…è¦æ±‚å¤„ç†çš„ç¬¬ä¸€é˜¶æ®µä¸blockå³å¯ï¼Œä½†æ˜¯å®ƒä»ç„¶è¦æ±‚è¿›ç¨‹å»ä¸»åŠ¨çš„checkï¼Œå¹¶ä¸”å½“æ•°æ®å‡†å¤‡å®Œæˆä»¥åï¼Œä¹Ÿéœ€è¦è¿›ç¨‹ä¸»åŠ¨çš„å†æ¬¡è°ƒç”¨recvfromæ¥å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ã€‚è€Œasynchronous IOè¦æ±‚ä¸¤ä¸ªé˜¶æ®µéƒ½ä¸èƒ½blockä½ã€‚ç”¨æˆ·è¿›ç¨‹å°†æ•´ä¸ªIOæ“ä½œäº¤ç»™äº†kernelç³»ç»Ÿè°ƒç”¨å»å®Œæˆï¼Œç„¶åkernelåšå®Œåå‘ä¿¡å·é€šçŸ¥ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·è¿›ç¨‹ä¸éœ€è¦å»æ£€æŸ¥IOæ“ä½œçš„çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦ä¸»åŠ¨çš„å»æ‹·è´æ•°æ®ã€‚</p>
<h2 id="I-O-å¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£"><a href="#I-O-å¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£" class="headerlink" title="I/O å¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£"></a>I/O å¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£</h2><p>selectï¼Œpollï¼Œepollä¸‰ä¸ªéƒ½æ˜¯Linuxçš„IOå¤šè·¯å¤ç”¨çš„æœºåˆ¶ï¼Œå¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦çš„è¯»/å†™ç­‰äº‹ä»¶ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»æˆ–è€…å†™äº‹ä»¶å‘ç”Ÿäº†ï¼‰ï¼Œå°±èƒ½å¤Ÿå°†å‘ç”Ÿçš„äº‹ä»¶é€šçŸ¥ç»™å…³å¿ƒçš„åº”ç”¨ç¨‹åºå»å¤„ç†è¯¥äº‹ä»¶ã€‚ä½†æœ¬è´¨ä¸Šï¼Œ<code>select</code>ã€<code>poll</code>ã€<code>epoll</code>æœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oã€‚å› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œè€Œå¼‚æ­¥I/Oåˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥I/Oçš„å®ç°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚å‚è€ƒæ–‡ç« ï¼š<a href="https://segmentfault.com/a/1190000003063859" target="_blank" rel="noopener">Linux IOæ¨¡å¼åŠ selectã€pollã€epollè¯¦è§£</a></p>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span> <span class="params">(<span class="keyword">int</span> n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure>
<p>select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°ç¬¦å°±ç»ªï¼ˆæœ‰æ•°æ®å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥ é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚</p>
<p>selectç›®å‰å‡ ä¹åœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒï¼Œå…¶è‰¯å¥½è·¨å¹³å°æ”¯æŒä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹ã€‚<strong>selectçš„ä¸€ä¸ªç¼ºç‚¹åœ¨äºå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œåœ¨Linuxä¸Šä¸€èˆ¬ä¸º1024</strong>ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æå‡è¿™ä¸€é™åˆ¶ï¼Œä½†æ˜¯è¿™æ ·ä¹Ÿä¼šé€ æˆæ•ˆç‡çš„é™ä½ã€‚</p>
<p>selectçš„æœ¬è´¨æ˜¯é‡‡ç”¨32ä¸ªæ•´æ•°çš„32ä½ï¼Œå³32*32=1024æ¥æ ‡è¯†ï¼Œfdå€¼ä¸º1-1024ã€‚å½“fdçš„å€¼è¶…è¿‡1024é™åˆ¶æ—¶ï¼Œå°±å¿…é¡»ä¿®æ”¹<code>FD_SETSIZE</code>çš„å¤§å°ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ ‡è¯†32*maxå€¼èŒƒå›´çš„fdã€‚</p>
<p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">true</span> &#123;</span><br><span class="line">    select(streams[])</span><br><span class="line">    <span class="keyword">for</span> i in streams[] &#123;</span><br><span class="line">        <span class="keyword">if</span> i has data</span><br><span class="line">        read until unavailable</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ï¼Œå¦‚æœæ²¡æœ‰I/Oäº‹ä»¶äº§ç”Ÿï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±ä¼šé˜»å¡åœ¨selectå¤„ã€‚ä½†æ˜¯æˆ‘ä»¬ä»selecté‚£é‡Œä»…ä»…çŸ¥é“äº†ï¼Œæœ‰I/Oäº‹ä»¶å‘ç”Ÿäº†ï¼Œä½†å´å¹¶ä¸çŸ¥é“æ˜¯é‚£å‡ ä¸ªæµï¼ˆå¯èƒ½æœ‰ä¸€ä¸ªï¼Œå¤šä¸ªï¼Œç”šè‡³å…¨éƒ¨ï¼‰ï¼Œæˆ‘ä»¬åªèƒ½æ— å·®åˆ«è½®è¯¢æ‰€æœ‰æµï¼Œæ‰¾å‡ºèƒ½è¯»å‡ºæ•°æ®ï¼Œæˆ–è€…å†™å…¥æ•°æ®çš„æµï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬æœ‰O(n)çš„æ— å·®åˆ«è½®è¯¢å¤æ‚åº¦ï¼ŒåŒæ—¶å¤„ç†çš„æµè¶Šå¤šï¼Œæ¯ä¸€æ¬¡æ— å·®åˆ«è½®è¯¢æ—¶é—´å°±è¶Šé•¿ã€‚</p>
<h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">poll</span> <span class="params">(struct pollfd *fds, <span class="keyword">unsigned</span> <span class="keyword">int</span> nfds, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure>
<p>ä¸åŒä¸selectä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ªfdsetçš„æ–¹å¼ï¼Œpollä½¿ç”¨ä¸€ä¸ª pollfdçš„æŒ‡é’ˆå®ç°ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> fd; <span class="comment">/* file descriptor */</span></span><br><span class="line">    <span class="keyword">short</span> events; <span class="comment">/* requested events to watch */</span></span><br><span class="line">    <span class="keyword">short</span> revents; <span class="comment">/* returned events witnessed */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>pollfdç»“æ„åŒ…å«äº†è¦ç›‘è§†çš„eventå’Œå‘ç”Ÿçš„eventï¼Œä¸å†ä½¿ç”¨selectâ€œå‚æ•°-å€¼â€ä¼ é€’çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œpollfdå¹¶æ²¡æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆä½†æ˜¯æ•°é‡è¿‡å¤§åæ€§èƒ½ä¹Ÿæ˜¯ä¼šä¸‹é™ï¼‰ã€‚ å’Œselectå‡½æ•°ä¸€æ ·ï¼Œpollè¿”å›åï¼Œéœ€è¦è½®è¯¢pollfdæ¥è·å–å°±ç»ªçš„æè¿°ç¬¦ã€‚</p>
<p>pollä¸selectä¸åŒï¼Œé€šè¿‡ä¸€ä¸ªpollfdæ•°ç»„å‘å†…æ ¸ä¼ é€’éœ€è¦å…³æ³¨çš„äº‹ä»¶ï¼Œæ•…æ²¡æœ‰æè¿°ç¬¦ä¸ªæ•°çš„é™åˆ¶ï¼Œpollfdä¸­çš„eventså­—æ®µå’Œreventsåˆ†åˆ«ç”¨äºæ ‡ç¤ºå…³æ³¨çš„äº‹ä»¶å’Œå‘ç”Ÿçš„äº‹ä»¶ï¼Œæ•…pollfdæ•°ç»„åªéœ€è¦è¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚</p>
<blockquote>
<p>ä»ä¸Šé¢çœ‹ï¼Œselectå’Œpolléƒ½éœ€è¦åœ¨è¿”å›åï¼Œ<code>é€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²ç»å°±ç»ªçš„socket</code>ã€‚äº‹å®ä¸Šï¼ŒåŒæ—¶è¿æ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢é•¿ï¼Œå…¶æ•ˆç‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™ã€‚</p>
</blockquote>
<h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><p>epollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpollçš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äºselectå’Œpollæ¥è¯´ï¼Œepollæ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³å¿ƒçš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€ä¸€æ¬¡ã€‚</p>
<h4 id="epollæ“ä½œè¿‡ç¨‹"><a href="#epollæ“ä½œè¿‡ç¨‹" class="headerlink" title="epollæ“ä½œè¿‡ç¨‹"></a>epollæ“ä½œè¿‡ç¨‹</h4><p>epollæ“ä½œè¿‡ç¨‹éœ€è¦ä¸‰ä¸ªæ¥å£ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int epoll_create(int size)ï¼›//åˆ›å»ºä¸€ä¸ªepollçš„fdå¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§</span><br><span class="line">int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event * events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure>
<p><strong>1. int epoll_create(int size);</strong></p>
<p>åˆ›å»ºä¸€ä¸ªepollçš„fdæ–‡ä»¶æè¿°ç¬¦å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§ï¼Œè¿™ä¸ªå‚æ•°ä¸åŒäºselect()ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç»™å‡ºæœ€å¤§ç›‘å¬çš„fd+1çš„å€¼ï¼Œ<strong>å‚æ•°sizeå¹¶ä¸æ˜¯é™åˆ¶äº†epollæ‰€èƒ½ç›‘å¬çš„æè¿°ç¬¦æœ€å¤§ä¸ªæ•°ï¼Œåªæ˜¯å¯¹å†…æ ¸åˆå§‹åˆ†é…å†…éƒ¨æ•°æ®ç»“æ„çš„ä¸€ä¸ªå»ºè®®</strong>ã€‚å› ä¸ºåœ¨linux 2.6.8ä¹‹å‰çš„å†…æ ¸ï¼Œepollä½¿ç”¨hashæ¥ç»„ç»‡fdsé›†åˆï¼Œäºæ˜¯åœ¨åˆ›å»ºepoll fdçš„æ—¶å€™ï¼Œepolléœ€è¦åˆå§‹åŒ–hashçš„å¤§å°ã€‚äºæ˜¯<code>epoll_create(int size)</code>æœ‰ä¸€ä¸ªå‚æ•°sizeï¼Œä»¥ä¾¿å†…æ ¸æ ¹æ®sizeçš„å¤§å°æ¥åˆ†é…hashçš„å¤§å°ã€‚åœ¨linux 2.6.8ä»¥åçš„å†…æ ¸ä¸­ï¼Œepollä½¿ç”¨çº¢é»‘æ ‘æ¥ç»„ç»‡ç›‘æ§çš„fdsé›†åˆï¼Œäºæ˜¯<code>epoll_create(int size)</code>çš„å‚æ•°sizeå®é™…ä¸Šå·²ç»æ²¡æœ‰æ„ä¹‰äº†ã€‚<br>å½“åˆ›å»ºå¥½epollå¥æŸ„åï¼Œå®ƒå°±ä¼šå ç”¨ä¸€ä¸ªfdå€¼ï¼Œåœ¨linuxä¸‹å¦‚æœæŸ¥çœ‹<code>/proc/è¿›ç¨‹id/fd/</code>ï¼Œæ˜¯èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªfdçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®Œepollåï¼Œå¿…é¡»è°ƒç”¨<code>close()</code>å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´fdè¢«è€—å°½ã€‚</p>
<p><strong>2. int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›</strong></p>
<p>å‡½æ•°æ˜¯å¯¹æŒ‡å®šæè¿°ç¬¦fdæ‰§è¡Œopæ“ä½œã€‚<br>- epfdï¼šæ˜¯epoll_create()çš„è¿”å›å€¼ã€‚<br>- opï¼šè¡¨ç¤ºopæ“ä½œï¼Œç”¨ä¸‰ä¸ªå®æ¥è¡¨ç¤ºï¼šæ·»åŠ EPOLL_CTL_ADDï¼Œåˆ é™¤EPOLL_CTL_DELï¼Œä¿®æ”¹EPOLL_CTL_MODã€‚åˆ†åˆ«æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å¯¹fdçš„ç›‘å¬äº‹ä»¶ã€‚<br>- fdï¼šæ˜¯éœ€è¦ç›‘å¬çš„fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰<br>- epoll_eventï¼šæ˜¯å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘å¬ä»€ä¹ˆäº‹ï¼Œstruct epoll_eventç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> &#123;</span></span><br><span class="line">  <span class="keyword">__uint32_t</span> events;  <span class="comment">/* Epoll events */</span></span><br><span class="line">  <span class="keyword">epoll_data_t</span> data;  <span class="comment">/* User data variable */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eventså¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®çš„é›†åˆï¼š</span></span><br><span class="line">EPOLLIN ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»ï¼ˆåŒ…æ‹¬å¯¹ç«¯SOCKETæ­£å¸¸å…³é—­ï¼‰ï¼›</span><br><span class="line">EPOLLOUTï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™ï¼›</span><br><span class="line">EPOLLPRIï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆè¿™é‡Œåº”è¯¥è¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥ï¼‰ï¼›</span><br><span class="line">EPOLLERRï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ï¼›</span><br><span class="line">EPOLLHUPï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­ï¼›</span><br><span class="line">EPOLLETï¼š å°†EPOLLè®¾ä¸ºè¾¹ç¼˜è§¦å‘(Edge Triggered)æ¨¡å¼ï¼Œè¿™æ˜¯ç›¸å¯¹äºæ°´å¹³è§¦å‘(Level Triggered)æ¥è¯´çš„ã€‚</span><br><span class="line">EPOLLONESHOTï¼šåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹åï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œ</span><br></pre></td></tr></table></figure>
<p><strong>3. int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);</strong></p>
<p>ç­‰å¾…epfdä¸Šçš„ioäº‹ä»¶ï¼Œæœ€å¤šè¿”å›maxeventsä¸ªäº‹ä»¶ã€‚<br>å‚æ•°eventsç”¨æ¥ä»å†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆï¼Œmaxeventså‘ŠçŸ¥å†…æ ¸æœ€å¤šè¿”å›çš„eventsè¦å‡ ä¸ªï¼Œè¿™ä¸ªmaxeventsçš„å€¼ä¸èƒ½å¤§äºåˆ›å»ºepoll_create()æ—¶çš„sizeï¼Œå‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ0ä¼šç«‹å³è¿”å›ï¼Œ-1å°†ä¸ç¡®å®šï¼Œä¹Ÿæœ‰è¯´æ³•è¯´æ˜¯æ°¸ä¹…é˜»å¡ï¼‰ã€‚è¯¥å‡½æ•°è¿”å›éœ€è¦å¤„ç†çš„äº‹ä»¶æ•°ç›®ï¼Œå¦‚è¿”å›0è¡¨ç¤ºå·²è¶…æ—¶ã€‚</p>
<p>ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">true</span> &#123;</span><br><span class="line">    active_stream[] = epoll_wait(epollfd)</span><br><span class="line">    <span class="keyword">for</span> i in active_stream[] &#123;</span><br><span class="line">        read or write till</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>epollå¯ä»¥ç†è§£ä¸ºevent pollï¼Œä¸åŒäºå¿™è½®è¯¢å’Œæ— å·®åˆ«è½®è¯¢ï¼Œepollä¹‹ä¼šæŠŠå“ªä¸ªæµå‘ç”Ÿäº†æ€æ ·çš„I/Oäº‹ä»¶é€šçŸ¥æˆ‘ä»¬ã€‚æ­¤æ—¶æˆ‘ä»¬å¯¹è¿™äº›æµçš„æ“ä½œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚ï¼ˆå¤æ‚åº¦é™ä½åˆ°äº†O(1)æˆ–è€…O(k)ï¼‰</p>
<p>epollæ˜¯pollçš„ä¸€ç§ä¼˜åŒ–ï¼Œè¿”å›åä¸éœ€è¦å¯¹æ‰€æœ‰çš„fdè¿›è¡Œéå†ï¼Œåœ¨å†…æ ¸ä¸­ç»´æŒäº†fdçš„åˆ—è¡¨ã€‚selectå’Œpollæ˜¯å°†è¿™ä¸ªå†…æ ¸åˆ—è¡¨ç»´æŒåœ¨ç”¨æˆ·æ€ï¼Œç„¶åä¼ é€’åˆ°å†…æ ¸ä¸­ã€‚ä¸poll/selectä¸åŒï¼Œepollä¸å†æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯ç”±epoll_create / epoll_ctl / epoll_waitä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨ç»„æˆï¼Œåé¢å°†ä¼šçœ‹åˆ°è¿™æ ·åšçš„å¥½å¤„ã€‚epollåœ¨2.6ä»¥åçš„å†…æ ¸æ‰æ”¯æŒã€‚</p>
<h2 id="NIOçš„æ¦‚å¿µ"><a href="#NIOçš„æ¦‚å¿µ" class="headerlink" title="NIOçš„æ¦‚å¿µ"></a>NIOçš„æ¦‚å¿µ</h2><p>æˆ‘ä»¬å¹³å¸¸è¯´çš„æ™®é€šçš„Java IOå°±æ˜¯é˜»å¡I/Oæ¨¡å¼ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªæµçš„I/Oäº‹ä»¶ã€‚å¦‚æœæƒ³è¦åŒæ—¶å¤„ç†å¤šä¸ªæµï¼Œè¦ä¹ˆå¤šè¿›ç¨‹(fork)ï¼Œè¦ä¹ˆå¤šçº¿ç¨‹(pthread_create)ï¼Œå¾ˆä¸å¹¸è¿™ä¸¤ç§æ–¹æ³•æ•ˆç‡éƒ½ä¸é«˜ã€‚</p>
<p>è‡ªä»JDK 1.4ç‰ˆæœ¬ä»¥æ¥ï¼ŒJDKå‘å¸ƒäº†å…¨æ–°çš„I/Oç±»åº“ï¼Œç®€ç§°NIOï¼ˆNew I/Oï¼‰ï¼Œæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œä¹Ÿæ˜¯I/Oå¤šè·¯å¤ç”¨çš„åŸºç¡€ï¼Œå·²ç»è¢«è¶Šæ¥è¶Šå¤šåœ°åº”ç”¨åˆ°å¤§å‹åº”ç”¨æœåŠ¡å™¨ï¼Œæˆä¸ºè§£å†³é«˜å¹¶å‘ä¸å¤§é‡è¿æ¥ã€I/Oå¤„ç†é—®é¢˜çš„æœ‰æ•ˆæ–¹å¼ã€‚</p>
<p><img src="https://itimetraveler.github.io/gallery/java-common/200901051231133411250.jpg" alt=""></p>
<p>NIOçš„åŒ…ä¸­ä¸»è¦åŒ…å«äº†è¿™æ ·å‡ ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼š </p>
<ul>
<li><strong>Buffer</strong>ï¼šåŒ…å«æ•°æ®ä¸”ç”¨äºè¯»å†™çš„çº¿å½¢è¡¨ç»“æ„ã€‚å…¶ä¸­è¿˜æä¾›äº†ä¸€ä¸ªç‰¹æ®Šç±»ç”¨äºå†…å­˜æ˜ å°„æ–‡ä»¶çš„I/Oæ“ä½œã€‚</li>
<li><strong>Charset</strong>ï¼šå®ƒæä¾›Unicodeå­—ç¬¦ä¸²å½±å°„åˆ°å­—èŠ‚åºåˆ—ä»¥åŠé€†æ˜ å°„çš„æ“ä½œã€‚</li>
<li><strong>Channels</strong>ï¼šåŒ…å«socketï¼Œfileå’Œpipeä¸‰ç§ç®¡é“ï¼Œéƒ½æ˜¯å…¨åŒå·¥çš„é€šé“ã€‚</li>
<li><strong>Selector</strong>ï¼šå¤šä¸ªå¼‚æ­¥I/Oæ“ä½œé›†ä¸­åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸­ï¼ˆå¯ä»¥è¢«çœ‹æˆæ˜¯Unixä¸­select()å‡½æ•°çš„é¢å‘å¯¹è±¡ç‰ˆæœ¬ï¼‰ã€‚</li>
</ul>
<p><img src="https://itimetraveler.github.io/gallery/java-common/Nio_Selector.png" alt=""></p>
<h2 id="çœ‹çœ‹æºç "><a href="#çœ‹çœ‹æºç " class="headerlink" title="çœ‹çœ‹æºç "></a>çœ‹çœ‹æºç </h2><h3 id="äº†è§£Channelå’ŒBuffer"><a href="#äº†è§£Channelå’ŒBuffer" class="headerlink" title="äº†è§£Channelå’ŒBuffer"></a>äº†è§£Channelå’ŒBuffer</h3><p><img src="https://itimetraveler.github.io/gallery/java-common/nio-buffer.png" alt=""></p>
<h3 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h3><blockquote>
<p>A channel represents an open connection to an entity such as a hardware device, a file, a network socket, or a program component that is capable of performing one or more distinct I/O operations, for example reading or writing.</p>
</blockquote>
<p>NIOæŠŠå®ƒæ”¯æŒçš„I/Oå¯¹è±¡æŠ½è±¡ä¸ºChannelï¼ŒChannelåˆç§°â€œé€šé“â€ï¼Œç±»ä¼¼äºåŸI/Oä¸­çš„æµï¼ˆStreamï¼‰ï¼Œä½†æœ‰æ‰€åŒºåˆ«ï¼š<br>1ã€æµæ˜¯å•å‘çš„ï¼Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯è¯»å¯å†™ã€‚<br>2ã€æµè¯»å†™æ˜¯é˜»å¡çš„ï¼Œé€šé“å¯ä»¥å¼‚æ­¥è¯»å†™ã€‚<br>3ã€æµä¸­çš„æ•°æ®å¯ä»¥é€‰æ‹©æ€§çš„å…ˆè¯»åˆ°ç¼“å­˜ä¸­ï¼Œé€šé“çš„æ•°æ®æ€»æ˜¯è¦å…ˆè¯»åˆ°ä¸€ä¸ªç¼“å­˜ä¸­ï¼Œæˆ–ä»ç¼“å­˜ä¸­å†™å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://itimetraveler.github.io/gallery/java-common/2184951-bd19826b2e3f7c26.png" alt=""></p>
<p>ç›®å‰å·²çŸ¥Channelçš„å®ç°ç±»æœ‰ï¼š</p>
<ul>
<li>FileChannel</li>
<li>DatagramChannel</li>
<li>SocketChannel</li>
<li>ServerSocketChannel</li>
</ul>
<h3 id="ç†è§£Selector"><a href="#ç†è§£Selector" class="headerlink" title="ç†è§£Selector"></a>ç†è§£Selector</h3><p>ä¹‹å‰è¿›è¡Œsocketç¼–ç¨‹æ—¶ï¼Œacceptæ–¹æ³•ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯è¯·æ±‚çš„åˆ°æ¥ï¼Œå¹¶è¿”å›socketè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯æµæ°´çº¿çš„ï¼Œå¤„ç†å®Œä¸€ä¸ªè¯·æ±‚ï¼Œæ‰èƒ½å»è·å–å¹¶å¤„ç†åé¢çš„è¯·æ±‚ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŠŠè·å–socketå’Œå¤„ç†socketçš„è¿‡ç¨‹åˆ†å¼€ï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£acceptï¼Œä¸€ä¸ªçº¿ç¨‹æ± è´Ÿè´£å¤„ç†è¯·æ±‚ã€‚</p>
<p>ä½†NIOæä¾›äº†æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨é€‰æ‹©å™¨ï¼ˆSelectorï¼‰è¿”å›å·²ç»å‡†å¤‡å¥½çš„socketï¼Œå¹¶æŒ‰é¡ºåºå¤„ç†ï¼ŒåŸºäºé€šé“ï¼ˆChannelï¼‰å’Œç¼“å†²åŒºï¼ˆBufferï¼‰æ¥è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæ¯ä¸ªçº¿ç¨‹é€šè¿‡ä¸€ä¸ªSelectorå¯ä»¥ç®¡ç†å¤šä¸ªSocketChannelã€‚</p>
<p><img src="https://itimetraveler.github.io/gallery/java-common/java-nio-selector.png" alt=""></p>
<p>ä¸ºäº†å®ç°Selectorç®¡ç†å¤šä¸ªSocketChannelï¼Œå¿…é¡»å°†å…·ä½“çš„SocketChannelå¯¹è±¡æ³¨å†Œåˆ°Selectorï¼Œå¹¶å£°æ˜éœ€è¦ç›‘å¬çš„äº‹ä»¶ï¼ˆè¿™æ ·Selectoræ‰çŸ¥é“éœ€è¦è®°å½•ä»€ä¹ˆæ•°æ®ï¼‰ï¼Œä¸€å…±æœ‰4ç§äº‹ä»¶ï¼š</p>
<p>1ã€<strong>connect</strong>ï¼šå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯äº‹ä»¶ï¼Œå¯¹åº”å€¼ä¸ºSelectionKey.OP_CONNECT(8)<br>2ã€<strong>accept</strong>ï¼šæœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶ï¼Œå¯¹åº”å€¼ä¸ºSelectionKey.OP_ACCEPT(16)<br>3ã€<strong>read</strong>ï¼šè¯»äº‹ä»¶ï¼Œå¯¹åº”å€¼ä¸ºSelectionKey.OP_READ(1)<br>4ã€<strong>write</strong>ï¼šå†™äº‹ä»¶ï¼Œå¯¹åº”å€¼ä¸ºSelectionKey.OP_WRITE(4)</p>
<p>è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œæ¯æ¬¡è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ï¼Œéƒ½æ˜¯ä»connectå¼€å§‹ï¼ŒconnectæˆåŠŸåï¼ŒæœåŠ¡ç«¯å¼€å§‹å‡†å¤‡acceptï¼Œå‡†å¤‡å°±ç»ªï¼Œå¼€å§‹è¯»æ•°æ®ï¼Œå¹¶å¤„ç†ï¼Œæœ€åå†™å›æ•°æ®è¿”å›ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“SocketChannelæœ‰å¯¹åº”çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSelectoréƒ½å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>
<h4 id="æœåŠ¡ç«¯ä»£ç "><a href="#æœåŠ¡ç«¯ä»£ç " class="headerlink" title="æœåŠ¡ç«¯ä»£ç "></a>æœåŠ¡ç«¯ä»£ç </h4><p>ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œå…ˆçœ‹ä¸€æ®µæœåŠ¡ç«¯çš„ç¤ºä¾‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ServerSocketChannel serverChannel = ServerSocketChannel.open();</span><br><span class="line"><span class="comment">//Channelè®¾ç½®ä¸ºéé˜»å¡</span></span><br><span class="line">serverChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">serverChannel.socket().bind(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line">Selector selector = Selector.open();</span><br><span class="line"><span class="comment">//Channelæ³¨å†Œåˆ°Selectorä¸­</span></span><br><span class="line">serverChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">    <span class="keyword">int</span> n = selector.select();</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">    Iterator ite = <span class="keyword">this</span>.selector.selectedKeys().iterator();</span><br><span class="line">    <span class="keyword">while</span>(ite.hasNext())&#123;</span><br><span class="line">        SelectionKey key = (SelectionKey)ite.next();</span><br><span class="line">        <span class="keyword">if</span> (key.isAcceptable())&#123;</span><br><span class="line">            SocketChannel clntChan = ((ServerSocketChannel) key.channel()).accept();</span><br><span class="line">            clntChan.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            <span class="comment">//å°†é€‰æ‹©å™¨æ³¨å†Œåˆ°è¿æ¥åˆ°çš„å®¢æˆ·ç«¯ä¿¡é“ï¼Œ</span></span><br><span class="line">            <span class="comment">//å¹¶æŒ‡å®šè¯¥ä¿¡é“keyå€¼çš„å±æ€§ä¸ºOP_READï¼Œ</span></span><br><span class="line">            <span class="comment">//åŒæ—¶ä¸ºè¯¥ä¿¡é“æŒ‡å®šå…³è”çš„é™„ä»¶</span></span><br><span class="line">            clntChan.register(key.selector(), SelectionKey.OP_READ, ByteBuffer.allocate(bufSize));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key.isReadable())&#123;</span><br><span class="line">            handleRead(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key.isWritable() &amp;&amp; key.isValid())&#123;</span><br><span class="line">            handleWrite(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key.isConnectable())&#123;</span><br><span class="line">            System.out.println(<span class="string">"isConnectable = true"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      ite.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºServerSocketChannelå®ä¾‹ï¼Œå¹¶ç»‘å®šæŒ‡å®šç«¯å£ï¼›</li>
<li>åˆ›å»ºSelectorå®ä¾‹ï¼›</li>
<li>å°†serverSocketChannelæ³¨å†Œåˆ°selectorï¼Œå¹¶æŒ‡å®šäº‹ä»¶OP_ACCEPTï¼Œæœ€åº•å±‚çš„socketé€šè¿‡channelå’Œselectorå»ºç«‹å…³è”ï¼›</li>
<li>å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½çš„socketï¼Œselectæ–¹æ³•ä¼šè¢«é˜»å¡ä¸€æ®µæ—¶é—´å¹¶è¿”å›0ï¼›</li>
<li>å¦‚æœåº•å±‚æœ‰socketå·²ç»å‡†å¤‡å¥½ï¼Œselectorçš„selectæ–¹æ³•ä¼šè¿”å›socketçš„ä¸ªæ•°ï¼Œè€Œä¸”selectedKeysæ–¹æ³•ä¼šè¿”å›socketå¯¹åº”çš„äº‹ä»¶ï¼ˆconnectã€acceptã€read or writeï¼‰ï¼›</li>
<li>æ ¹æ®äº‹ä»¶ç±»å‹ï¼Œè¿›è¡Œä¸åŒçš„å¤„ç†é€»è¾‘ï¼›</li>
</ol>
<h4 id="Selectorå®ç°åŸç†"><a href="#Selectorå®ç°åŸç†" class="headerlink" title="Selectorå®ç°åŸç†"></a>Selectorå®ç°åŸç†</h4><p>SocketChannelã€ServerSocketChannelå’ŒSelectorçš„å®ä¾‹åˆå§‹åŒ–éƒ½é€šè¿‡SelectorProviderç±»å®ç°ï¼Œå…¶ä¸­Selectoræ˜¯æ•´ä¸ªNIO Socketçš„æ ¸å¿ƒå®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SelectorProvider <span class="title">provider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (provider != <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> provider;</span><br><span class="line">        <span class="keyword">return</span> AccessController.doPrivileged(</span><br><span class="line">            <span class="keyword">new</span> PrivilegedAction&lt;SelectorProvider&gt;() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> SelectorProvider <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (loadProviderFromProperty())</span><br><span class="line">                            <span class="keyword">return</span> provider;</span><br><span class="line">                        <span class="keyword">if</span> (loadProviderAsService())</span><br><span class="line">                            <span class="keyword">return</span> provider;</span><br><span class="line">                        provider = sun.nio.ch.DefaultSelectorProvider.create();</span><br><span class="line">                        <span class="keyword">return</span> provider;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SelectorProvideråœ¨windowså’Œlinuxä¸‹æœ‰ä¸åŒçš„å®ç°ï¼Œprovideræ–¹æ³•ä¼šè¿”å›å¯¹åº”çš„å®ç°ã€‚å…¶ä¸­<code>provider = sun.nio.ch.DefaultSelectorProvider.create();</code>ä¼šæ ¹æ®æ“ä½œç³»ç»Ÿæ¥è¿”å›ä¸åŒçš„å®ç°ç±»ï¼Œwindowså¹³å°å°±è¿”å›WindowsSelectorProviderï¼›</p>
<p><img src="https://itimetraveler.github.io/gallery/java-common/WX20180517-182153@2xjietu.png" alt=""></p>
<h4 id="Selector-wakeup"><a href="#Selector-wakeup" class="headerlink" title="Selector.wakeup()"></a>Selector.wakeup()</h4><h5 id="ä¸»è¦ä½œç”¨"><a href="#ä¸»è¦ä½œç”¨" class="headerlink" title="ä¸»è¦ä½œç”¨"></a>ä¸»è¦ä½œç”¨</h5><p>è§£é™¤é˜»å¡åœ¨Selector.select() / select(long)ä¸Šçš„çº¿ç¨‹ï¼Œç«‹å³è¿”å›ã€‚</p>
<p>ä¸¤æ¬¡æˆåŠŸçš„selectä¹‹é—´å¤šæ¬¡è°ƒç”¨wakeupç­‰ä»·äºä¸€æ¬¡è°ƒç”¨ã€‚</p>
<p>å¦‚æœå½“å‰æ²¡æœ‰é˜»å¡åœ¨selectä¸Šï¼Œåˆ™æœ¬æ¬¡wakeupè°ƒç”¨å°†ä½œç”¨äºä¸‹ä¸€æ¬¡selectâ€”â€”â€œè®°å¿†â€ä½œç”¨ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦å”¤é†’ï¼Ÿ</p>
<ul>
<li>æ³¨å†Œäº†æ–°çš„channelæˆ–è€…äº‹ä»¶ã€‚</li>
<li>channelå…³é—­ï¼Œå–æ¶ˆæ³¨å†Œã€‚</li>
<li>ä¼˜å…ˆçº§æ›´é«˜çš„äº‹ä»¶è§¦å‘ï¼ˆå¦‚å®šæ—¶å™¨äº‹ä»¶ï¼‰ï¼Œå¸Œæœ›åŠæ—¶å¤„ç†ã€‚</li>
</ul>
<h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>Linuxä¸Šåˆ©ç”¨pipeè°ƒç”¨åˆ›å»ºä¸€ä¸ªç®¡é“ï¼ŒWindowsä¸Šåˆ™æ˜¯ä¸€ä¸ªloopbackçš„tcpè¿æ¥ã€‚è¿™æ˜¯å› ä¸ºwin32çš„ç®¡é“æ— æ³•åŠ å…¥selectçš„fd setï¼Œå°†ç®¡é“æˆ–è€…TCPè¿æ¥åŠ å…¥select fd setã€‚</p>
<p>wakeupå¾€ç®¡é“æˆ–è€…è¿æ¥å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œé˜»å¡çš„selectå› ä¸ºæœ‰I/Oäº‹ä»¶å°±ç»ªï¼Œç«‹å³è¿”å›ã€‚å¯è§ï¼Œwakeupçš„è°ƒç”¨å¼€é”€ä¸å¯å¿½è§†ã€‚</p>
<h2 id="BIO-NIO-AIO"><a href="#BIO-NIO-AIO" class="headerlink" title="BIO, NIO, AIO"></a>BIO, NIO, AIO</h2><p>BIOåŒæ­¥é˜»å¡IOï¼Œé€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç›´è§‚ç®€å•æ˜“ç†è§£ã€‚</p>
<p>NIOåŒæ­¥éé˜»å¡IOï¼Œé€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4å¼€å§‹æ”¯æŒã€‚</p>
<p>AIOå¼‚æ­¥éé˜»å¡IOï¼ŒAIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>NIOä¸»è¦ä½¿ç”¨äº†Channelå’ŒSelectoræ¥å®ç°ï¼ŒJavaçš„Selectorç±»ä¼¼Winsockçš„Selectæ¨¡å¼ï¼Œæ˜¯ä¸€ç§åŸºäºäº‹ä»¶é©±åŠ¨çš„ï¼Œæ•´ä¸ªå¤„ç†æ–¹æ³•ä½¿ç”¨äº†è½®è®­çš„çŠ¶æ€æœºï¼Œå¥½å¤„å°±æ˜¯å•çº¿ç¨‹æ›´èŠ‚çœç³»ç»Ÿå¼€é”€ï¼ŒNIOçš„å¥½å¤„å¯ä»¥å¾ˆå¥½çš„å¤„ç†å¹¶å‘ï¼Œå¯¹äºAndroidç½‘æ¸¸å¼€å‘æ¥è¯´æ¯”è¾ƒå…³é”®ï¼Œå¯¹äºå¤šç‚¹Socketè¿æ¥è€Œè¨€ä½¿ç”¨NIOå¯ä»¥å¤§å¤§å‡å°‘çº¿ç¨‹ä½¿ç”¨ï¼Œé™ä½äº†çº¿ç¨‹æ­»é”çš„æ¦‚ç‡ã€‚</p>
<p>NIOä½œä¸ºä¸€ç§ä¸­é«˜è´Ÿè½½çš„I/Oæ¨¡å‹ï¼Œç›¸å¯¹äºä¼ ç»Ÿçš„BIO (Blocking I/O)æ¥è¯´æœ‰äº†å¾ˆå¤§çš„æé«˜ï¼Œå¤„ç†å¹¶å‘ä¸ç”¨å¤ªå¤šçš„çº¿ç¨‹ï¼Œçœå»äº†åˆ›å»ºé”€æ¯çš„æ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹è¿‡å¤šè°ƒåº¦æ˜¯é—®é¢˜ï¼ŒåŒæ—¶å¾ˆå¤šçº¿ç¨‹å¯èƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œå¤§å¤§æµªè´¹äº†CPUæ—¶é—´ï¼ŒåŒæ—¶è¿‡å¤šçš„çº¿ç¨‹å¯èƒ½æ˜¯æ€§èƒ½å¤§å¹…ä¸‹é™ï¼Œä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆä¸­å¯èƒ½ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†è°ƒåº¦ä½†è¿™ç§æ–¹æ³•æ²»æ ‡ä¸æ²»æœ¬ã€‚ä½¿ç”¨NIOå¯ä»¥ä½¿å¹¶å‘çš„æ•ˆç‡å¤§å¤§æé«˜ã€‚å½“ç„¶NIOå’ŒJDK 7ä¸­çš„AIOè¿˜å­˜åœ¨ä¸€äº›åŒºåˆ«ï¼ŒAIOä½œä¸ºä¸€ç§æ›´æ–°çš„å½“ç„¶è¿™æ˜¯å¯¹äºJavaè€Œè¨€ï¼Œå¦‚æœä½ å¼€å‘è¿‡WinsockæœåŠ¡å™¨ï¼Œé‚£ä¹ˆIOCPè¿™æ ·çš„I/Oå®Œæˆç«¯å£å¯ä»¥è§£å†³æ›´é«˜çº§çš„è´Ÿè½½</p>
<h2 id="å‡ ä¸ªé—®é¢˜"><a href="#å‡ ä¸ªé—®é¢˜" class="headerlink" title="å‡ ä¸ªé—®é¢˜"></a>å‡ ä¸ªé—®é¢˜</h2><h3 id="blockingå’Œnon-blockingçš„åŒºåˆ«"><a href="#blockingå’Œnon-blockingçš„åŒºåˆ«" class="headerlink" title="blockingå’Œnon-blockingçš„åŒºåˆ«"></a>blockingå’Œnon-blockingçš„åŒºåˆ«</h3><p>è°ƒç”¨blocking IOä¼šä¸€ç›´blockä½å¯¹åº”çš„è¿›ç¨‹ç›´åˆ°æ“ä½œå®Œæˆï¼Œè€Œnon-blocking IOåœ¨kernelè¿˜å‡†å¤‡æ•°æ®çš„æƒ…å†µä¸‹ä¼šç«‹åˆ»è¿”å›ã€‚</p>
<h3 id="synchronous-IOå’Œasynchronous-IOçš„åŒºåˆ«"><a href="#synchronous-IOå’Œasynchronous-IOçš„åŒºåˆ«" class="headerlink" title="synchronous IOå’Œasynchronous IOçš„åŒºåˆ«"></a>synchronous IOå’Œasynchronous IOçš„åŒºåˆ«</h3><p>åœ¨è¯´æ˜synchronous IOå’Œasynchronous IOçš„åŒºåˆ«ä¹‹å‰ï¼Œéœ€è¦å…ˆç»™å‡ºä¸¤è€…çš„å®šä¹‰ã€‚POSIXçš„å®šä¹‰æ˜¯è¿™æ ·å­çš„ï¼š<br>- A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;<br>- An asynchronous I/O operation does not cause the requesting process to be blocked;</p>
<p>ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºsynchronous IOåšâ€IO operationâ€çš„æ—¶å€™ä¼šå°†processé˜»å¡ã€‚æŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œä¹‹å‰æ‰€è¿°çš„blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±äºsynchronous IOã€‚</p>
<p>æœ‰äººä¼šè¯´ï¼Œnon-blocking IOå¹¶æ²¡æœ‰è¢«blockå•Šã€‚è¿™é‡Œæœ‰ä¸ªéå¸¸â€œç‹¡çŒ¾â€çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸­æ‰€æŒ‡çš„â€IO operationâ€æ˜¯æŒ‡çœŸå®çš„IOæ“ä½œï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„recvfromè¿™ä¸ªsystem callã€‚non-blocking IOåœ¨æ‰§è¡Œrecvfromè¿™ä¸ªsystem callçš„æ—¶å€™ï¼Œå¦‚æœkernelçš„æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ—¶å€™ä¸ä¼šblockè¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå½“kernelä¸­æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œrecvfromä¼šå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚</p>
<p>è€Œasynchronous IOåˆ™ä¸ä¸€æ ·ï¼Œå½“è¿›ç¨‹å‘èµ·IO æ“ä½œä¹‹åï¼Œå°±ç›´æ¥è¿”å›å†ä¹Ÿä¸ç†ç¬äº†ï¼Œç›´åˆ°kernelå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰è¿›ç¨‹è¯´IOå®Œæˆã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹å®Œå…¨æ²¡æœ‰è¢«blockã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://blog.csdn.net/historyasamirror/article/details/5778378" target="_blank" rel="noopener">IO - åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡ ï¼ˆäº¡ç¾Šè¡¥ç‰¢ç¯‡ï¼‰</a></li>
<li><a href="https://tech.meituan.com/nio.html" target="_blank" rel="noopener">Java NIOæµ…æ - ç¾å›¢ç‚¹è¯„æŠ€æœ¯å›¢é˜Ÿ</a></li>
<li><a href="https://www.jianshu.com/p/0d497fe5484a" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºNIOä¹‹Selectorå®ç°åŸç† - å å°ç‹¼</a></li>
<li><a href="http://goon.iteye.com/blog/1775421" target="_blank" rel="noopener">Java NIOâ€”â€”Selectoræœºåˆ¶è§£æä¸‰ï¼ˆæºç åˆ†æï¼‰</a></li>
<li><a href="https://blog.csdn.net/haoel/article/details/2224055" target="_blank" rel="noopener">Java NIOç±»åº“Selectoræœºåˆ¶è§£æï¼ˆä¸Šï¼‰â€”â€” é™ˆçš“</a></li>
<li><a href="http://www.cnblogs.com/melons/p/5791788.html" target="_blank" rel="noopener">Linuxä¸‹I/Oå¤šè·¯è½¬æ¥ä¹‹epoll(ç»å¯¹ç»å…¸)</a></li>
<li><a href="https://www.zhihu.com/question/20122137" target="_blank" rel="noopener">epoll æˆ–è€… kqueue çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ- çŸ¥ä¹</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1005481" target="_blank" rel="noopener">å¤§è¯ Selectã€Pollã€Epoll</a></li>
<li><a href="https://blog.csdn.net/wangpeihuixyz/article/details/41732127" target="_blank" rel="noopener">linuxå†…æ ¸epollå®ç°åˆ†æ</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Javaã€‘NIOçš„ç†è§£"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/05/15/ã€Javaã€‘NIOçš„ç†è§£/">ã€Javaã€‘NIOçš„åŸç†ä¸æµ…æ</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/05/15/ã€Javaã€‘NIOçš„ç†è§£/" class="article-date">
	  <time datetime="2018-05-15T14:20:55.000Z" itemprop="datePublished">2018-05-15</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å‡ ä¸ªæ¦‚å¿µ"><a href="#å‡ ä¸ªæ¦‚å¿µ" class="headerlink" title="å‡ ä¸ªæ¦‚å¿µ"></a>å‡ ä¸ªæ¦‚å¿µ</h2><h3 id="ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´"><a href="#ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´" class="headerlink" title="ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´"></a>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´</h3><p>ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“å¿ƒç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºå†…æ ¸ç©ºé—´ï¼Œè€Œå°†è¾ƒä½çš„3Gå­—èŠ‚ï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºç”¨æˆ·ç©ºé—´ã€‚</p>
<p>åœ¨Linuxä¸–ç•Œï¼Œè¿›ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡ï¼Œå½“è¿›ç¨‹éœ€è¦è®¿é—®ç¡¬ä»¶è®¾å¤‡(æ¯”å¦‚è¯»å–ç£ç›˜æ–‡ä»¶ï¼Œæ¥æ”¶ç½‘ç»œæ•°æ®ç­‰ç­‰)æ—¶ï¼Œå¿…é¡»ç”±ç”¨æˆ·æ€æ¨¡å¼åˆ‡æ¢è‡³å†…æ ¸æ€æ¨¡å¼ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨è®¿é—®ç¡¬ä»¶è®¾å¤‡ã€‚</p>
<h3 id="æ–‡ä»¶æè¿°ç¬¦fd"><a href="#æ–‡ä»¶æè¿°ç¬¦fd" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦fd"></a>æ–‡ä»¶æè¿°ç¬¦fd</h3><p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªç”¨äºè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µã€‚</p>
<p>æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚</p>
        <!-- å‡ ä¸ªæ¦‚å¿µç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ç°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“å¿ƒç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿ......  -->
        <p class="article-more-link">
          <a href="2018/05/15/ã€Javaã€‘NIOçš„ç†è§£/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/05/04/ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†/">ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/05/04/ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†/" class="article-date">
	  <time datetime="2018-05-04T14:20:55.000Z" itemprop="datePublished">2018-05-04</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a><a class="article-category-link" href="categories/Java/æºç åˆ†æ/">æºç åˆ†æ</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>join()</code>æ˜¯Threadç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚æ ¹æ®jdkæ–‡æ¡£çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>public final void join()throws InterruptedException:  <strong>Waits for this thread to die</strong>.</p>
</blockquote>
<p><code>join()</code>æ–¹æ³•çš„ä½œç”¨ï¼Œæ˜¯ç­‰å¾…è¿™ä¸ªçº¿ç¨‹ç»“æŸï¼›ä½†æ˜¾ç„¶ï¼Œè¿™æ ·çš„å®šä¹‰å¹¶ä¸æ¸…æ™°ã€‚ä¸ªäººè®¤ä¸ºâ€Java 7 Concurrency Cookbookâ€çš„å®šä¹‰è¾ƒä¸ºæ¸…æ™°ï¼š</p>
<blockquote>
<p><strong>join() method suspends the execution of the calling thread until the object called finishes its execution.</strong></p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œt.join()æ–¹æ³•é˜»å¡è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹(calling thread)ï¼Œç›´åˆ°çº¿ç¨‹tå®Œæˆï¼Œæ­¤çº¿ç¨‹å†ç»§ç»­ï¼›é€šå¸¸ç”¨äºåœ¨main()ä¸»çº¿ç¨‹å†…ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹å®Œæˆå†ç»“æŸmain()ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
        <!-- ç®€ä»‹join()æ˜¯Threadç±»çš„ä¸€ä¸ªæ–¹æ³•ã€‚æ ¹æ®jdkæ–‡æ¡£çš„å®šä¹‰ï¼š

public final void join()throws InterruptedException:  Waits for this thread to die.

join()æ–¹æ³•çš„ä½œç”¨ï¼Œæ˜¯ç­‰å¾…è¿™ä¸ªçº¿ç¨‹ç»“æŸï¼›ä½†æ˜¾ç„¶ï¼Œè¿™æ ·çš„å®šä¹‰å¹¶ä¸æ¸…æ™°ã€‚ä¸ªäººè®¤ä¸ºâ€Java 7 Concurrency Cookbookâ€çš„å®šä¹‰è¾ƒä¸ºæ¸…æ™°ï¼š......  -->
        <p class="article-more-link">
          <a href="2018/05/04/ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/æºç åˆ†æ/">æºç åˆ†æ</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Androidã€‘Retrofitæºç åˆ†æ"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/04/10/ã€Androidã€‘Retrofitæºç åˆ†æ/">ã€Androidã€‘Retrofitæºç åˆ†æ</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/04/10/ã€Androidã€‘Retrofitæºç åˆ†æ/" class="article-date">
	  <time datetime="2018-04-10T14:20:55.000Z" itemprop="datePublished">2018-04-10</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a><a class="article-category-link" href="categories/Android/æºç åˆ†æ/">æºç åˆ†æ</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Retrofitç®€ä»‹"><a href="#Retrofitç®€ä»‹" class="headerlink" title="Retrofitç®€ä»‹"></a>Retrofitç®€ä»‹</h3><p><code>retrofit</code> n. å¼æ ·ç¿»æ–°ï¼ŒèŠ±æ ·ç¿»æ–°      vt. ç»™æœºå™¨è®¾å¤‡è£…é…ï¼ˆæ–°éƒ¨ä»¶ï¼‰ï¼Œç¿»æ–°ï¼Œæ”¹å‹</p>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener"><strong>Retrofit</strong></a> æ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¯´å®ƒæ˜¯ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œä¸»è¦åŸå› åœ¨äºç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¹¶ä¸æ˜¯ <code>Retrofit</code> æ¥å®Œæˆçš„ã€‚<code>Retrofit</code> 2.0 å¼€å§‹å†…ç½® <a href="http://square.github.io/okhttp/" target="_blank" rel="noopener"><code>OkHttp</code></a>ï¼Œå‰è€…ä¸“æ³¨äºæ¥å£çš„å°è£…ï¼Œåè€…ä¸“æ³¨äºçœŸæ­£çš„ç½‘ç»œè¯·æ±‚ã€‚å³é€šè¿‡ å¤§é‡çš„è®¾è®¡æ¨¡å¼ å°è£…äº† <code>OkHttp</code> ï¼Œä½¿å¾—ç®€æ´æ˜“ç”¨ã€‚</p>
<p><img src="/gallery/android_common/4182937778-57515297dacff_articlex.png" alt=""></p>
<p>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€šè¿‡ <code>Retrofit</code> è¯·æ±‚ç½‘ç»œï¼Œå®é™…ä¸Šæ˜¯ä½¿ç”¨ <code>Retrofit</code> æ¥å£å±‚å°è£…è¯·æ±‚å‚æ•°ã€Headerã€Url ç­‰ä¿¡æ¯ï¼Œä¹‹åç”± <code>OkHttp</code>å®Œæˆåç»­çš„è¯·æ±‚æ“ä½œï¼Œåœ¨æœåŠ¡ç«¯è¿”å›æ•°æ®ä¹‹åï¼Œ<code>OkHttp</code> å°†åŸå§‹çš„ç»“æœäº¤ç»™ <code>Retrofit</code>ï¼Œåè€…æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å¯¹ç»“æœè¿›è¡Œè§£æçš„è¿‡ç¨‹ã€‚Retrofitçš„å¤§æ¦‚åŸç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>Retrofit</code> å°† <code>Http</code>è¯·æ±‚ æŠ½è±¡ æˆ <code>Java</code>æ¥å£</li>
<li>åœ¨æ¥å£é‡Œç”¨ æ³¨è§£ æè¿°å’Œé…ç½® ç½‘ç»œè¯·æ±‚å‚æ•°</li>
<li>ç”¨åŠ¨æ€ä»£ç† çš„æ–¹å¼ï¼ŒåŠ¨æ€å°†ç½‘ç»œè¯·æ±‚æ¥å£çš„æ³¨è§£ è§£æ æˆ<code>HTTP</code>è¯·æ±‚</li>
<li>æœ€åæ‰§è¡Œ<code>HTTP</code>è¯·æ±‚</li>
</ol>
<p>è¿™ç¯‡æ–‡ç« æˆ‘å°†ä»Retrofitçš„åŸºæœ¬ç”¨æ³•å‡ºå‘ï¼ŒæŒ‰ç…§å…¶ä½¿ç”¨æ­¥éª¤ï¼Œä¸€æ­¥æ­¥çš„æ¢ç©¶Retrofitçš„å®ç°åŸç†åŠå…¶æºç çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>Retrofit Github: <a href="https://github.com/square/retrofit">https://github.com/square/retrofit</a></p>
<h3 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h3><p>ä½¿ç”¨ <code>Retrofit</code> éå¸¸ç®€å•ï¼Œé¦–å…ˆéœ€è¦åœ¨ build.gradle ä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:retrofit:2.4.0'</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦ä½¿ç”¨Gsonè§£æå™¨ï¼Œä¹Ÿéœ€è¦åœ¨build.gradleä¸­æ·»åŠ ä¾èµ–ï¼ˆåæ–‡ä¼šè¯¦ç»†è®²åˆ°Retrofitçš„Converterï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:converter-gson:2.0.2'</span></span><br></pre></td></tr></table></figure>
<h4 id="1-å®šä¹‰Interface"><a href="#1-å®šä¹‰Interface" class="headerlink" title="1. å®šä¹‰Interface"></a>1. å®šä¹‰Interface</h4><p>Retrofitä½¿ç”¨java interfaceå’Œæ³¨è§£æè¿°äº†HTTPè¯·æ±‚çš„APIå‚æ•°ï¼Œæ¯”å¦‚Githubçš„ä¸€ä¸ªAPIï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@GET</span>(<span class="string">"users/&#123;user&#125;/repos"</span>)</span><br><span class="line">  Call&lt;List&lt;Repo&gt;&gt; listRepos(<span class="meta">@Path</span>(<span class="string">"user"</span>) String user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        <!-- Retrofitç®€ä»‹retrofit n. å¼æ ·ç¿»æ–°ï¼ŒèŠ±æ ·ç¿»æ–°      vt. ç»™æœºå™¨è®¾å¤‡è£…é…ï¼ˆæ–°éƒ¨ä»¶ï¼‰ï¼Œç¿»æ–°ï¼Œæ”¹å‹
Retrofit æ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¯´å®ƒæ˜¯ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œä¸»è¦åŸå› åœ¨äºç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¹¶ä¸æ˜¯ Retrofit æ¥å®Œæˆçš„ã€‚Retrofit 2.0 å¼€å§‹å†…ç½® OkHttpï¼Œå‰è€…ä¸“æ³¨äºæ¥å£çš„å°è£…ï¼Œåè€…ä¸“æ³¨äºçœŸæ­£çš„ç½‘ç»œè¯·æ±‚ã€‚å³é€š......  -->
        <p class="article-more-link">
          <a href="2018/04/10/ã€Androidã€‘Retrofitæºç åˆ†æ/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/æºç åˆ†æ/">æºç åˆ†æ</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/04/06/ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•/">ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/04/06/ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•/" class="article-date">
	  <time datetime="2018-04-06T04:20:55.000Z" itemprop="datePublished">2018-04-06</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Androidæœ¬èº«å¹¶æ²¡æœ‰æä¾›ç›‘å¬Appçš„å‰åå°åˆ‡æ¢æ“ä½œçš„æ–¹æ³•ã€‚æœ€è¿‘çœ‹åˆ°ä¸€ç§ç®€å•å·§å¦™çš„æ–¹æ³•æ¥ç›‘å¬å‰åå°ï¼Œè¿™é‡Œåˆ†äº«è®°å½•ä¸€ä¸‹ã€‚</p>
<h3 id="ä¸€ã€Activityç”Ÿå‘½å‘¨æœŸ"><a href="#ä¸€ã€Activityç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ä¸€ã€Activityç”Ÿå‘½å‘¨æœŸ"></a>ä¸€ã€Activityç”Ÿå‘½å‘¨æœŸ</h3><p>æˆ‘ä»¬çŸ¥é“åœ¨Androidä¸­ï¼Œä¸¤ä¸ªActivityï¼Œåˆ†åˆ«ä¸ºAå’ŒBã€‚å‡è®¾æ­¤æ—¶Aåœ¨å‰å°ï¼Œå½“Aå¯åŠ¨Bæ—¶ï¼Œä»–ä»¬ä¿©ä¹‹é—´çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»å¦‚ä¸‹ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„è¿™ç¯‡æ–‡ç« <a href="https://blog.csdn.net/u010983881/article/details/50036647" target="_blank" rel="noopener">ã€Androidã€‘Activityä¸Fragmentçš„ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»</a>ï¼š</p>
<blockquote>
<p>A.onPause()  -&gt;  B.onCreate()  -&gt;  <strong>B.onStart()</strong>  -&gt;  B.onResume()  -&gt;  <strong>A.onStop()</strong></p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´Bçš„onStart()æ–¹æ³•æ˜¯åœ¨Açš„onStop()æ–¹æ³•ä¹‹å‰æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ç‚¹æ¥åšæ–‡ç« ã€‚<strong>åœ¨æ‰€æœ‰Activityçš„onStart()å’ŒonStop()æ–¹æ³•ä¸­è¿›è¡Œè®¡æ•°ï¼Œè®¡æ•°å˜é‡ä¸ºcountï¼Œåœ¨onStartä¸­å°†å˜é‡åŠ 1ï¼ŒonStopä¸­å‡1ã€‚</strong></p>
<p>é‚£ä¹ˆè¿™ä¸ªcountåœ¨æ•´ä¸ªAppçš„ç”Ÿå‘½å‘¨æœŸé‡Œçš„å€¼å°±ä¼šåƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">count</span><br><span class="line">2|          _     _     _     _</span><br><span class="line">1|     ____| |___| |___| |___| |____</span><br><span class="line">0| ___|                             |___</span><br><span class="line"> ===========================================&gt; æ—¶é—´</span><br><span class="line">      a     b     c                 d</span><br></pre></td></tr></table></figure>
<p>æ¨ªè½´è¡¨ç¤ºæ—¶é—´ï¼Œçºµè½´è¡¨ç¤ºcountçš„å€¼ã€‚é‚£ä¹ˆaã€bã€cã€då››ä¸ªæ—¶é—´ç‚¹å‘ç”Ÿçš„äº‹æƒ…å¦‚ä¸‹ï¼š</p>
<ol>
<li>aç‚¹å°±æ˜¯å¯åŠ¨äº†åº”ç”¨ï¼›</li>
<li>bç‚¹æ˜¯<strong>Activity_A</strong>å¯åŠ¨äº†å¦ä¸€ä¸ª<strong>Activity_B</strong>ï¼›</li>
<li>cç‚¹æ˜¯<strong>Activity_B</strong>å¯åŠ¨äº†å¦ä¸€ä¸ª<strong>Activity_C</strong>ï¼Œåé¢ä»¥æ­¤ç±»æ¨ï¼›</li>
<li>dç‚¹æ˜¯åº”ç”¨åˆ‡æ¢åˆ°äº†åå°ï¼›</li>
</ol>
<p>ä»ä¸Šé¢çš„æƒ…å†µçœ‹å‡ºï¼Œå¯ä»¥é€šè¿‡å¯¹countè®¡æ•°ä¸º0ï¼Œæ¥åˆ¤æ–­åº”ç”¨è¢«ä»å‰å°åˆ‡åˆ°äº†åå°ã€‚åŒæ ·çš„ï¼Œä»åå°åˆ‡åˆ°å‰å°ä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ã€‚å…·ä½“å®ç°çœ‹åé¢çš„ä»£ç ã€‚</p>
        <!-- Androidæœ¬èº«å¹¶æ²¡æœ‰æä¾›ç›‘å¬Appçš„å‰åå°åˆ‡æ¢æ“ä½œçš„æ–¹æ³•ã€‚æœ€è¿‘çœ‹åˆ°ä¸€ç§ç®€å•å·§å¦™çš„æ–¹æ³•æ¥ç›‘å¬å‰åå°ï¼Œè¿™é‡Œåˆ†äº«è®°å½•ä¸€ä¸‹ã€‚
ä¸€ã€Activityç”Ÿå‘½å‘¨æœŸæˆ‘ä»¬çŸ¥é“åœ¨Androidä¸­ï¼Œä¸¤ä¸ªActivityï¼Œåˆ†åˆ«ä¸ºAå’ŒBã€‚å‡è®¾æ­¤æ—¶Aåœ¨å‰å°ï¼Œå½“Aå¯åŠ¨Bæ—¶ï¼Œä»–ä»¬ä¿©ä¹‹é—´çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»å¦‚ä¸‹ï¼Œå¯ä»¥å‚è€ƒä¹‹å‰çš„è¿™ç¯‡æ–‡ç« ã€Androidã€‘Activityä¸Fragmentçš„ç”Ÿå‘½å‘¨æœŸçš„å…³ç³»ï¼š

A.onPause()......  -->
        <p class="article-more-link">
          <a href="2018/04/06/ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Javaã€‘çº¿ç¨‹æ± ThreadPoolExecutorå®ç°åŸç†"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/02/13/ã€Javaã€‘çº¿ç¨‹æ± ThreadPoolExecutorå®ç°åŸç†/">ã€Javaã€‘çº¿ç¨‹æ± ThreadPoolExecutorå®ç°åŸç†</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/02/13/ã€Javaã€‘çº¿ç¨‹æ± ThreadPoolExecutorå®ç°åŸç†/" class="article-date">
	  <time datetime="2018-02-13T14:20:55.000Z" itemprop="datePublished">2018-02-13</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a><a class="article-category-link" href="categories/Android/æºç åˆ†æ/">æºç åˆ†æ</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>çº¿ç¨‹æ± ï¼šå¯ä»¥ç†è§£ä¸ºç¼“å†²åŒºï¼Œç”±äºé¢‘ç¹çš„åˆ›å»ºé”€æ¯çº¿ç¨‹ä¼šå¸¦æ¥ä¸€å®šçš„æˆæœ¬ï¼Œå¯ä»¥é¢„å…ˆåˆ›å»ºä½†ä¸ç«‹å³é”€æ¯ï¼Œä»¥å…±äº«æ–¹å¼ä¸ºåˆ«äººæä¾›æœåŠ¡ï¼Œä¸€æ¥å¯ä»¥æä¾›æ•ˆç‡ï¼Œå†è€…å¯ä»¥æ§åˆ¶çº¿ç¨‹æ— çº¿æ‰©å¼ ã€‚åˆç†åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„ï¼š</p>
<ol>
<li>é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li>
<li>æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</li>
</ol>
<p>ä½†æ˜¯è¦åšåˆ°åˆç†çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶åŸç†äº†å¦‚æŒ‡æŒã€‚</p>
<h2 id="çº¿ç¨‹çš„å‡ ç§çŠ¶æ€"><a href="#çº¿ç¨‹çš„å‡ ç§çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„å‡ ç§çŠ¶æ€"></a><strong>çº¿ç¨‹çš„å‡ ç§çŠ¶æ€</strong></h2><p>çº¿ç¨‹åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼ŒçŠ¶æ€ä¼šå‘ç”Ÿå˜åŒ–ã€‚æ ¹æ®<a href="https://my.oschina.net/cctester/blog/991744" target="_blank" rel="noopener">çº¿ç¨‹çš„å‡ ç§çŠ¶æ€</a>è¿™ç¯‡æ–‡ç« ï¼Œçº¿ç¨‹ä¸€å…±æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p>
<p><strong>1ã€æ–°å»ºçŠ¶æ€(New)</strong>ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚<br><strong>2ã€å°±ç»ªçŠ¶æ€(Runnable)</strong>ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å¯¹è±¡çš„<code>start()</code>æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºâ€œå¯è¿è¡Œçº¿ç¨‹æ± â€ä¸­ï¼Œå˜å¾—å¯è¿è¡Œï¼Œåªç­‰å¾…è·å–CPUçš„ä½¿ç”¨æƒï¼Œå³<strong>åœ¨å°±ç»ªçŠ¶æ€çš„çº¿ç¨‹é™¤CPUä¹‹å¤–ï¼Œå…¶å®ƒçš„è¿è¡Œæ‰€éœ€èµ„æºéƒ½å·²å…¨éƒ¨è·å¾—ã€‚</strong><br><strong>3ã€è¿è¡ŒçŠ¶æ€(Running)</strong>ï¼šå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å–äº†CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚<br><strong>4ã€é˜»å¡çŠ¶æ€(Blocked)</strong>ï¼šé˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒCPUä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼š</p>
<ul>
<li>â‘ . ç­‰å¾…é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œ<code>wait()</code>æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ä¼šé‡Šæ”¾å ç”¨çš„æ‰€æœ‰èµ„æºï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥â€œç­‰å¾…æ± â€ä¸­ã€‚è¿›å…¥è¿™ä¸ªçŠ¶æ€åï¼Œæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„å¿…é¡»ä¾é å…¶ä»–çº¿ç¨‹è°ƒç”¨<code>notify()</code>æˆ–<code>notifyAll()</code>æ–¹æ³•æ‰èƒ½è¢«å”¤é†’ã€‚</li>
<li>â‘¡. åŒæ­¥é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥â€œé”æ± â€ä¸­ã€‚</li>
<li>â‘¢. å…¶ä»–é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œ<code>sleep()</code>æˆ–<code>join()</code>æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“<code>sleep()</code>çŠ¶æ€è¶…æ—¶ã€<code>join()</code>ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ï¼Œæˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚</li>
</ul>
<p><strong>5ã€æ­»äº¡çŠ¶æ€(Dead)</strong>ï¼šçº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†<code>run()</code>æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚</p>
        <!-- å¼•è¨€çº¿ç¨‹æ± ï¼šå¯ä»¥ç†è§£ä¸ºç¼“å†²åŒºï¼Œç”±äºé¢‘ç¹çš„åˆ›å»ºé”€æ¯çº¿ç¨‹ä¼šå¸¦æ¥ä¸€å®šçš„æˆæœ¬ï¼Œå¯ä»¥é¢„å…ˆåˆ›å»ºä½†ä¸ç«‹å³é”€æ¯ï¼Œä»¥å…±äº«æ–¹å¼ä¸ºåˆ«äººæä¾›æœåŠ¡ï¼Œä¸€æ¥å¯ä»¥æä¾›æ•ˆç‡ï¼Œå†è€…å¯ä»¥æ§åˆ¶çº¿ç¨‹æ— çº¿æ‰©å¼ ã€‚åˆç†åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„ï¼š

é™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚
æé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚
æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»º......  -->
        <p class="article-more-link">
          <a href="2018/02/13/ã€Javaã€‘çº¿ç¨‹æ± ThreadPoolExecutorå®ç°åŸç†/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/æºç åˆ†æ/">æºç åˆ†æ</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Androidã€‘OkHttpæºç åˆ†æ"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/01/25/ã€Androidã€‘OkHttpæºç åˆ†æ/">ã€Androidã€‘OkHttpæºç åˆ†æ</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/01/25/ã€Androidã€‘OkHttpæºç åˆ†æ/" class="article-date">
	  <time datetime="2018-01-25T14:20:55.000Z" itemprop="datePublished">2018-01-25</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a><a class="article-category-link" href="categories/Android/æºç åˆ†æ/">æºç åˆ†æ</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§HTTPäº¤äº’çš„æ–¹å¼ï¼š<a href="https://developer.android.com/reference/java/net/HttpURLConnection.html" target="_blank" rel="noopener">HttpURLConnection</a> å’Œ Apache HttpClientï¼Œè™½ç„¶ä¸¤è€…éƒ½æ”¯æŒHTTPSï¼Œæµçš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé…ç½®è¶…æ—¶ï¼ŒIPv6å’Œè¿æ¥æ± ï¼Œå·²è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬å„ç§HTTPè¯·æ±‚çš„éœ€æ±‚ã€‚ä½†æ›´é«˜æ•ˆçš„ä½¿ç”¨HTTP å¯ä»¥è®©æ‚¨çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€æ›´èŠ‚çœæµé‡ã€‚è€Œ<a href="https://github.com/square/okhttp">OkHttp</a>åº“å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚åœ¨å¼€å§‹åˆ†æOkHttpä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HttpURLConnection å’Œ HttpClient ä¸¤è€…ä¹‹é—´å…³ç³»ï¼Œä»¥åŠå®ƒä»¬å’Œ OkHttp ä¹‹é—´çš„å…³ç³»ã€‚</p>
<h2 id="HttpClient-vs-HttpURLConnection"><a href="#HttpClient-vs-HttpURLConnection" class="headerlink" title="HttpClient vs HttpURLConnection"></a>HttpClient vs HttpURLConnection</h2><p>åœ¨Android API Level 9ï¼ˆAndroid 2.2ï¼‰ä¹‹å‰åªèƒ½ä½¿ç”¨<code>HttpClient</code>ç±»å‘é€httpè¯·æ±‚ã€‚<code>HttpClient</code>æ˜¯Apacheç”¨äºå‘é€httpè¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œå…¶æä¾›äº†å¼ºå¤§çš„APIæ”¯æŒï¼Œè€Œä¸”åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆbugï¼Œä½†æ˜¯ç”±äºå…¶å¤ªè¿‡å¤æ‚ï¼ŒAndroidå›¢é˜Ÿåœ¨ä¿æŒå‘åå…¼å®¹çš„æƒ…å†µä¸‹ï¼Œå¾ˆéš¾å¯¹<code>DefaultHttpClient</code>è¿›è¡Œå¢å¼ºã€‚ä¸ºæ­¤ï¼ŒAndroidå›¢é˜Ÿä»Android API Level 9å¼€å§‹è‡ªå·±å®ç°äº†ä¸€ä¸ªå‘é€httpè¯·æ±‚çš„å®¢æˆ·ç«¯ç±» â€”â€” <code>HttpURLConnection</code>ã€‚</p>
<p>ç›¸æ¯”äº<code>DefaultHttpClient</code>ï¼Œ<code>HttpURLConnection</code>æ¯”è¾ƒè½»é‡çº§ï¼Œè™½ç„¶åŠŸèƒ½æ²¡æœ‰<code>DefaultHttpClient</code>é‚£ä¹ˆå¼ºå¤§ï¼Œä½†æ˜¯èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚ï¼Œæ‰€ä»¥Androidæ¨èä½¿ç”¨<code>HttpURLConnection</code>ä»£æ›¿<code>DefaultHttpClient</code>ï¼Œå¹¶ä¸å¼ºåˆ¶ä½¿ç”¨<code>HttpURLConnection</code>ã€‚</p>
<p><strong>ä½†ä»Android API Level 23ï¼ˆAndroid 6.0ï¼‰å¼€å§‹ï¼Œä¸èƒ½å†åœ¨Androidä¸­ä½¿ç”¨<code>HttpClient</code></strong>ï¼Œå¼ºåˆ¶ä½¿ç”¨<code>HttpURLConnection</code>ã€‚å‚è€ƒå®˜ç½‘ï¼š<a href="https://developer.android.com/about/versions/marshmallow/android-6.0-changes.html" target="_blank" rel="noopener">Android 6.0 Changes - Google Developer</a></p>
<blockquote>
<p>Android 6.0 ç‰ˆç§»é™¤äº†å¯¹ Apache HTTP clientçš„æ”¯æŒã€‚å¦‚æœæ‚¨çš„åº”ç”¨ä½¿ç”¨è¯¥å®¢æˆ·ç«¯ï¼Œå¹¶ä»¥ Android 2.3ï¼ˆAPI level 9ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ä¸ºç›®æ ‡å¹³å°ï¼Œè¯·æ”¹ç”¨ <code>HttpURLConnection</code> ç±»ã€‚æ­¤ API æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºå®ƒå¯ä»¥é€šè¿‡é€æ˜å‹ç¼©å’Œå“åº”ç¼“å­˜å‡å°‘ç½‘ç»œä½¿ç”¨ï¼Œå¹¶å¯æœ€å¤§é™åº¦é™ä½è€—ç”µé‡ã€‚è¦ç»§ç»­ä½¿ç”¨ Apache HTTP APIï¼Œæ‚¨å¿…é¡»å…ˆåœ¨ <code>build.gradle</code> æ–‡ä»¶ä¸­å£°æ˜ä»¥ä¸‹ç¼–è¯‘æ—¶ä¾èµ–é¡¹ï¼š</p>
</blockquote>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    useLibrary <span class="string">'org.apache.http.legacy'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        <!-- Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§HTTPäº¤äº’çš„æ–¹å¼ï¼šHttpURLConnection å’Œ Apache HttpClientï¼Œè™½ç„¶ä¸¤è€…éƒ½æ”¯æŒHTTPSï¼Œæµçš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œé…ç½®è¶…æ—¶ï¼ŒIPv6å’Œè¿æ¥æ± ï¼Œå·²è¶³å¤Ÿæ»¡è¶³æˆ‘ä»¬å„ç§HTTPè¯·æ±‚çš„éœ€æ±‚ã€‚ä½†æ›´é«˜æ•ˆçš„ä½¿ç”¨HTTP å¯ä»¥è®©æ‚¨çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€æ›´èŠ‚çœæµé‡ã€‚è€ŒOkHttpåº“å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚åœ¨å¼€å§‹åˆ†æOkHttpä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ HttpURLConnect......  -->
        <p class="article-more-link">
          <a href="2018/01/25/ã€Androidã€‘OkHttpæºç åˆ†æ/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/æºç åˆ†æ/">æºç åˆ†æ</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/01/22/ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)/">ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/01/22/ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)/" class="article-date">
	  <time datetime="2018-01-22T04:30:55.000Z" itemprop="datePublished">2018-01-22</time>
	</a>

      
    <a class="article-category-link" href="categories/Java/">Java</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="æ–­ç‚¹ç»­ä¼ çš„åŸç†"><a href="#æ–­ç‚¹ç»­ä¼ çš„åŸç†" class="headerlink" title="æ–­ç‚¹ç»­ä¼ çš„åŸç†"></a>æ–­ç‚¹ç»­ä¼ çš„åŸç†</h3><p>å…¶å®æ–­ç‚¹ç»­ä¼ çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ Http çš„è¯·æ±‚ä¸Šå’Œä¸€èˆ¬çš„ä¸‹è½½æœ‰æ‰€ä¸åŒè€Œå·²ã€‚<br>æ‰“ä¸ªæ¯”æ–¹ï¼Œæµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªæ–‡æ—¶ï¼Œæ‰€å‘å‡ºçš„è¯·æ±‚å¦‚ä¸‹ï¼š<br>å‡è®¾æœåŠ¡å™¨åŸŸåä¸º <a href="www.sjtu.edu.cn">www.sjtu.edu.cn</a>ï¼Œæ–‡ä»¶åä¸º down.zipã€‚ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /down.zip HTTP/1.1 </span><br><span class="line">Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms- </span><br><span class="line">excel, application/msword, application/vnd.ms-powerpoint, */* </span><br><span class="line">Accept-Language: zh-cn </span><br><span class="line">Accept-Encoding: gzip, deflate </span><br><span class="line">User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0) </span><br><span class="line">Connection: Keep-Alive</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼ŒæŒ‰è¦æ±‚å¯»æ‰¾è¯·æ±‚çš„æ–‡ä»¶ï¼Œæå–æ–‡ä»¶çš„ä¿¡æ¯ï¼Œç„¶åè¿”å›ç»™æµè§ˆå™¨ï¼Œè¿”å›ä¿¡æ¯å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">200 </span><br><span class="line">Content-Length=106786028 </span><br><span class="line">Accept-Ranges=bytes </span><br><span class="line">Date=Mon, 30 Apr 2001 12:56:11 GMT </span><br><span class="line">ETag=W/&quot;02ca57e173c11:95b&quot; </span><br><span class="line">Content-Type=application/octet-stream </span><br><span class="line">Server=Microsoft-IIS/5.0 </span><br><span class="line">Last-Modified=Mon, 30 Apr 2001 12:56:11 GMT</span><br></pre></td></tr></table></figure></p>
        <!-- æ–­ç‚¹ç»­ä¼ çš„åŸç†å…¶å®æ–­ç‚¹ç»­ä¼ çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ Http çš„è¯·æ±‚ä¸Šå’Œä¸€èˆ¬çš„ä¸‹è½½æœ‰æ‰€ä¸åŒè€Œå·²ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œæµè§ˆå™¨è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªæ–‡æ—¶ï¼Œæ‰€å‘å‡ºçš„è¯·æ±‚å¦‚ä¸‹ï¼šå‡è®¾æœåŠ¡å™¨åŸŸåä¸º www.sjtu.edu.cnï¼Œæ–‡ä»¶åä¸º down.zipã€‚ 
1234567GET /down.zip HTTP/1.1 Accept: image/gif, image/x-xbitmap, image/jpeg, ima......  -->
        <p class="article-more-link">
          <a href="2018/01/22/ç”¨Javaå®ç°æ–­ç‚¹ç»­ä¼  (HTTP)/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/01/18/å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼/">å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/01/18/å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼/" class="article-date">
	  <time datetime="2018-01-18T14:20:55.000Z" itemprop="datePublished">2018-01-18</time>
	</a>

      
    <a class="article-category-link" href="categories/Cè¯­è¨€/">Cè¯­è¨€</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ä¸€ã€æ¦‚å¿µåŠè¯¦è§£"><a href="#ä¸€ã€æ¦‚å¿µåŠè¯¦è§£" class="headerlink" title="ä¸€ã€æ¦‚å¿µåŠè¯¦è§£"></a><strong>ä¸€ã€æ¦‚å¿µåŠè¯¦è§£</strong></h3><p>åœ¨å„ç§ä½“ç³»çš„è®¡ç®—æœºä¸­é€šå¸¸é‡‡ç”¨çš„å­—èŠ‚å­˜å‚¨æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼š <strong>Big-Endian</strong>å’Œ<strong>Little-Endian</strong>ï¼Œå³å¤§ç«¯æ¨¡å¼å’Œå°ç«¯æ¨¡å¼ã€‚</p>
<p>Big-Endianå’ŒLittle-Endiançš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>1) Little-Endianï¼šå°±æ˜¯ä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œé«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚<br>2) Big-Endianï¼šå°±æ˜¯é«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚</p>
<p><img src="/gallery/java-common/20171225094704165.png" alt=""></p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚16è¿›åˆ¶æ•°å­—<code>0x12345678</code>åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºå½¢å¼ä¸ºï¼š</p>
<p><img src="/gallery/java-common/20160905174029957.jpg" alt=""></p>
<p><strong>å¤§ç«¯å°ç«¯æ²¡æœ‰è°ä¼˜è°åŠ£ï¼Œå„è‡ªä¼˜åŠ¿ä¾¿æ˜¯å¯¹æ–¹åŠ£åŠ¿ï¼š</strong></p>
<p>å°ç«¯æ¨¡å¼ ï¼šå¼ºåˆ¶è½¬æ¢æ•°æ®ä¸éœ€è¦è°ƒæ•´å­—èŠ‚å†…å®¹ï¼Œ1ã€2ã€4å­—èŠ‚çš„å­˜å‚¨æ–¹å¼ä¸€æ ·ã€‚<br>å¤§ç«¯æ¨¡å¼ ï¼šç¬¦å·ä½çš„åˆ¤å®šå›ºå®šä¸ºç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå®¹æ˜“åˆ¤æ–­æ­£è´Ÿã€‚</p>
        <!-- ä¸€ã€æ¦‚å¿µåŠè¯¦è§£åœ¨å„ç§ä½“ç³»çš„è®¡ç®—æœºä¸­é€šå¸¸é‡‡ç”¨çš„å­—èŠ‚å­˜å‚¨æœºåˆ¶ä¸»è¦æœ‰ä¸¤ç§ï¼š Big-Endianå’ŒLittle-Endianï¼Œå³å¤§ç«¯æ¨¡å¼å’Œå°ç«¯æ¨¡å¼ã€‚
Big-Endianå’ŒLittle-Endiançš„å®šä¹‰å¦‚ä¸‹ï¼š
1) Little-Endianï¼šå°±æ˜¯ä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œé«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚2) Big-Endianï¼šå°±æ˜¯é«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯......  -->
        <p class="article-more-link">
          <a href="2018/01/18/å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Cè¯­è¨€/">Cè¯­è¨€</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="2018/01/12/ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†/">ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="2018/01/12/ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†/" class="article-date">
	  <time datetime="2018-01-12T14:20:55.000Z" itemprop="datePublished">2018-01-12</time>
	</a>

      
    <a class="article-category-link" href="categories/Android/">Android</a>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥"><a href="#ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥"></a>ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤è¿™ä¸‰ç±»æ“ä½œã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†æƒ³å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ã€‚</p>
<p>å› æ­¤LRU(<strong>Least Recently Used</strong>)ç¼“å­˜ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿï¼ŒLRUæ˜¯è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å½“ç¼“å­˜æ»¡æ—¶ï¼Œä¼šä¼˜å…ˆæ·˜æ±°é‚£äº›è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜å¯¹è±¡ï¼Œæœ‰æ•ˆçš„é¿å…äº†OOMçš„å‡ºç°ã€‚åœ¨Androidä¸­é‡‡ç”¨LRUç®—æ³•çš„å¸¸ç”¨ç¼“å­˜æœ‰ä¸¤ç§ï¼š<a href="https://developer.android.com/reference/android/util/LruCache.html" target="_blank" rel="noopener">LruCache</a>å’ŒDisLruCacheï¼Œåˆ†åˆ«ç”¨äºå®ç°å†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜ï¼Œå…¶æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯LRUç¼“å­˜ç®—æ³•ã€‚</p>
<p>å…¶å®LRUç¼“å­˜çš„å®ç°ç±»ä¼¼äºä¸€ä¸ªç‰¹æ®Šçš„æ ˆï¼ŒæŠŠè®¿é—®è¿‡çš„å…ƒç´ æ”¾ç½®åˆ°æ ˆé¡¶ï¼ˆè‹¥æ ˆä¸­å­˜åœ¨ï¼Œåˆ™æ›´æ–°è‡³æ ˆé¡¶ï¼›è‹¥æ ˆä¸­ä¸å­˜åœ¨åˆ™ç›´æ¥å…¥æ ˆï¼‰ï¼Œç„¶åå¦‚æœæ ˆä¸­å…ƒç´ æ•°é‡è¶…è¿‡é™å®šå€¼ï¼Œåˆ™åˆ é™¤æ ˆåº•å…ƒç´ ï¼ˆå³æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å…ƒç´ ï¼‰ã€‚è¯¦ç»†ç®—æ³•å®ç°å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/1337859321_3597.png" alt=""></p>
<ol>
<li>æ–°æ•°æ®å‹å…¥åˆ°æ ˆé¡¶ï¼›</li>
<li>æ¯å½“ç¼“å­˜å‘½ä¸­ï¼ˆå³ç¼“å­˜æ•°æ®è¢«è®¿é—®ï¼‰ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°æ ˆé¡¶ï¼›</li>
<li>å½“æ ˆæ»¡çš„æ—¶å€™ï¼Œå°†æ ˆåº•çš„æ•°æ®ä¸¢å¼ƒã€‚</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­æ¼”ç¤ºä¸€ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru-timg.jpg" alt=""></p>
<h3 id="äºŒã€LruCacheçš„ä½¿ç”¨"><a href="#äºŒã€LruCacheçš„ä½¿ç”¨" class="headerlink" title="äºŒã€LruCacheçš„ä½¿ç”¨"></a>äºŒã€LruCacheçš„ä½¿ç”¨</h3><p><code>LruCache</code>æ˜¯Android 3.1æ‰€æä¾›çš„ä¸€ä¸ªç¼“å­˜ç±»ï¼Œæ‰€ä»¥åœ¨Androidä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨LruCacheå®ç°å†…å­˜ç¼“å­˜ã€‚è€ŒDisLruCacheç›®å‰åœ¨Android è¿˜ä¸æ˜¯Android SDKçš„ä¸€éƒ¨åˆ†ï¼Œä½†Androidå®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨è¯¥ç®—æ³•æ¥å®ç°ç¡¬ç›˜ç¼“å­˜ã€‚</p>
<p>è®²åˆ°<code>LruCache</code>ä¸å¾—ä¸æä¸€ä¸‹<code>LinkedHashMap</code>ï¼Œå› ä¸ºLruCacheä¸­Lruç®—æ³•çš„å®ç°å°±æ˜¯é€šè¿‡<code>LinkedHashMap</code>æ¥å®ç°çš„ã€‚<code>LinkedHashMap</code>ç»§æ‰¿äº<code>HashMap</code>ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å­˜å‚¨Mapä¸­çš„Entryé¡ºåºå…³ç³»ï¼Œè¿™ç§é¡ºåºæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<strong>LRUé¡ºåº</strong>ï¼Œä¸€ç§æ˜¯<strong>æ’å…¥é¡ºåº</strong>ï¼Œè¿™å¯ä»¥ç”±å…¶æ„é€ å‡½æ•°<code>public LinkedHashMap(int initialCapacity,float loadFactor, boolean accessOrder)</code>çš„æœ€åä¸€ä¸ªå‚æ•°<code>accessOrder</code>æ¥æŒ‡å®šã€‚æ‰€ä»¥ï¼Œå¯¹äºgetã€putã€removeç­‰æ“ä½œï¼Œ<code>LinkedHashMap</code>é™¤äº†è¦åš<code>HashMap</code>åšçš„äº‹æƒ…ï¼Œè¿˜åšäº›è°ƒæ•´Entryé¡ºåºé“¾è¡¨çš„å·¥ä½œã€‚<code>LruCache</code>ä¸­å°†<code>LinkedHashMap</code>çš„é¡ºåºè®¾ç½®ä¸ºLRUé¡ºåºæ¥å®ç°LRUç¼“å­˜ï¼Œæ¯æ¬¡è°ƒç”¨get(ä¹Ÿå°±æ˜¯ä»å†…å­˜ç¼“å­˜ä¸­å–å›¾ç‰‡)ï¼Œåˆ™å°†è¯¥å¯¹è±¡ç§»åˆ°é“¾è¡¨çš„å°¾ç«¯ã€‚è°ƒç”¨putæ’å…¥æ–°çš„å¯¹è±¡ä¹Ÿæ˜¯å­˜å‚¨åœ¨é“¾è¡¨å°¾ç«¯ï¼Œè¿™æ ·å½“å†…å­˜ç¼“å­˜è¾¾åˆ°è®¾å®šçš„æœ€å¤§å€¼æ—¶ï¼Œå°†é“¾è¡¨å¤´éƒ¨çš„å¯¹è±¡ï¼ˆè¿‘æœŸæœ€å°‘ç”¨åˆ°çš„ï¼‰ç§»é™¤ã€‚å…³äºLinkedHashMapè¯¦è§£è¯·å‰å¾€ï¼š<a href="http://www.cnblogs.com/children/archive/2012/10/02/2710624.html" target="_blank" rel="noopener">ç†è§£LinkedHashMap</a></p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru-cache.png" alt=""></p>
        <!-- ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤è¿™ä¸‰ç±»æ“ä½œã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†æƒ³å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ã€‚
å› æ­¤LRU(Least Recently Used)ç¼“å­˜ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿï¼ŒLRUæ˜¯è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ï¼Œå®ƒ......  -->
        <p class="article-more-link">
          <a href="2018/01/12/ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†/#more">é˜…è¯»å…¨æ–‡</a>
        </p>
      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="page-number" href="page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="page/11/">11</a><a class="extend next" rel="next" href="page/2/">ä¸‹ä¸€é¡µ &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2018 iTimeTraveler All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				è®¿å®¢æ•° : <span id="busuanzi_value_site_uv"></span> |  
				è®¿é—®é‡ : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="index.html" class="mobile-nav-link">Home</a>
  
    <a href="archives" class="mobile-nav-link">Archives</a>
  
    <a href="categories" class="mobile-nav-link">Categories</a>
  
    <a href="tags" class="mobile-nav-link">Tags</a>
  
    <a href="funnysite" class="mobile-nav-link">é…·ç«™</a>
  
    <a href="collection" class="mobile-nav-link">æ”¶è—</a>
  
    <a href="about" class="mobile-nav-link">About</a>
  
    <a href="/mybooks" class="mobile-nav-link">ğŸ</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="fancybox/jquery.fancybox.css">
  <script src="fancybox/jquery.fancybox.pack.js"></script>


<script src="js/scripts.js"></script>


  <script src="js/home.js"></script>










	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            iTimeTraveler
          </div>
          <div class="panel-body">
            Copyright Â© 2018 Mr.Seven All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>