<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ã€androidã€‘æºç åˆ†æ - lrucacheç¼“å­˜å®ç°åŸç† | iTimeTraveler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="LinkedHashMap" />
  
  
  
  
  <meta name="description" content="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤è¿™ä¸‰ç±»æ“ä½œã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†æƒ³å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ã€‚ å› æ­¤LRU(Least Recently Used)ç¼“å­˜ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿï¼ŒLRUæ˜¯è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ï¼Œå®ƒçš„æ ¸å¿ƒ">
<meta name="keywords" content="LinkedHashMap">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†">
<meta property="og:url" content="http://github.com/2018/01/12/ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†/index.html">
<meta property="og:site_name" content="iTimeTraveler">
<meta property="og:description" content="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤è¿™ä¸‰ç±»æ“ä½œã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†æƒ³å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ã€‚ å› æ­¤LRU(Least Recently Used)ç¼“å­˜ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿï¼ŒLRUæ˜¯è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ï¼Œå®ƒçš„æ ¸å¿ƒ">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru.png">
<meta property="og:updated_time" content="2018-03-14T08:13:59.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†">
<meta name="twitter:description" content="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤è¿™ä¸‰ç±»æ“ä½œã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†æƒ³å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ã€‚ å› æ­¤LRU(Least Recently Used)ç¼“å­˜ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿï¼ŒLRUæ˜¯è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ï¼Œå®ƒçš„æ ¸å¿ƒ">
<meta name="twitter:image" content="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru.png">
  
    <link rel="alternate" href="/atom.xml" title="iTimeTraveler" type="application/atom+xml">
  

  

  <link rel="icon" href="/gallery/avatar/0.jpg">
  <link rel="apple-touch-icon" href="/gallery/avatar/0.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>
  <script src="../../../../js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="../../../../css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 border-width: 0px;  margin-top: 8px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="62px" height="75px" alt="Hike News" src="/gallery/avatar/0.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="../../../../index.html">é¦–é¡µ</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../archives">å½’æ¡£</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../categories">åˆ†ç±»</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../tags">æ ‡ç­¾</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../funnysite">é…·ç«™</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../collection">æ”¶è—</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../about">å…³äº</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../mybooks">ğŸ</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="è¯·è¾“å…¥å…³é”®è¯..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æ— æ ‡é¢˜)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="../../../../js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru.png" rel="gallery_cjl1nlpiu0064ues6e9ifa3jl">
        <img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru.png" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ã€Androidã€‘æºç åˆ†æ - LRUCacheç¼“å­˜å®ç°åŸç†
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="" class="article-date">
	  <time datetime="2018-01-12T14:20:55.000Z" itemprop="datePublished">2018-01-12</time>
	</a>

      
    <a class="article-category-link" href="../../../../categories/Android/">Android</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥"><a href="#ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥"></a>ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜ç­–ç•¥ä¸»è¦åŒ…å«ç¼“å­˜çš„æ·»åŠ ã€è·å–å’Œåˆ é™¤è¿™ä¸‰ç±»æ“ä½œã€‚å¦‚ä½•æ·»åŠ å’Œè·å–ç¼“å­˜è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦åˆ é™¤ç¼“å­˜å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºä¸ç®¡æ˜¯å†…å­˜ç¼“å­˜è¿˜æ˜¯ç¡¬ç›˜ç¼“å­˜ï¼Œå®ƒä»¬çš„ç¼“å­˜å¤§å°éƒ½æ˜¯æœ‰é™çš„ã€‚å½“ç¼“å­˜æ»¡äº†ä¹‹åï¼Œå†æƒ³å…¶æ·»åŠ ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ é™¤ä¸€äº›æ—§çš„ç¼“å­˜å¹¶æ·»åŠ æ–°çš„ç¼“å­˜ã€‚</p>
<p>å› æ­¤LRU(<strong>Least Recently Used</strong>)ç¼“å­˜ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿï¼ŒLRUæ˜¯è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å½“ç¼“å­˜æ»¡æ—¶ï¼Œä¼šä¼˜å…ˆæ·˜æ±°é‚£äº›è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç¼“å­˜å¯¹è±¡ï¼Œæœ‰æ•ˆçš„é¿å…äº†OOMçš„å‡ºç°ã€‚åœ¨Androidä¸­é‡‡ç”¨LRUç®—æ³•çš„å¸¸ç”¨ç¼“å­˜æœ‰ä¸¤ç§ï¼š<a href="https://developer.android.com/reference/android/util/LruCache.html" target="_blank" rel="noopener">LruCache</a>å’ŒDisLruCacheï¼Œåˆ†åˆ«ç”¨äºå®ç°å†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜ï¼Œå…¶æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯LRUç¼“å­˜ç®—æ³•ã€‚</p>
<p>å…¶å®LRUç¼“å­˜çš„å®ç°ç±»ä¼¼äºä¸€ä¸ªç‰¹æ®Šçš„æ ˆï¼ŒæŠŠè®¿é—®è¿‡çš„å…ƒç´ æ”¾ç½®åˆ°æ ˆé¡¶ï¼ˆè‹¥æ ˆä¸­å­˜åœ¨ï¼Œåˆ™æ›´æ–°è‡³æ ˆé¡¶ï¼›è‹¥æ ˆä¸­ä¸å­˜åœ¨åˆ™ç›´æ¥å…¥æ ˆï¼‰ï¼Œç„¶åå¦‚æœæ ˆä¸­å…ƒç´ æ•°é‡è¶…è¿‡é™å®šå€¼ï¼Œåˆ™åˆ é™¤æ ˆåº•å…ƒç´ ï¼ˆå³æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å…ƒç´ ï¼‰ã€‚è¯¦ç»†ç®—æ³•å®ç°å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/1337859321_3597.png" alt=""></p>
<ol>
<li>æ–°æ•°æ®å‹å…¥åˆ°æ ˆé¡¶ï¼›</li>
<li>æ¯å½“ç¼“å­˜å‘½ä¸­ï¼ˆå³ç¼“å­˜æ•°æ®è¢«è®¿é—®ï¼‰ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°æ ˆé¡¶ï¼›</li>
<li>å½“æ ˆæ»¡çš„æ—¶å€™ï¼Œå°†æ ˆåº•çš„æ•°æ®ä¸¢å¼ƒã€‚</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­æ¼”ç¤ºä¸€ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru-timg.jpg" alt=""></p>
<h3 id="äºŒã€LruCacheçš„ä½¿ç”¨"><a href="#äºŒã€LruCacheçš„ä½¿ç”¨" class="headerlink" title="äºŒã€LruCacheçš„ä½¿ç”¨"></a>äºŒã€LruCacheçš„ä½¿ç”¨</h3><p><code>LruCache</code>æ˜¯Android 3.1æ‰€æä¾›çš„ä¸€ä¸ªç¼“å­˜ç±»ï¼Œæ‰€ä»¥åœ¨Androidä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨LruCacheå®ç°å†…å­˜ç¼“å­˜ã€‚è€ŒDisLruCacheç›®å‰åœ¨Android è¿˜ä¸æ˜¯Android SDKçš„ä¸€éƒ¨åˆ†ï¼Œä½†Androidå®˜æ–¹æ–‡æ¡£æ¨èä½¿ç”¨è¯¥ç®—æ³•æ¥å®ç°ç¡¬ç›˜ç¼“å­˜ã€‚</p>
<p>è®²åˆ°<code>LruCache</code>ä¸å¾—ä¸æä¸€ä¸‹<code>LinkedHashMap</code>ï¼Œå› ä¸ºLruCacheä¸­Lruç®—æ³•çš„å®ç°å°±æ˜¯é€šè¿‡<code>LinkedHashMap</code>æ¥å®ç°çš„ã€‚<code>LinkedHashMap</code>ç»§æ‰¿äº<code>HashMap</code>ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å­˜å‚¨Mapä¸­çš„Entryé¡ºåºå…³ç³»ï¼Œè¿™ç§é¡ºåºæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<strong>LRUé¡ºåº</strong>ï¼Œä¸€ç§æ˜¯<strong>æ’å…¥é¡ºåº</strong>ï¼Œè¿™å¯ä»¥ç”±å…¶æ„é€ å‡½æ•°<code>public LinkedHashMap(int initialCapacity,float loadFactor, boolean accessOrder)</code>çš„æœ€åä¸€ä¸ªå‚æ•°<code>accessOrder</code>æ¥æŒ‡å®šã€‚æ‰€ä»¥ï¼Œå¯¹äºgetã€putã€removeç­‰æ“ä½œï¼Œ<code>LinkedHashMap</code>é™¤äº†è¦åš<code>HashMap</code>åšçš„äº‹æƒ…ï¼Œè¿˜åšäº›è°ƒæ•´Entryé¡ºåºé“¾è¡¨çš„å·¥ä½œã€‚<code>LruCache</code>ä¸­å°†<code>LinkedHashMap</code>çš„é¡ºåºè®¾ç½®ä¸ºLRUé¡ºåºæ¥å®ç°LRUç¼“å­˜ï¼Œæ¯æ¬¡è°ƒç”¨get(ä¹Ÿå°±æ˜¯ä»å†…å­˜ç¼“å­˜ä¸­å–å›¾ç‰‡)ï¼Œåˆ™å°†è¯¥å¯¹è±¡ç§»åˆ°é“¾è¡¨çš„å°¾ç«¯ã€‚è°ƒç”¨putæ’å…¥æ–°çš„å¯¹è±¡ä¹Ÿæ˜¯å­˜å‚¨åœ¨é“¾è¡¨å°¾ç«¯ï¼Œè¿™æ ·å½“å†…å­˜ç¼“å­˜è¾¾åˆ°è®¾å®šçš„æœ€å¤§å€¼æ—¶ï¼Œå°†é“¾è¡¨å¤´éƒ¨çš„å¯¹è±¡ï¼ˆè¿‘æœŸæœ€å°‘ç”¨åˆ°çš„ï¼‰ç§»é™¤ã€‚å…³äºLinkedHashMapè¯¦è§£è¯·å‰å¾€ï¼š<a href="http://www.cnblogs.com/children/archive/2012/10/02/2710624.html" target="_blank" rel="noopener">ç†è§£LinkedHashMap</a></p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/lru-cache.png" alt=""></p>
<a id="more"></a>
<h4 id="LruCacheä½¿ç”¨ç¤ºä¾‹"><a href="#LruCacheä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="LruCacheä½¿ç”¨ç¤ºä¾‹"></a>LruCacheä½¿ç”¨ç¤ºä¾‹</h4><p>LruCacheçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å°±ä»¥å›¾ç‰‡ç¼“å­˜ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> maxMemory = (<span class="keyword">int</span>) (Runtime.getRuntime().totalMemory()/<span class="number">1024</span>);</span><br><span class="line"><span class="keyword">int</span> cacheSize = maxMemory/<span class="number">8</span>;</span><br><span class="line">mMemoryCache = <span class="keyword">new</span> LruCache&lt;String,Bitmap&gt;(cacheSize)&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value.getRowBytes()*value.getHeight()/<span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â‘  è®¾ç½®LruCacheç¼“å­˜çš„å¤§å°ï¼Œä¸€èˆ¬ä¸ºå½“å‰è¿›ç¨‹å¯ç”¨å®¹é‡çš„1/8ã€‚<br>â‘¡ é‡å†™sizeOfæ–¹æ³•ï¼Œè®¡ç®—å‡ºè¦ç¼“å­˜çš„æ¯å¼ å›¾ç‰‡çš„å¤§å°ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>ç¼“å­˜çš„æ€»å®¹é‡å’Œæ¯ä¸ªç¼“å­˜å¯¹è±¡çš„å¤§å°æ‰€ç”¨å•ä½è¦ä¸€è‡´ã€‚</p>
<h4 id="LruCacheçš„å®ç°åŸç†"><a href="#LruCacheçš„å®ç°åŸç†" class="headerlink" title="LruCacheçš„å®ç°åŸç†"></a>LruCacheçš„å®ç°åŸç†</h4><p>LruCacheçš„æ ¸å¿ƒæ€æƒ³å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è¦ç»´æŠ¤ä¸€ä¸ªç¼“å­˜å¯¹è±¡åˆ—è¡¨ï¼Œå…¶ä¸­å¯¹è±¡åˆ—è¡¨çš„æ’åˆ—æ–¹å¼æ˜¯æŒ‰ç…§è®¿é—®é¡ºåºå®ç°çš„ï¼Œå³ä¸€ç›´æ²¡è®¿é—®çš„å¯¹è±¡ï¼Œå°†æ”¾åœ¨é˜Ÿå°¾ï¼Œå³å°†è¢«æ·˜æ±°ã€‚è€Œæœ€è¿‘è®¿é—®çš„å¯¹è±¡å°†æ”¾åœ¨é˜Ÿå¤´ï¼Œæœ€åè¢«æ·˜æ±°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/algorithms/3985563-33560a9500e72780.png" alt=""></p>
<p>é‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—åˆ°åº•æ˜¯ç”±è°æ¥ç»´æŠ¤çš„ï¼Œå‰é¢å·²ç»ä»‹ç»äº†æ˜¯ç”±LinkedHashMapæ¥ç»´æŠ¤ã€‚</p>
<p>è€ŒLinkedHashMapæ˜¯ç”±æ•°ç»„+åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚å…¶ä¸­åŒå‘é“¾è¡¨çš„ç»“æ„å¯ä»¥å®ç°è®¿é—®é¡ºåºå’Œæ’å…¥é¡ºåºï¼Œä½¿å¾—LinkedHashMapä¸­çš„<code>&lt;key,value&gt;</code>å¯¹æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—èµ·æ¥ã€‚</p>
<p>é€šè¿‡ä¸‹é¢æ„é€ å‡½æ•°æ¥æŒ‡å®šLinkedHashMapä¸­åŒå‘é“¾è¡¨çš„ç»“æ„æ˜¯è®¿é—®é¡ºåºè¿˜æ˜¯æ’å…¥é¡ºåºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a new &#123;<span class="doctag">@code</span> LinkedHashMap&#125; instance with the specified</span></span><br><span class="line"><span class="comment"> * capacity, load factor and a flag specifying the ordering behavior.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialCapacity</span></span><br><span class="line"><span class="comment"> *            the initial capacity of this hash map.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loadFactor</span></span><br><span class="line"><span class="comment"> *            the initial load factor.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> accessOrder</span></span><br><span class="line"><span class="comment"> *            &#123;<span class="doctag">@code</span> true&#125; if the ordering should be done based on the last</span></span><br><span class="line"><span class="comment"> *            access (from least-recently accessed to most-recently</span></span><br><span class="line"><span class="comment"> *            accessed), and &#123;<span class="doctag">@code</span> false&#125; if the ordering should be the</span></span><br><span class="line"><span class="comment"> *            order in which the entries were inserted.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> accessOrder)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(initialCapacity, loadFactor);</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">this</span>.accessOrder = accessOrder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>accessOrder</code>è®¾ç½®ä¸ºtrueåˆ™ä¸º<strong>è®¿é—®é¡ºåº</strong>ï¼Œä¸ºfalseï¼Œåˆ™ä¸º<strong>æ’å…¥é¡ºåº</strong>ã€‚</p>
<p>ä»¥å…·ä½“ä¾‹å­è§£é‡Šï¼Œå½“è®¾ç½®ä¸ºtrueæ—¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LinkedHashMap&lt;Integer, Integer&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">0</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">    map.put(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    map.put(<span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line">    map.put(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    map.put(<span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line">    map.put(<span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">    map.get(<span class="number">1</span>);		<span class="comment">//è®¿é—®1</span></span><br><span class="line">    map.get(<span class="number">2</span>);		<span class="comment">//è®¿é—®2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        System.out.println(entry.getKey() + <span class="string">":"</span> + entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>0:0<br>3:3<br>4:4<br>5:5<br>6:6<br>1:1<br>2:2</p>
</blockquote>
<p>å³æœ€è¿‘è®¿é—®çš„å¯¹è±¡ä¼šè¢«æ”¾åˆ°é˜Ÿå°¾ï¼Œç„¶åæœ€åè¾“å‡ºï¼Œé‚£ä¹ˆè¿™å°±æ­£å¥½æ»¡è¶³çš„LRUç¼“å­˜ç®—æ³•çš„æ€æƒ³ã€‚<strong>å¯è§LruCacheå·§å¦™å®ç°ï¼Œå°±æ˜¯åˆ©ç”¨äº†LinkedHashMapçš„è¿™ç§æ•°æ®ç»“æ„ã€‚</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬åœ¨LruCacheæºç ä¸­å…·ä½“çœ‹çœ‹ï¼Œæ€ä¹ˆåº”ç”¨LinkedHashMapæ¥å®ç°ç¼“å­˜çš„æ·»åŠ ï¼Œè·å¾—å’Œåˆ é™¤çš„ã€‚</p>
<h3 id="LruCacheæºç åˆ†æ"><a href="#LruCacheæºç åˆ†æ" class="headerlink" title="LruCacheæºç åˆ†æ"></a>LruCacheæºç åˆ†æ</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹æˆå‘˜å˜é‡æœ‰å“ªäº›ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LruCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LinkedHashMap&lt;K, V&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Size of this cache in units. Not necessarily the number of elements. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;	<span class="comment">//å½“å‰cacheçš„å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxSize;	 <span class="comment">//cacheæœ€å¤§å¤§å°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> putCount;		<span class="comment">//putçš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> createCount;	<span class="comment">//createçš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> evictionCount;	<span class="comment">//é©±é€å‰”é™¤çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hitCount;		<span class="comment">//å‘½ä¸­çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> missCount;		<span class="comment">//æœªå‘½ä¸­æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//...çœç•¥...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å‡½æ•°å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°LruCacheæ­£æ˜¯ç”¨äº†LinkedHashMapçš„<code>accessOrder=true</code>æ„é€ å‚æ•°å®ç°LRUè®¿é—®é¡ºåºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LruCache</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (maxSize &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"maxSize &lt;= 0"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">    <span class="comment">//å°†LinkedHashMapçš„accessOrderè®¾ç½®ä¸ºtrueæ¥å®ç°LRUé¡ºåº</span></span><br><span class="line">    <span class="keyword">this</span>.map = <span class="keyword">new</span> LinkedHashMap&lt;K, V&gt;(<span class="number">0</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="putæ–¹æ³•"><a href="#putæ–¹æ³•" class="headerlink" title="putæ–¹æ³•"></a>putæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ä¸å¯ä¸ºç©ºï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"key == null || value == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    V previous;	<span class="comment">//æ—§å€¼</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        putCount++;		<span class="comment">//æ’å…¥æ¬¡æ•°åŠ 1</span></span><br><span class="line">        size += safeSizeOf(key, value);		<span class="comment">//æ›´æ–°ç¼“å­˜çš„å¤§å°</span></span><br><span class="line">        previous = map.put(key, value);</span><br><span class="line">        <span class="comment">//å¦‚æœå·²æœ‰ç¼“å­˜å¯¹è±¡ï¼Œåˆ™ç¼“å­˜å¤§å°çš„å€¼éœ€è¦å‰”é™¤è¿™ä¸ªæ—§çš„å¤§å°</span></span><br><span class="line">        <span class="keyword">if</span> (previous != <span class="keyword">null</span>) &#123;</span><br><span class="line">            size -= safeSizeOf(key, previous);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//entryRemoved()æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œå¯ä»¥è‡ªè¡Œå®ç°</span></span><br><span class="line">    <span class="keyword">if</span> (previous != <span class="keyword">null</span>) &#123;</span><br><span class="line">        entryRemoved(<span class="keyword">false</span>, key, previous, value);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">//è°ƒæ•´ç¼“å­˜å¤§å°(å…³é”®æ–¹æ³•)</span></span><br><span class="line">    trimToSize(maxSize);</span><br><span class="line">    <span class="keyword">return</span> previous;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°put()æ–¹æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆéš¾ç‚¹ï¼Œé‡è¦çš„å°±æ˜¯åœ¨æ·»åŠ è¿‡ç¼“å­˜å¯¹è±¡åï¼Œè°ƒç”¨<code>trimToSize()</code>æ–¹æ³•ï¼Œæ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ»¡äº†å°±è¦åˆ é™¤è¿‘æœŸæœ€å°‘ä½¿ç”¨çš„ç®—æ³•ã€‚</p>
<h4 id="trimToSizeæ–¹æ³•"><a href="#trimToSizeæ–¹æ³•" class="headerlink" title="trimToSizeæ–¹æ³•"></a>trimToSizeæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trimToSize</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        K key;</span><br><span class="line">        V value;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœmapä¸ºç©ºå¹¶ä¸”ç¼“å­˜sizeä¸ç­‰äº0æˆ–è€…ç¼“å­˜sizeå°äº0ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (size &lt; <span class="number">0</span> || (map.isEmpty() &amp;&amp; size != <span class="number">0</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(getClass().getName()</span><br><span class="line">                        + <span class="string">".sizeOf() is reporting inconsistent results!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">//å¦‚æœç¼“å­˜å¤§å°sizeå°äºæœ€å¤§ç¼“å­˜ï¼Œæˆ–è€…mapä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦å†åˆ é™¤ç¼“å­˜å¯¹è±¡ï¼Œè·³å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (size &lt;= maxSize || map.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">//è¿­ä»£å™¨è·å–ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼Œå³é˜Ÿå¤´çš„å…ƒç´ ï¼Œè¿‘æœŸæœ€å°‘è®¿é—®çš„å…ƒç´ </span></span><br><span class="line">            Map.Entry&lt;K, V&gt; toEvict = map.entrySet().iterator().next();</span><br><span class="line">            key = toEvict.getKey();</span><br><span class="line">            value = toEvict.getValue();</span><br><span class="line">            <span class="comment">//åˆ é™¤è¯¥å¯¹è±¡ï¼Œå¹¶æ›´æ–°ç¼“å­˜å¤§å°</span></span><br><span class="line">            map.remove(key);</span><br><span class="line">            size -= safeSizeOf(key, value);</span><br><span class="line">            evictionCount++;</span><br><span class="line">        &#125;</span><br><span class="line">        entryRemoved(<span class="keyword">true</span>, key, value, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>trimToSize()</code>æ–¹æ³•ä¸æ–­åœ°åˆ é™¤<code>LinkedHashMap</code>ä¸­é˜Ÿå¤´çš„å…ƒç´ ï¼Œå³è¿‘æœŸæœ€å°‘è®¿é—®çš„ï¼Œç›´åˆ°ç¼“å­˜å¤§å°å°äºæœ€å¤§å€¼ã€‚</p>
<p>å½“è°ƒç”¨LruCacheçš„<code>get()</code>æ–¹æ³•è·å–é›†åˆä¸­çš„ç¼“å­˜å¯¹è±¡æ—¶ï¼Œå°±ä»£è¡¨è®¿é—®äº†ä¸€æ¬¡è¯¥å…ƒç´ ï¼Œå°†ä¼šæ›´æ–°é˜Ÿåˆ—ï¼Œä¿æŒæ•´ä¸ªé˜Ÿåˆ—æ˜¯æŒ‰ç…§è®¿é—®é¡ºåºæ’åºã€‚è¿™ä¸ªæ›´æ–°è¿‡ç¨‹å°±æ˜¯åœ¨<code>LinkedHashMap</code>ä¸­çš„<code>get()</code>æ–¹æ³•ä¸­å®Œæˆçš„ã€‚</p>
<p>æˆ‘ä»¬å…ˆçœ‹LruCacheçš„get()æ–¹æ³•ã€‚</p>
<h4 id="getæ–¹æ³•"><a href="#getæ–¹æ³•" class="headerlink" title="getæ–¹æ³•"></a>getæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//LruCacheçš„get()æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">get</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"key == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    V mapValue;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="comment">//è·å–å¯¹åº”çš„ç¼“å­˜å¯¹è±¡</span></span><br><span class="line">        <span class="comment">//LinkedHashMapçš„get()æ–¹æ³•ä¼šå®ç°å°†è®¿é—®çš„å…ƒç´ æ›´æ–°åˆ°é˜Ÿåˆ—å°¾éƒ¨çš„åŠŸèƒ½</span></span><br><span class="line">        mapValue = map.get(key);</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//mapValueä¸ä¸ºç©ºè¡¨ç¤ºå‘½ä¸­ï¼ŒhitCount+1å¹¶è¿”å›mapValueå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (mapValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">            hitCount++;</span><br><span class="line">            <span class="keyword">return</span> mapValue;</span><br><span class="line">        &#125;</span><br><span class="line">        missCount++;	<span class="comment">//æœªå‘½ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Attempt to create a value. This may take a long time, and the map</span></span><br><span class="line"><span class="comment">     * may be different when create() returns. If a conflicting value was</span></span><br><span class="line"><span class="comment">     * added to the map while create() was working, we leave that value in</span></span><br><span class="line"><span class="comment">     * the map and release the created value.</span></span><br><span class="line"><span class="comment">     * å¦‚æœæœªå‘½ä¸­ï¼Œåˆ™è¯•å›¾åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œcreateæ–¹æ³•é»˜è®¤è¿”å›null,å¹¶æ²¡æœ‰å®ç°åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     * å¦‚æœéœ€è¦äº‹é¡¹åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•å¯ä»¥é‡å†™createæ–¹æ³•ã€‚å› ä¸ºå›¾ç‰‡ç¼“å­˜æ—¶å†…å­˜ç¼“å­˜æ²¡æœ‰å‘½ä¸­ä¼šå»</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ç¼“å­˜ä¸­å»å–æˆ–è€…ä»ç½‘ç»œä¸‹è½½ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦åˆ›å»ºï¼Œä¸‹é¢çš„å°±ä¸ç”¨çœ‹äº†ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    V createdValue = create(key);</span><br><span class="line">    <span class="keyword">if</span> (createdValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//å‡å¦‚åˆ›å»ºäº†æ–°çš„å¯¹è±¡ï¼Œåˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        createCount++;</span><br><span class="line">        <span class="comment">//å°†createdValueåŠ å…¥åˆ°mapä¸­ï¼Œå¹¶ä¸”å°†åŸæ¥é”®ä¸ºkeyçš„å¯¹è±¡ä¿å­˜åˆ°mapValue</span></span><br><span class="line">        mapValue = map.put(key, createdValue);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mapValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// There was a conflict so undo that last put</span></span><br><span class="line">            <span class="comment">//å¦‚æœmapValueä¸ä¸ºç©ºï¼Œåˆ™æ’¤é”€ä¸Šä¸€æ­¥çš„putæ“ä½œã€‚</span></span><br><span class="line">            map.put(key, mapValue);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//åŠ å…¥æ–°åˆ›å»ºçš„å¯¹è±¡ä¹‹åéœ€è¦é‡æ–°è®¡ç®—sizeå¤§å°</span></span><br><span class="line">            size += safeSizeOf(key, createdValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mapValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">        entryRemoved(<span class="keyword">false</span>, key, createdValue, mapValue);</span><br><span class="line">        <span class="keyword">return</span> mapValue;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æ¯æ¬¡æ–°åŠ å…¥å¯¹è±¡éƒ½éœ€è¦è°ƒç”¨trimToSizeæ–¹æ³•çœ‹æ˜¯å¦éœ€è¦å›æ”¶</span></span><br><span class="line">        trimToSize(maxSize);</span><br><span class="line">        <span class="keyword">return</span> createdValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­LinkedHashMapçš„get()æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//LinkedHashMapä¸­çš„getæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//å®ç°æ’åºçš„å…³é”®æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (accessOrder)</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">    <span class="keyword">return</span> e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨çš„afterNodeAccess()æ–¹æ³•å°†è¯¥å…ƒç´ ç§»åˆ°é˜Ÿå°¾ï¼Œä¿è¯æœ€åæ‰åˆ é™¤ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; e)</span> </span>&#123; <span class="comment">// move node to last</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">    <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">        p.after = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (b == <span class="keyword">null</span>)</span><br><span class="line">            head = a;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            b.after = a;</span><br><span class="line">        <span class="keyword">if</span> (a != <span class="keyword">null</span>)</span><br><span class="line">            a.before = b;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            last = b;</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>)</span><br><span class="line">            head = p;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p.before = last;</span><br><span class="line">            last.after = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å½“å‰èŠ‚ç‚¹pç§»åŠ¨åˆ°å°¾éƒ¨ä¹‹åï¼Œå°¾éƒ¨æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">        tail = p;</span><br><span class="line">        ++modCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å¯è§<code>LruCache</code>ä¸­ç»´æŠ¤äº†ä¸€ä¸ªé›†åˆ<code>LinkedHashMap</code>ï¼Œè¯¥<code>LinkedHashMap</code>æ˜¯ä»¥è®¿é—®é¡ºåºæ’åºçš„ã€‚å½“è°ƒç”¨<code>put()</code>æ–¹æ³•æ—¶ï¼Œå°±ä¼šåœ¨ç»“åˆä¸­æ·»åŠ å…ƒç´ ï¼Œå¹¶è°ƒç”¨<code>trimToSize()</code>åˆ¤æ–­ç¼“å­˜æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœæ»¡äº†å°±ç”¨<code>LinkedHashMap</code>çš„è¿­ä»£å™¨åˆ é™¤é˜Ÿå¤´å…ƒç´ ï¼Œå³è¿‘æœŸæœ€å°‘è®¿é—®çš„å…ƒç´ ã€‚å½“è°ƒç”¨get()æ–¹æ³•è®¿é—®ç¼“å­˜å¯¹è±¡æ—¶ï¼Œå°±ä¼šè°ƒç”¨<code>LinkedHashMap</code>çš„<code>get()</code>æ–¹æ³•è·å¾—å¯¹åº”é›†åˆå…ƒç´ ï¼ŒåŒæ—¶ä¼šæ›´æ–°è¯¥å…ƒç´ åˆ°é˜Ÿå°¾ã€‚</p>
<p>ä»¥ä¸Šä¾¿æ˜¯LruCacheå®ç°çš„åŸç†ï¼Œç†è§£äº†LinkedHashMapçš„æ•°æ®ç»“æ„å°±èƒ½ç†è§£æ•´ä¸ªåŸç†ã€‚å¦‚æœä¸æ‡‚ï¼Œå¯ä»¥å…ˆçœ‹çœ‹LinkedHashMapçš„å…·ä½“å®ç°ã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="http://www.cnblogs.com/liuling/p/2015-9-24-1.html" target="_blank" rel="noopener">å†…å­˜ç¼“å­˜LruCacheå®ç°åŸç†</a></li>
<li><a href="https://www.jianshu.com/p/b49a111147ee" target="_blank" rel="noopener">å½»åº•è§£æAndroidç¼“å­˜æœºåˆ¶â€”â€”LruCache</a></li>
<li><a href="http://flychao88.iteye.com/blog/1977653" target="_blank" rel="noopener">ç¼“å­˜æ·˜æ±°ç®—æ³•â€“LRUç®—æ³•</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="../../../../js/vdonate.js"></script>
<script>
var a = new Donate({
  title: 'å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæ ‡é¢˜
  btnText: 'æ‰“èµæ”¯æŒ', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæŒ‰é’®æ–‡å­—
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../18/å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          å¦‚ä½•åˆ¤æ–­CPUæ˜¯å¤§ç«¯è¿˜æ˜¯å°ç«¯æ¨¡å¼
        
      </div>
    </a>
  
  
    <a href="../../../../2017/12/31/ã€ç®—æ³•ã€‘å­—ç¬¦ä¸²å¾ªç¯ç§»ä½åæ˜¯å¦å¯åŒ…å«/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ã€ç®—æ³•ã€‘å­—ç¬¦ä¸²å¾ªç¯ç§»ä½åæ˜¯å¦å¯åŒ…å«</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥"><span class="nav-number">1.</span> <span class="nav-text">ä¸€ã€Androidä¸­çš„ç¼“å­˜ç­–ç•¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#äºŒã€LruCacheçš„ä½¿ç”¨"><span class="nav-number">2.</span> <span class="nav-text">äºŒã€LruCacheçš„ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LruCacheä½¿ç”¨ç¤ºä¾‹"><span class="nav-number">2.1.</span> <span class="nav-text">LruCacheä½¿ç”¨ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LruCacheçš„å®ç°åŸç†"><span class="nav-number">2.2.</span> <span class="nav-text">LruCacheçš„å®ç°åŸç†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LruCacheæºç åˆ†æ"><span class="nav-number">3.</span> <span class="nav-text">LruCacheæºç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#putæ–¹æ³•"><span class="nav-number">3.1.</span> <span class="nav-text">putæ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#trimToSizeæ–¹æ³•"><span class="nav-number">3.2.</span> <span class="nav-text">trimToSizeæ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getæ–¹æ³•"><span class="nav-number">3.3.</span> <span class="nav-text">getæ–¹æ³•</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚è€ƒèµ„æ–™"><span class="nav-number">4.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2018 iTimeTraveler All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				è®¿å®¢æ•° : <span id="busuanzi_value_site_uv"></span> |  
				è®¿é—®é‡ : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="../../../../funnysite" class="mobile-nav-link">é…·ç«™</a>
  
    <a href="../../../../collection" class="mobile-nav-link">æ”¶è—</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
    <a href="../../../../mybooks" class="mobile-nav-link">ğŸ</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/scripts.js"></script>




  <script src="../../../../js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            iTimeTraveler
          </div>
          <div class="panel-body">
            Copyright Â© 2018 Mr.Seven All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>