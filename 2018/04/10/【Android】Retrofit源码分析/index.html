<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ã€androidã€‘retrofitæºç åˆ†æ | iTimeTraveler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="Retrofit" />
  
  
  
  
  <meta name="description" content="Retrofitç®€ä»‹retrofit n. å¼æ ·ç¿»æ–°ï¼ŒèŠ±æ ·ç¿»æ–°      vt. ç»™æœºå™¨è®¾å¤‡è£…é…ï¼ˆæ–°éƒ¨ä»¶ï¼‰ï¼Œç¿»æ–°ï¼Œæ”¹å‹ Retrofit æ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¯´å®ƒæ˜¯ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œä¸»è¦åŸå› åœ¨äºç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¹¶ä¸æ˜¯ Retrofit æ¥å®Œæˆçš„ã€‚Retrofit 2.0 å¼€å§‹å†…ç½® OkHttpï¼Œå‰è€…ä¸“æ³¨äºæ¥å£çš„å°è£…ï¼Œåè€…ä¸“æ³¨äºçœŸæ­£çš„ç½‘ç»œè¯·æ±‚ã€‚å³é€šè¿‡ å¤§">
<meta name="keywords" content="Retrofit">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€Androidã€‘Retrofitæºç åˆ†æ">
<meta property="og:url" content="http://github.com/2018/04/10/ã€Androidã€‘Retrofitæºç åˆ†æ/index.html">
<meta property="og:site_name" content="iTimeTraveler">
<meta property="og:description" content="Retrofitç®€ä»‹retrofit n. å¼æ ·ç¿»æ–°ï¼ŒèŠ±æ ·ç¿»æ–°      vt. ç»™æœºå™¨è®¾å¤‡è£…é…ï¼ˆæ–°éƒ¨ä»¶ï¼‰ï¼Œç¿»æ–°ï¼Œæ”¹å‹ Retrofit æ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¯´å®ƒæ˜¯ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œä¸»è¦åŸå› åœ¨äºç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¹¶ä¸æ˜¯ Retrofit æ¥å®Œæˆçš„ã€‚Retrofit 2.0 å¼€å§‹å†…ç½® OkHttpï¼Œå‰è€…ä¸“æ³¨äºæ¥å£çš„å°è£…ï¼Œåè€…ä¸“æ³¨äºçœŸæ­£çš„ç½‘ç»œè¯·æ±‚ã€‚å³é€šè¿‡ å¤§">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/retrofit.jpg">
<meta property="og:updated_time" content="2018-04-13T10:47:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€Androidã€‘Retrofitæºç åˆ†æ">
<meta name="twitter:description" content="Retrofitç®€ä»‹retrofit n. å¼æ ·ç¿»æ–°ï¼ŒèŠ±æ ·ç¿»æ–°      vt. ç»™æœºå™¨è®¾å¤‡è£…é…ï¼ˆæ–°éƒ¨ä»¶ï¼‰ï¼Œç¿»æ–°ï¼Œæ”¹å‹ Retrofit æ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¯´å®ƒæ˜¯ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œä¸»è¦åŸå› åœ¨äºç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¹¶ä¸æ˜¯ Retrofit æ¥å®Œæˆçš„ã€‚Retrofit 2.0 å¼€å§‹å†…ç½® OkHttpï¼Œå‰è€…ä¸“æ³¨äºæ¥å£çš„å°è£…ï¼Œåè€…ä¸“æ³¨äºçœŸæ­£çš„ç½‘ç»œè¯·æ±‚ã€‚å³é€šè¿‡ å¤§">
<meta name="twitter:image" content="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/retrofit.jpg">
  
    <link rel="alternate" href="/atom.xml" title="iTimeTraveler" type="application/atom+xml">
  

  

  <link rel="icon" href="/gallery/avatar/0.jpg">
  <link rel="apple-touch-icon" href="/gallery/avatar/0.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>
  <script src="../../../../js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="../../../../css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css" >
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 border-width: 0px;  margin-top: 8px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="62px" height="75px" alt="Hike News" src="/gallery/avatar/0.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="../../../../index.html">é¦–é¡µ</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../archives">å½’æ¡£</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../categories">åˆ†ç±»</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../tags">æ ‡ç­¾</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../funnysite">é…·ç«™</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../collection">æ”¶è—</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../about">å…³äº</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../mybooks">ğŸ</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="è¯·è¾“å…¥å…³é”®è¯..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æ— æ ‡é¢˜)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="../../../../js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-ã€Androidã€‘Retrofitæºç åˆ†æ" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
<div class="article-gallery">
  <div class="article-gallery-photos">
    
      <a class="article-gallery-img fancybox" href="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/retrofit.jpg" rel="gallery_cjs6ynt83005jzf45oep6s2ey">
        <img src="https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/master/gallery/android_common/retrofit.jpg" itemprop="image">
      </a>
    
  </div>
</div>

    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      ã€Androidã€‘Retrofitæºç åˆ†æ
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="" class="article-date">
	  <time datetime="2018-04-10T14:20:55.000Z" itemprop="datePublished">2018-04-10</time>
	</a>

      
    <a class="article-category-link" href="../../../../categories/Android/">Android</a><a class="article-category-link" href="../../../../categories/Android/æºç åˆ†æ/">æºç åˆ†æ</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Retrofitç®€ä»‹"><a href="#Retrofitç®€ä»‹" class="headerlink" title="Retrofitç®€ä»‹"></a>Retrofitç®€ä»‹</h3><p><code>retrofit</code> n. å¼æ ·ç¿»æ–°ï¼ŒèŠ±æ ·ç¿»æ–°      vt. ç»™æœºå™¨è®¾å¤‡è£…é…ï¼ˆæ–°éƒ¨ä»¶ï¼‰ï¼Œç¿»æ–°ï¼Œæ”¹å‹</p>
<p><a href="http://square.github.io/retrofit/" target="_blank" rel="noopener"><strong>Retrofit</strong></a> æ˜¯ä¸€ä¸ª RESTful çš„ HTTP ç½‘ç»œè¯·æ±‚æ¡†æ¶çš„å°è£…ã€‚æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰è¯´å®ƒæ˜¯ç½‘ç»œè¯·æ±‚æ¡†æ¶ï¼Œä¸»è¦åŸå› åœ¨äºç½‘ç»œè¯·æ±‚çš„å·¥ä½œå¹¶ä¸æ˜¯ <code>Retrofit</code> æ¥å®Œæˆçš„ã€‚<code>Retrofit</code> 2.0 å¼€å§‹å†…ç½® <a href="http://square.github.io/okhttp/" target="_blank" rel="noopener"><code>OkHttp</code></a>ï¼Œå‰è€…ä¸“æ³¨äºæ¥å£çš„å°è£…ï¼Œåè€…ä¸“æ³¨äºçœŸæ­£çš„ç½‘ç»œè¯·æ±‚ã€‚å³é€šè¿‡ å¤§é‡çš„è®¾è®¡æ¨¡å¼ å°è£…äº† <code>OkHttp</code> ï¼Œä½¿å¾—ç®€æ´æ˜“ç”¨ã€‚</p>
<p><img src="/gallery/android_common/4182937778-57515297dacff_articlex.png" alt=""></p>
<p>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€šè¿‡ <code>Retrofit</code> è¯·æ±‚ç½‘ç»œï¼Œå®é™…ä¸Šæ˜¯ä½¿ç”¨ <code>Retrofit</code> æ¥å£å±‚å°è£…è¯·æ±‚å‚æ•°ã€Headerã€Url ç­‰ä¿¡æ¯ï¼Œä¹‹åç”± <code>OkHttp</code>å®Œæˆåç»­çš„è¯·æ±‚æ“ä½œï¼Œåœ¨æœåŠ¡ç«¯è¿”å›æ•°æ®ä¹‹åï¼Œ<code>OkHttp</code> å°†åŸå§‹çš„ç»“æœäº¤ç»™ <code>Retrofit</code>ï¼Œåè€…æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å¯¹ç»“æœè¿›è¡Œè§£æçš„è¿‡ç¨‹ã€‚Retrofitçš„å¤§æ¦‚åŸç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>Retrofit</code> å°† <code>Http</code>è¯·æ±‚ æŠ½è±¡ æˆ <code>Java</code>æ¥å£</li>
<li>åœ¨æ¥å£é‡Œç”¨ æ³¨è§£ æè¿°å’Œé…ç½® ç½‘ç»œè¯·æ±‚å‚æ•°</li>
<li>ç”¨åŠ¨æ€ä»£ç† çš„æ–¹å¼ï¼ŒåŠ¨æ€å°†ç½‘ç»œè¯·æ±‚æ¥å£çš„æ³¨è§£ è§£æ æˆ<code>HTTP</code>è¯·æ±‚</li>
<li>æœ€åæ‰§è¡Œ<code>HTTP</code>è¯·æ±‚</li>
</ol>
<p>è¿™ç¯‡æ–‡ç« æˆ‘å°†ä»Retrofitçš„åŸºæœ¬ç”¨æ³•å‡ºå‘ï¼ŒæŒ‰ç…§å…¶ä½¿ç”¨æ­¥éª¤ï¼Œä¸€æ­¥æ­¥çš„æ¢ç©¶Retrofitçš„å®ç°åŸç†åŠå…¶æºç çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>Retrofit Github: <a href="https://github.com/square/retrofit">https://github.com/square/retrofit</a></p>
<h3 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h3><p>ä½¿ç”¨ <code>Retrofit</code> éå¸¸ç®€å•ï¼Œé¦–å…ˆéœ€è¦åœ¨ build.gradle ä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:retrofit:2.4.0'</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦ä½¿ç”¨Gsonè§£æå™¨ï¼Œä¹Ÿéœ€è¦åœ¨build.gradleä¸­æ·»åŠ ä¾èµ–ï¼ˆåæ–‡ä¼šè¯¦ç»†è®²åˆ°Retrofitçš„Converterï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">'com.squareup.retrofit2:converter-gson:2.0.2'</span></span><br></pre></td></tr></table></figure>
<h4 id="1-å®šä¹‰Interface"><a href="#1-å®šä¹‰Interface" class="headerlink" title="1. å®šä¹‰Interface"></a>1. å®šä¹‰Interface</h4><p>Retrofitä½¿ç”¨java interfaceå’Œæ³¨è§£æè¿°äº†HTTPè¯·æ±‚çš„APIå‚æ•°ï¼Œæ¯”å¦‚Githubçš„ä¸€ä¸ªAPIï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>&#123;</span><br><span class="line">  <span class="meta">@GET</span>(<span class="string">"users/&#123;user&#125;/repos"</span>)</span><br><span class="line">  Call&lt;List&lt;Repo&gt;&gt; listRepos(<span class="meta">@Path</span>(<span class="string">"user"</span>) String user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>å…¶ä¸­Repoç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Repo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-åˆ›å»ºRetrofitå®ä¾‹"><a href="#2-åˆ›å»ºRetrofitå®ä¾‹" class="headerlink" title="2. åˆ›å»ºRetrofitå®ä¾‹"></a>2. åˆ›å»ºRetrofitå®ä¾‹</h4><p>è¿™æ ·è°ƒç”¨Retrofitå°±ä¼šä¸ºä¸Šé¢è¿™ä¸ªinterfaceè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="string">"https://api.github.com/"</span>)</span><br><span class="line">    .addConverterFactory(GsonConverterFactory.create())		<span class="comment">//æ·»åŠ Gsonè§£æå™¨</span></span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">GitHubService service = retrofit.create(GitHubService.class);</span><br></pre></td></tr></table></figure>
<h4 id="3-å‘èµ·è¯·æ±‚"><a href="#3-å‘èµ·è¯·æ±‚" class="headerlink" title="3. å‘èµ·è¯·æ±‚"></a>3. å‘èµ·è¯·æ±‚</h4><p>ç„¶åè°ƒç”¨interfaceçš„å…·ä½“æ–¹æ³•æ—¶ï¼ˆè¿™é‡Œæ˜¯<code>listRepos()</code>ï¼‰å°±æ„é€ å¥½äº†ä¸€ä¸ª<code>Call</code>ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Call&lt;List&lt;Repo&gt;&gt; call = service.listRepos(<span class="string">"octocat"</span>);</span><br></pre></td></tr></table></figure>
<p>è¿”å›çš„ <code>call</code> å…¶å®å¹¶ä¸æ˜¯çœŸæ­£çš„æ•°æ®ç»“æœï¼Œåªæ˜¯å°è£…æˆäº†ä¸€ä¸ªéšæ—¶å¯ä»¥æ‰§è¡Œçš„è¯·æ±‚ï¼Œéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºå»æ‰§è¡Œå®ƒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥è°ƒç”¨</span></span><br><span class="line">List&lt;Repo&gt; data = repos.execute(); </span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">repos.enqueue(<span class="keyword">new</span> Callback&lt;List&lt;Repo&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;List&lt;Repo&gt;&gt; call, Response&lt;List&lt;Repo&gt;&gt; response)</span> </span>&#123;</span><br><span class="line">                List&lt;Repo&gt; data = response.body();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;List&lt;Repo&gt;&gt; call, Throwable t)</span> </span>&#123;</span><br><span class="line">                t.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>æ€ä¹ˆæ ·ï¼Œæœ‰æ²¡æœ‰çªç„¶è§‰å¾—è¯·æ±‚æ¥å£å°±å¥½åƒè®¿é—®è‡ªå®¶çš„æ–¹æ³•ä¸€æ ·ç®€å•ï¼Ÿä¸‹é¢æˆ‘ä»¬è½¬å…¥æºç åˆ†æï¼ŒæŒ‰ç…§ä½¿ç”¨æ­¥éª¤æ¥æ¢ç´¢Retrofitçš„å®ç°åŸç†ã€‚</p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Retrofitçš„å®ä¾‹åŒ–æ­¥éª¤ã€‚å…ˆçœ‹çœ‹Retrofitè¿™ä¸ªç±»çš„å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Retrofit</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Method, ServiceMethod&lt;?, ?&gt;&gt; serviceMethodCache = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> okhttp3.Call.Factory callFactory;	<span class="comment">// ç”Ÿäº§ç½‘ç»œè¯·æ±‚å™¨ï¼ˆCallï¼‰çš„å·¥å‚ï¼Œé»˜è®¤ä½¿ç”¨OkHttp</span></span><br><span class="line">  <span class="keyword">final</span> HttpUrl baseUrl;	<span class="comment">// urlåœ°å€</span></span><br><span class="line">  <span class="keyword">final</span> List&lt;Converter.Factory&gt; converterFactories;	<span class="comment">// æ•°æ®è½¬æ¢å™¨ï¼ˆconverterï¼‰å·¥å‚</span></span><br><span class="line">  <span class="keyword">final</span> List&lt;CallAdapter.Factory&gt; callAdapterFactories;	<span class="comment">// ç”Ÿäº§ç½‘ç»œè¯·æ±‚é€‚é…å™¨ï¼ˆCallAdapterï¼‰çš„å·¥å‚List</span></span><br><span class="line">  <span class="keyword">final</span> <span class="meta">@Nullable</span> Executor callbackExecutor;	<span class="comment">// å›è°ƒæ–¹æ³•æ‰§è¡Œå™¨</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">boolean</span> validateEagerly;	<span class="comment">// æ˜¯å¦æå‰å¯¹ä¸šåŠ¡æ¥å£ä¸­çš„æ³¨è§£è¿›è¡ŒéªŒè¯è½¬æ¢çš„æ ‡å¿—ä½</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">  Retrofit(okhttp3.Call.Factory callFactory, HttpUrl baseUrl,</span><br><span class="line">      List&lt;Converter.Factory&gt; converterFactories, List&lt;CallAdapter.Factory&gt; callAdapterFactories,</span><br><span class="line">      <span class="meta">@Nullable</span> Executor callbackExecutor, <span class="keyword">boolean</span> validateEagerly) &#123;</span><br><span class="line">    <span class="keyword">this</span>.callFactory = callFactory;</span><br><span class="line">    <span class="keyword">this</span>.baseUrl = baseUrl;</span><br><span class="line">    <span class="keyword">this</span>.converterFactories = converterFactories; <span class="comment">// Copy+unmodifiable at call site.</span></span><br><span class="line">    <span class="keyword">this</span>.callAdapterFactories = callAdapterFactories; <span class="comment">// Copy+unmodifiable at call site.</span></span><br><span class="line">    <span class="keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">    <span class="keyword">this</span>.validateEagerly = validateEagerly;</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Retrofitçš„æ„é€ å‡½æ•°æ˜¯packageåŒ…å¯è§çš„ï¼Œå¹¶ä¸æ˜¯publicçš„ï¼Œæ‰€ä»¥å¤–éƒ¨å¹¶ä¸èƒ½ç›´æ¥newï¼Œè€Œæ˜¯è¦é€šè¿‡<code>Retrofit.Builder</code>æ¥å®ä¾‹åŒ–ã€‚</p>
<h4 id="Retrofit-Builder"><a href="#Retrofit-Builder" class="headerlink" title="Retrofit.Builder"></a>Retrofit.Builder</h4><p><code>Retrofit.Builder</code> æ˜¯ Retrofit ç±»ä¸­çš„ä¸€ä¸ªå­ç±»ï¼Œè´Ÿè´£ç”¨æ¥åˆ›å»º Retrofit å®ä¾‹å¯¹è±¡ï¼Œä½¿ç”¨ã€Builderæ¨¡å¼ã€çš„å¥½å¤„æ˜¯æ¸…æ™°æ˜äº†å¯å®šåˆ¶åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Platform platform;</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@Nullable</span> okhttp3.Call.Factory callFactory;</span><br><span class="line">    <span class="keyword">private</span> HttpUrl baseUrl;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Converter.Factory&gt; converterFactories = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;CallAdapter.Factory&gt; callAdapterFactories = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@Nullable</span> Executor callbackExecutor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> validateEagerly;</span><br><span class="line"></span><br><span class="line">    Builder(Platform platform) &#123;</span><br><span class="line">      <span class="keyword">this</span>.platform = platform;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// Retrofitæ”¯æŒAndroid Java8 é»˜è®¤Platform ä¸‰ç§å¹³å°ï¼Œæ­¤å¤„ç¡®è®¤å½“å‰æ˜¯åœ¨å“ªä¸ªå¹³å°ç¯å¢ƒè¿è¡Œ</span></span><br><span class="line">      <span class="keyword">this</span>(Platform.get());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>Retrofit.Builder</code> ä¸­çš„æˆå‘˜å˜é‡è·ŸRetrofitä¸­åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°Builderçš„æ„é€ å‡½æ•°ä¸­é»˜è®¤åˆ¤æ–­äº†ä¸€ä¸‹å½“å‰çš„è¿è¡Œå¹³å°ã€‚</p>
<p>æœ€åï¼Œåœ¨åˆ›å»º <code>Retrofit.Builder</code> å¯¹è±¡å¹¶è¿›è¡Œè‡ªå®šä¹‰é…ç½®åï¼Œæˆ‘ä»¬å°±è¦è°ƒç”¨ <code>build()</code> æ–¹æ³•æ¥æ„é€ å‡º <code>Retrofit</code> å¯¹è±¡äº†ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ <code>build()</code> æ–¹æ³•é‡Œå¹²äº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Retrofit <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»è¦é…ç½®baseUrl</span></span><br><span class="line">    <span class="keyword">if</span> (baseUrl == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Base URL required."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤ä¸º OkHttpClient</span></span><br><span class="line">    okhttp3.Call.Factory callFactory = <span class="keyword">this</span>.callFactory;</span><br><span class="line">    <span class="keyword">if</span> (callFactory == <span class="keyword">null</span>) &#123;</span><br><span class="line">        callFactory = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Android å¹³å°ä¸‹é»˜è®¤ä¸º MainThreadExecutor</span></span><br><span class="line">    Executor callbackExecutor = <span class="keyword">this</span>.callbackExecutor;</span><br><span class="line">    <span class="keyword">if</span> (callbackExecutor == <span class="keyword">null</span>) &#123;</span><br><span class="line">        callbackExecutor = platform.defaultCallbackExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make a defensive copy of the adapters and add the default Call adapter.</span></span><br><span class="line">    List&lt;CallAdapter.Factory&gt; callAdapterFactories = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="keyword">this</span>.callAdapterFactories);</span><br><span class="line">    <span class="comment">// æ·»åŠ é»˜è®¤çš„ ExecutorCallAdapterFactory</span></span><br><span class="line">    callAdapterFactories.add(platform.defaultCallAdapterFactory(callbackExecutor));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make a defensive copy of the converters.</span></span><br><span class="line">    List&lt;Converter.Factory&gt; converterFactories =</span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">1</span> + <span class="keyword">this</span>.converterFactories.size());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the built-in converter factory first. This prevents overriding its behavior but also</span></span><br><span class="line">    <span class="comment">// ensures correct behavior when using converters that consume all types.</span></span><br><span class="line">    <span class="comment">// é¦–å…ˆæ·»åŠ é»˜è®¤çš„ BuiltInConverters</span></span><br><span class="line">    converterFactories.add(<span class="keyword">new</span> BuiltInConverters());</span><br><span class="line">    converterFactories.addAll(<span class="keyword">this</span>.converterFactories);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories),</span><br><span class="line">            unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>build()</code> ä¸­ï¼Œåšçš„äº‹æƒ…æœ‰ï¼šæ£€æŸ¥é…ç½®ã€è®¾ç½®é»˜è®¤é…ç½®ã€åˆ›å»º <code>Retrofit</code> å¯¹è±¡ã€‚å¹¶ä¸”åœ¨æ‰§è¡Œ <code>.build()</code> æ–¹æ³•å‰ï¼Œåªæœ‰ <code>.baseUrl()</code> æ˜¯å¿…é¡»è°ƒç”¨æ¥è®¾ç½®è®¿é—®åœ°å€çš„ï¼Œå…¶ä½™æ–¹æ³•åˆ™æ˜¯å¯é€‰çš„ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è®¾ç½®äº†å¾ˆå¤šé»˜è®¤æˆå‘˜ï¼Œä½†è¿™é‡Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨å››ä¸ªæˆå‘˜ï¼š<code>callFactory</code>ï¼Œ<code>callAdapter</code>ï¼Œ<code>responseConverter</code>å’Œ <code>parameterHandlers</code>ã€‚</p>
<ol>
<li><code>callFactory</code> è´Ÿè´£åˆ›å»º HTTP è¯·æ±‚ï¼ŒHTTP è¯·æ±‚è¢«æŠ½è±¡ä¸ºäº† <code>okhttp3.Call</code> ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥éšæ—¶æ‰§è¡Œçš„ HTTP è¯·æ±‚ï¼›</li>
<li><code>callAdapter</code> è´Ÿè´£æŠŠ <code>retrofit2.Call&lt;?&gt;</code> é‡Œçš„<code>Call</code>è½¬æ¢ä¸º å¦ä¸€ç§ç±»å‹<code>T</code>ï¼ˆæ³¨æ„å’Œ <code>okhttp3.Call</code> åŒºåˆ†å¼€æ¥ï¼Œ<code>retrofit2.Call&lt;?&gt;</code> è¡¨ç¤ºçš„æ˜¯å¯¹ä¸€ä¸ª Retrofit æ–¹æ³•çš„è°ƒç”¨ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œæ‹¿åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼ˆé€šè¿‡ <code>okhttp3.Call</code> å®ç°ï¼‰ï¼Œå¹¶æŠŠæ•°æ®è½¬æ¢ä¸ºå£°æ˜çš„ <code>T</code> ç±»å‹å¯¹è±¡ï¼ˆé€šè¿‡ <code>Converter&lt;F, T&gt;</code> å®ç°ï¼‰ï¼›</li>
<li><code>responseConverter</code> æ˜¯ <code>Converter&lt;ResponseBody, T&gt;</code> ç±»å‹ï¼Œè´Ÿè´£æŠŠæœåŠ¡å™¨è¿”å›çš„æ•°æ®ï¼ˆJSONã€XMLã€PBã€äºŒè¿›åˆ¶æˆ–è€…å…¶ä»–æ ¼å¼ï¼Œç”± <code>ResponseBody</code> å°è£…ï¼‰è½¬åŒ–ä¸º <code>T</code> ç±»å‹çš„å¯¹è±¡ï¼›</li>
<li><code>parameterHandlers</code> åˆ™è´Ÿè´£è§£æ API å®šä¹‰æ—¶æ¯ä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œå¹¶åœ¨æ„é€  HTTP è¯·æ±‚æ—¶è®¾ç½®å‚æ•°ï¼›</li>
</ol>
<h4 id="CallAdapterå’ŒConverteråˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"><a href="#CallAdapterå’ŒConverteråˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="CallAdapterå’ŒConverteråˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"></a>CallAdapterå’ŒConverteråˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h4><p>è¿™é‡Œå¤šæ’ä¸¤å¥ï¼Œç»™å¤§å®¶è§£é‡Šä¸€ä¸‹è¿™ä¸ª<code>CallAdapter</code>å’Œ<code>Converter</code>åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œæœ€ç®€å•çš„Retrofitæ¥å£ä¸€èˆ¬å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"users/&#123;user&#125;/repos"</span>)</span><br><span class="line">    <span class="function">Call&lt;ResponseBody&gt; <span class="title">listRepos</span><span class="params">(@Path(<span class="string">"user"</span>)</span> String user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç»™Retrofitä¸æ·»åŠ ä»»ä½•<code>CallAdapterFactory</code>çš„æƒ…å†µä¸‹ï¼Œæ¥å£æ–¹æ³•çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯<code>Call&lt;?&gt;</code>ï¼Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹ã€‚å› è€ŒRetrofitæä¾›äº†å¯¹è¿™ä¸ªCallè¿›è¡Œè½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯<code>CallAdapter</code>ã€‚æ¯”å¦‚æ·»åŠ ä¸€ä¸ª<strong>RxJava</strong>çš„CallAdapterï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="string">"https://api.example.com"</span>)</span><br><span class="line">    .addCallAdapterFactory(RxJavaCallAdapterFactory.create())	<span class="comment">// RxJavaè½¬æ¢å™¨</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·å®šä¹‰æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="function">Observable&lt;User&gt; <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ·»åŠ äº†ä¸€ä¸ª<strong>Java8</strong>çš„CallAdapterï¼Œå°±å¯ä»¥è¿™æ ·å®šä¹‰æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="function">CompletableFuture&lt;User&gt; <span class="title">getUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Retrofitæä¾›çš„CallAdapterï¼š"><a href="#Retrofitæä¾›çš„CallAdapterï¼š" class="headerlink" title="Retrofitæä¾›çš„CallAdapterï¼š"></a>Retrofitæä¾›çš„CallAdapterï¼š</h5><table>
<thead>
<tr>
<th>CallAdapter</th>
<th>Gradleä¾èµ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>guava</td>
<td>com.squareup.retrofit2:adapter-guava:latest.version</td>
</tr>
<tr>
<td>Java8</td>
<td>com.squareup.retrofit2:adapter-java8:latest.version</td>
</tr>
<tr>
<td>rxjava</td>
<td>com.squareup.retrofit2:adapter-rxjava:latest.version</td>
</tr>
<tr>
<td>rxjava2</td>
<td>com.squareup.retrofit2:adapter-rxjava2:latest.version</td>
</tr>
<tr>
<td>scala</td>
<td>com.squareup.retrofit2:adapter-scala:latest.version</td>
</tr>
</tbody>
</table>
<p>åŒæ ·åœ°ï¼Œå¦‚æœåœ¨ä¸ç»™Retrofitæ·»åŠ ä»»ä½•<code>ConverterFactory</code>çš„æƒ…å†µä¸‹ï¼Œæ¥å£æ–¹æ³•è¿”å›ç±»å‹<code>Call&lt;T&gt;</code>é‡Œçš„æ³›å‹<code>T</code>å¿…é¡»æ˜¯<code>ResponseBody</code>ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹ï¼ˆæ¯”å¦‚<code>List&lt;User&gt;</code>ï¼‰ï¼Œè¿™å°±æ˜¯<code>Converter</code>çš„ä½œç”¨ï¼Œç›´ç™½ç‚¹ä¹Ÿå°±æ˜¯æ•°æ®è§£æå™¨ï¼Œè´Ÿè´£æŠŠ<code>ResponseBody</code>è§£ææˆ<code>List&lt;User&gt;</code>ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨æˆ‘ä»¬æ„é€  HTTP è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼ é€’çš„å‚æ•°éƒ½æ˜¯ä½¿ç”¨çš„æ³¨è§£ç±»å‹ï¼ˆè¯¸å¦‚ <code>Path</code>ï¼Œ<code>Query</code>ï¼Œ<code>Field</code> ç­‰ï¼‰ï¼Œé‚£ Retrofit æ˜¯å¦‚ä½•æŠŠæˆ‘ä»¬ä¼ é€’çš„å„ç§å‚æ•°éƒ½è½¬åŒ–ä¸º String çš„å‘¢ï¼Ÿè¿˜æ˜¯ç”± <code>Retrofit</code> ç±»æä¾›<code>Converter</code>ï¼</p>
<p><code>Converter.Factory</code> é™¤äº†æä¾›responseBodyConverterï¼Œè¿˜æä¾› requestBodyConverter å’Œ stringConverterï¼ŒAPI æ–¹æ³•ä¸­é™¤äº† <code>@Body</code> å’Œ <code>@Part</code> ç±»å‹çš„å‚æ•°ï¼Œéƒ½åˆ©ç”¨ stringConverter è¿›è¡Œè½¬æ¢ï¼Œè€Œ <code>@Body</code> å’Œ <code>@Part</code> ç±»å‹çš„å‚æ•°åˆ™åˆ©ç”¨ requestBodyConverter è¿›è¡Œè½¬æ¢ã€‚</p>
<h5 id="Retrofitæä¾›çš„Converter"><a href="#Retrofitæä¾›çš„Converter" class="headerlink" title="Retrofitæä¾›çš„Converter"></a>Retrofitæä¾›çš„Converter</h5><table>
<thead>
<tr>
<th>Converter</th>
<th>Gradleä¾èµ–</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gson</td>
<td>com.squareup.retrofit2:converter-gson:latest.version</td>
</tr>
<tr>
<td>Guava</td>
<td>com.squareup.retrofit2:converter-guava:latest.version</td>
</tr>
<tr>
<td>Jackson</td>
<td>com.squareup.retrofit2:converter-jackson:latest.version</td>
</tr>
<tr>
<td>Java8</td>
<td>com.squareup.retrofit2:converter-java8:latest.version</td>
</tr>
<tr>
<td>Jaxb</td>
<td>com.squareup.retrofit2:converter-jaxb:latest.version</td>
</tr>
<tr>
<td>Moshi</td>
<td>com.squareup.retrofit2:converter-moshi:latest.version</td>
</tr>
<tr>
<td>Protobuf</td>
<td>com.squareup.retrofit2:converter-protobuf:latest.version</td>
</tr>
<tr>
<td>Scalars</td>
<td>com.squareup.retrofit2:converter-scalars:latest.version</td>
</tr>
<tr>
<td>Wire</td>
<td>com.squareup.retrofit2:converter-wire:latest.version</td>
</tr>
<tr>
<td>Simple XML</td>
<td>com.squareup.retrofit2:converter-simplexml:latest.version</td>
</tr>
</tbody>
</table>
<h4 id="Platform"><a href="#Platform" class="headerlink" title="Platform"></a>Platform</h4><p>è¿™é‡Œæˆ‘ä»¬å†æ¥ä¸ªå°æ’æ›²ï¼Œæ¥çœ‹ä¸‹ Retrofit æ˜¯å¦‚ä½•ç¡®å®šå½“å‰è¿è¡Œçš„æ˜¯å“ªä¸ªå¹³å°ç¯å¢ƒçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Platform</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Platform PLATFORM = findPlatform();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Platform <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PLATFORM;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Platform <span class="title">findPlatform</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"android.os.Build"</span>);		<span class="comment">//é€šè¿‡åå°„åˆ¤æ–­å¹³å°</span></span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Android();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ignored) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">"java.util.Optional"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Java8();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ignored) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Platform();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é»˜è®¤Platformçš„callbackExecutor</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">Executor <span class="title">defaultCallbackExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CallAdapter.<span class="function">Factory <span class="title">defaultCallAdapterFactory</span><span class="params">(@Nullable Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (callbackExecutor != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ExecutorCallAdapterFactory(callbackExecutor);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> DefaultCallAdapterFactory.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isDefaultMethod</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">Object <span class="title">invokeDefaultMethod</span><span class="params">(Method method, Class&lt;?&gt; declaringClass, Object object,</span></span></span><br><span class="line"><span class="function"><span class="params">                               @Nullable Object... args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯é€šè¿‡åå°„åˆ¤æ–­æœ‰æ²¡æœ‰è¯¥ç±»æ¥å®ç°çš„ã€‚æ¯”è¾ƒå·§å¦™ï¼Œå¤§å®¶å¯ä»¥çš„å­¦ä¹ ä¸€ä¸‹ã€‚</p>
<p>è€Œæ­¤å¤„çš„<code>Android</code>å’Œ<code>Java8</code>å‡æ˜¯Platformçš„å­ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Android</span> <span class="keyword">extends</span> <span class="title">Platform</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Androidå¹³å°çš„é»˜è®¤callbackExecutorï¼Œå®é™…ä¸Šå°±æ˜¯æŠ›åˆ°UIçº¿ç¨‹å»æ‰§è¡Œå›è°ƒ</span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">defaultCallbackExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MainThreadExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Androidå¹³å°çš„é»˜è®¤CallAdapterFactory</span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    CallAdapter.<span class="function">Factory <span class="title">defaultCallAdapterFactory</span><span class="params">(@Nullable Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (callbackExecutor == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ExecutorCallAdapterFactory(callbackExecutor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MainThreadExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Handler handler = <span class="keyword">new</span> Handler(Looper.getMainLooper());</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">            handler.post(r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java8çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@IgnoreJRERequirement</span> <span class="comment">// Only classloaded and used on Java 8.</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Java8</span> <span class="keyword">extends</span> <span class="title">Platform</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åˆ¤æ–­è¢«è°ƒç”¨çš„methodæ˜¯å¦Java8çš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isDefaultMethod</span><span class="params">(Method method)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> method.isDefault();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨é»˜è®¤æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function">Object <span class="title">invokeDefaultMethod</span><span class="params">(Method method, Class&lt;?&gt; declaringClass, Object object,</span></span></span><br><span class="line"><span class="function"><span class="params">                                         @Nullable Object... args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// Because the service interface might not be public, we need to use a MethodHandle lookup</span></span><br><span class="line">        <span class="comment">// that ignores the visibility of the declaringClass.</span></span><br><span class="line">        Constructor&lt;Lookup&gt; constructor = Lookup.class.getDeclaredConstructor(Class.class, <span class="keyword">int</span>.class);</span><br><span class="line">        constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> constructor.newInstance(declaringClass, -<span class="number">1</span> <span class="comment">/* trusted */</span>)</span><br><span class="line">                .unreflectSpecial(method, declaringClass)</span><br><span class="line">                .bindTo(object)</span><br><span class="line">                .invokeWithArguments(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java 8 çš„interfaceå¼•å…¥äº†æ–°çš„è¯­è¨€ç‰¹æ€§â€”â€”é»˜è®¤æ–¹æ³•ï¼ˆDefault Methodsï¼‰ã€‚å¤§å®¶å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://blog.csdn.net/u010003835/article/details/76850242" target="_blank" rel="noopener">Java8 é»˜è®¤æ–¹æ³• default method</a></p>
<blockquote>
<p>é»˜è®¤æ–¹æ³•å…è®¸æ‚¨æ·»åŠ æ–°çš„åŠŸèƒ½åˆ°ç°æœ‰åº“çš„æ¥å£ä¸­ï¼Œå¹¶èƒ½ç¡®ä¿ä¸é‡‡ç”¨æ—§ç‰ˆæœ¬æ¥å£ç¼–å†™çš„ä»£ç çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚</p>
</blockquote>
<p>æ‰€ä»¥å¦‚æœåœ¨Java8çš„å¹³å°ä¸Šä½¿ç”¨Retrofitçš„è¯ï¼ŒRetrofitéœ€è¦æ’é™¤æˆ‘ä»¬å®šä¹‰çš„interfaceä¸­çš„è¿™äº›Default Methodsã€‚</p>
<p>åœ¨ä½¿ç”¨<code>Retrofit.Builder</code>å®ä¾‹åŒ–å¾—åˆ° <code>Retrofit</code> å¯¹è±¡åå°±æ˜¯è°ƒç”¨ <code>Retrofit#create()</code> æ–¹æ³•æ¥åˆ›å»ºæˆ‘ä»¬ API æ¥å£çš„å®ä¾‹ã€‚</p>
<h4 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a>Retrofit</h4><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è·Ÿè¿›Retrofitç±»ä¸­çš„ <code>create(final Class&lt;T&gt; service)</code> æ–¹æ³•æ¥çœ‹ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ ¡éªŒæ˜¯å¦ä¸ºæ¥å£ï¼Œä¸”ä¸èƒ½ç»§æ‰¿å…¶ä»–æ¥å£</span></span><br><span class="line">  Utils.validateServiceInterface(service);</span><br><span class="line">  <span class="comment">// æ˜¯å¦éœ€è¦æå‰è§£ææ¥å£æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">if</span> (validateEagerly) &#123;</span><br><span class="line">    eagerlyValidateMethods(service);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åŠ¨æ€ä»£ç†æ¨¡å¼, è¿”å›ä¸€ä¸ª service æ¥å£çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> (T) Proxy.newProxyInstance(service.getClassLoader(), <span class="keyword">new</span> Class&lt;?&gt;[] &#123; service &#125;,</span><br><span class="line">      <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Platform platform = Platform.get();</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object... args)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">          <span class="comment">// If the method is a method from Object then defer to normal invocation.</span></span><br><span class="line">          <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (platform.isDefaultMethod(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span> platform.invokeDefaultMethod(method, service, proxy, args);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å°†æ¥å£ä¸­çš„æ–¹æ³•æ„é€ ä¸º ServiceMethod</span></span><br><span class="line">          ServiceMethod serviceMethod = loadServiceMethod(method);</span><br><span class="line">          OkHttpCall okHttpCall = <span class="keyword">new</span> OkHttpCall&lt;&gt;(serviceMethod, args);</span><br><span class="line">          <span class="keyword">return</span> serviceMethod.callAdapter.adapt(okHttpCall);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæœ€å…³é”®çš„å°±æ˜¯ã€åŠ¨æ€ä»£ç†ã€ï¼Œè¿”å›äº†ä¸€ä¸ª Proxy ä»£ç†ç±»ï¼Œè°ƒç”¨æ¥å£ä¸­çš„ä»»ä½•æ–¹æ³•éƒ½ä¼šè°ƒç”¨ proxy é‡Œçš„ invoke æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿›è¡Œç½‘ç»œæ“ä½œçš„éƒ½æ˜¯é€šè¿‡ä»£ç†ç±»æ¥å®Œæˆçš„ã€‚<strong>ç®€å•çš„è¯´ï¼Œåœ¨æˆ‘ä»¬å‰é¢çš„ç¤ºä¾‹ä»£ç ä¸­è°ƒç”¨ <code>GitHubService.listRepos</code> æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯è¿™é‡Œçš„ <code>InvocationHandler.invoke</code> æ–¹æ³•ã€‚</strong></p>
<p> <code>InvocationHandler.invoke</code>è¿™ä¸ªæ–¹æ³•çš„æ„æ€æ˜¯ï¼šå¦‚æœè°ƒç”¨çš„æ˜¯ <code>Object</code> çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code>equals</code>ï¼Œ<code>toString</code>ï¼Œé‚£å°±ç›´æ¥è°ƒç”¨ã€‚å¦‚æœæ˜¯ default æ–¹æ³•ï¼ˆJava 8 å¼•å…¥çš„æ–°è¯­æ³•ï¼‰ï¼Œå°±è°ƒç”¨ default æ–¹æ³•ã€‚è¿™äº›æˆ‘ä»¬éƒ½å…ˆä¸ç®¡ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨Androidå¹³å°è°ƒç”¨ <code>listRepos</code>ï¼Œè‚¯å®šä¸æ˜¯è¿™ä¸¤ç§æƒ…å†µï¼Œé‚£è¿™æ¬¡è°ƒç”¨çœŸæ­£å¹²æ´»çš„å°±æ˜¯è¿™ä¸‰è¡Œä»£ç äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†æ¥å£ä¸­çš„æ–¹æ³•æ„é€ ä¸º ServiceMethod</span></span><br><span class="line">ServiceMethod&lt;Object, Object&gt; serviceMethod = (ServiceMethod&lt;Object, Object&gt;) loadServiceMethod(method);</span><br><span class="line">OkHttpCall&lt;Object&gt; okHttpCall = <span class="keyword">new</span> OkHttpCall&lt;&gt;(serviceMethod, args);</span><br><span class="line"><span class="keyword">return</span> serviceMethod.adapt(okHttpCall);</span><br></pre></td></tr></table></figure>
<p><strong>è¿™ä¸‰å¥ä»£ç ï¼Œä¸‹é¢æˆ‘ä»¬ç€é‡æ¥çœ‹ã€‚</strong></p>
<p>åœ¨ä»£ç†ä¸­ï¼Œä¼šæ ¹æ®å‚æ•°ä¸­ä¼ å…¥çš„å…·ä½“æ¥å£æ–¹æ³•æ¥æ„é€ å‡ºå¯¹åº”çš„ <code>serviceMethod</code> ã€‚<code>ServiceMethod</code> ç±»çš„ä½œç”¨å°±æ˜¯æŠŠæ¥å£çš„æ–¹æ³•é€‚é…ä¸ºå¯¹åº”çš„ HTTP call ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ServiceMethod&lt;?, ?&gt; loadServiceMethod(Method method) &#123;</span><br><span class="line">    <span class="comment">// å…ˆä»ç¼“å­˜ä¸­å–ï¼Œè‹¥æ²¡æœ‰å°±å»åˆ›å»ºå¯¹åº”çš„ ServiceMethod</span></span><br><span class="line">    ServiceMethod&lt;?, ?&gt; result = serviceMethodCache.get(method);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (serviceMethodCache) &#123;</span><br><span class="line">      result = serviceMethodCache.get(method);</span><br><span class="line">      <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰ç¼“å­˜å°±åˆ›å»ºï¼Œä¹‹åå†æ”¾å…¥ç¼“å­˜ä¸­</span></span><br><span class="line">        result = <span class="keyword">new</span> ServiceMethod.Builder&lt;&gt;(<span class="keyword">this</span>, method).build();</span><br><span class="line">        serviceMethodCache.put(method, result);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åœ¨å†…éƒ¨è¿˜ç»´æŠ¤äº†ä¸€ä¸ª <code>serviceMethodCache</code> æ¥ç¼“å­˜ <code>ServiceMethod</code> ï¼ŒåŒä¸€ä¸ª API çš„åŒä¸€ä¸ªæ–¹æ³•ï¼Œåªä¼šåˆ›å»ºä¸€æ¬¡ã€‚ç”±äºæˆ‘ä»¬æ¯æ¬¡è·å– API å®ä¾‹éƒ½æ˜¯ä¼ å…¥çš„ <code>class</code> å¯¹è±¡ï¼ˆæ¯”å¦‚ç¤ºä¾‹ä¸­çš„GitHubService.classï¼‰ï¼Œè€Œ <code>class</code> å¯¹è±¡æ˜¯è¿›ç¨‹å†…å•ä¾‹çš„ï¼Œæ‰€ä»¥è·å–åˆ°å®ƒçš„åŒä¸€ä¸ªæ–¹æ³• <code>Method</code> å®ä¾‹ä¹Ÿæ˜¯å•ä¾‹çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç¼“å­˜æ˜¯æœ‰æ•ˆçš„ã€‚æˆ‘ä»¬å°±ç›´æ¥æ¥çœ‹ <code>ServiceMethod</code> æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„å§ã€‚</p>
<h4 id="ServiceMethod"><a href="#ServiceMethod" class="headerlink" title="ServiceMethod"></a>ServiceMethod</h4><p><code>ServiceMethod&lt;R, T&gt;</code> ç±»çš„ä½œç”¨æ­£å¦‚å…¶ JavaDoc æ‰€è¨€ï¼š</p>
<blockquote>
<p>Adapts an invocation of an interface method into an HTTP call. æŠŠå¯¹æ¥å£æ–¹æ³•çš„è°ƒç”¨è½¬ä¸ºä¸€æ¬¡ HTTP è°ƒç”¨ã€‚</p>
</blockquote>
<p>ä¸€ä¸ª <code>ServiceMethod</code> å¯¹è±¡å¯¹åº”äºä¸€ä¸ª API interface çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸Šé¢çš„<code>loadServiceMethod(method)</code>æ–¹æ³•è´Ÿè´£åŠ è½½äº† <code>ServiceMethod</code>ã€‚æˆ‘ä»¬å‘ç° <code>ServiceMethod</code> ä¹Ÿæ˜¯é€šè¿‡å»ºé€ è€…æ¨¡å¼ï¼ˆ<code>ServiceMethod.Builder</code>ï¼‰æ¥åˆ›å»ºå¯¹è±¡çš„ã€‚é‚£å°±è¿›å…¥å¯¹åº”æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½äºServiceMethodç±»ä¸­</span></span><br><span class="line">Builder(Retrofit retrofit, Method method) &#123;</span><br><span class="line">      <span class="keyword">this</span>.retrofit = retrofit;</span><br><span class="line">      <span class="keyword">this</span>.method = method;</span><br><span class="line">      <span class="comment">// æ¥å£æ–¹æ³•çš„æ³¨è§£</span></span><br><span class="line">      <span class="keyword">this</span>.methodAnnotations = method.getAnnotations();</span><br><span class="line">      <span class="comment">// æ¥å£æ–¹æ³•çš„å‚æ•°ç±»å‹</span></span><br><span class="line">      <span class="keyword">this</span>.parameterTypes = method.getGenericParameterTypes();</span><br><span class="line">      <span class="comment">// æ¥å£æ–¹æ³•å‚æ•°çš„æ³¨è§£</span></span><br><span class="line">      <span class="keyword">this</span>.parameterAnnotationsArray = method.getParameterAnnotations();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ„é€ æ–¹æ³•ä¸­æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å•åˆ€ç›´å…¥ <code>build()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ServiceMethod <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// æ ¹æ®æ¥å£æ–¹æ³•çš„æ³¨è§£å’Œè¿”å›ç±»å‹åˆ›å»º callAdapter</span></span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰æ·»åŠ  CallAdapter é‚£ä¹ˆé»˜è®¤ä¼šç”¨ ExecutorCallAdapterFactory</span></span><br><span class="line">      callAdapter = createCallAdapter();</span><br><span class="line">      <span class="comment">// calladapter çš„å“åº”ç±»å‹ä¸­çš„æ³›å‹ï¼Œæ¯”å¦‚ Call&lt;User&gt; ä¸­çš„ User</span></span><br><span class="line">      responseType = callAdapter.responseType();</span><br><span class="line">      <span class="keyword">if</span> (responseType == Response.class || responseType == okhttp3.Response.class) &#123;</span><br><span class="line">          <span class="keyword">throw</span> methodError(<span class="string">"'"</span></span><br><span class="line">                  + Utils.getRawType(responseType).getName()</span><br><span class="line">                  + <span class="string">"' is not a valid response body type. Did you mean ResponseBody?"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// æ ¹æ®ä¹‹å‰æ³›å‹ä¸­çš„ç±»å‹ä»¥åŠæ¥å£æ–¹æ³•çš„æ³¨è§£åˆ›å»º ResponseConverter</span></span><br><span class="line">      responseConverter = createResponseConverter();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¹æ®æ¥å£æ–¹æ³•çš„æ³¨è§£æ„é€ è¯·æ±‚æ–¹æ³•ï¼Œæ¯”å¦‚ @GET @POST @DELETE ç­‰</span></span><br><span class="line">      <span class="comment">// å¦å¤–è¿˜æœ‰æ·»åŠ è¯·æ±‚å¤´ï¼Œæ£€æŸ¥urlä¸­æœ‰æ— å¸¦?ï¼Œè½¬åŒ– path ä¸­çš„å‚æ•°</span></span><br><span class="line">      <span class="keyword">for</span> (Annotation annotation : methodAnnotations) &#123;</span><br><span class="line">          parseMethodAnnotation(annotation);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (httpMethod == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> methodError(<span class="string">"HTTP method annotation is required (e.g., @GET, @POST, etc.)."</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è‹¥æ—  body åˆ™ä¸èƒ½æœ‰ Multipart å’Œ FormEncoded çš„æ³¨è§£</span></span><br><span class="line">      <span class="keyword">if</span> (!hasBody) &#123;</span><br><span class="line">          <span class="keyword">if</span> (isMultipart) &#123;</span><br><span class="line">              <span class="keyword">throw</span> methodError(</span><br><span class="line">                      <span class="string">"Multipart can only be specified on HTTP methods with request body (e.g., @POST)."</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (isFormEncoded) &#123;</span><br><span class="line">              <span class="keyword">throw</span> methodError(<span class="string">"FormUrlEncoded can only be specified on HTTP methods with "</span></span><br><span class="line">                      + <span class="string">"request body (e.g., @POST)."</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è§£ææ¥å£æ–¹æ³•å‚æ•°ä¸­çš„æ³¨è§£ï¼Œæ¯”å¦‚ @Path @Query @QueryMap @Field ç­‰ç­‰</span></span><br><span class="line">      <span class="comment">// ç›¸åº”çš„ï¼Œæ¯ä¸ªæ–¹æ³•çš„å‚æ•°éƒ½åˆ›å»ºäº†ä¸€ä¸ª ParameterHandler&lt;?&gt; å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">int</span> parameterCount = parameterAnnotationsArray.length;</span><br><span class="line">      parameterHandlers = <span class="keyword">new</span> ParameterHandler&lt;?&gt;[parameterCount];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> p = <span class="number">0</span>; p &lt; parameterCount; p++) &#123;</span><br><span class="line">          Type parameterType = parameterTypes[p];</span><br><span class="line">          <span class="keyword">if</span> (Utils.hasUnresolvableType(parameterType)) &#123;</span><br><span class="line">              <span class="keyword">throw</span> parameterError(p, <span class="string">"Parameter type must not include a type variable or wildcard: %s"</span>,</span><br><span class="line">                      parameterType);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          Annotation[] parameterAnnotations = parameterAnnotationsArray[p];</span><br><span class="line">          <span class="keyword">if</span> (parameterAnnotations == <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">throw</span> parameterError(p, <span class="string">"No Retrofit annotation found."</span>);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          parameterHandlers[p] = parseParameter(p, parameterType, parameterAnnotations);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ£€æŸ¥æ„é€ å‡ºçš„è¯·æ±‚æœ‰æ²¡æœ‰ä¸å¯¹çš„åœ°æ–¹</span></span><br><span class="line">      <span class="keyword">if</span> (relativeUrl == <span class="keyword">null</span> &amp;&amp; !gotUrl) &#123;</span><br><span class="line">          <span class="keyword">throw</span> methodError(<span class="string">"Missing either @%s URL or @Url parameter."</span>, httpMethod);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!isFormEncoded &amp;&amp; !isMultipart &amp;&amp; !hasBody &amp;&amp; gotBody) &#123;</span><br><span class="line">          <span class="keyword">throw</span> methodError(<span class="string">"Non-body HTTP method cannot contain @Body."</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (isFormEncoded &amp;&amp; !gotField) &#123;</span><br><span class="line">          <span class="keyword">throw</span> methodError(<span class="string">"Form-encoded method must contain at least one @Field."</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (isMultipart &amp;&amp; !gotPart) &#123;</span><br><span class="line">          <span class="keyword">throw</span> methodError(<span class="string">"Multipart method must contain at least one @Part."</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ServiceMethod&lt;&gt;(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>build()</code> ä¸­ä»£ç æŒºé•¿çš„ï¼Œæ€»ç»“èµ·æ¥å°±ä¸€å¥è¯ï¼šå°±æ˜¯å°† API æ¥å£ä¸­çš„æ–¹æ³•è¿›è¡Œè§£æï¼Œæ„é€ æˆ <code>ServiceMethod</code>ï¼Œäº¤ç»™ä¸‹é¢çš„ <code>OkHttpCall</code> ä½¿ç”¨ã€‚</p>
<p>åŸºæœ¬ä¸Šåšçš„äº‹æƒ…å°±æ˜¯ï¼š</p>
<ol>
<li>åˆ›å»º CallAdapter ï¼›</li>
<li>åˆ›å»º ResponseConverterï¼›</li>
<li>æ ¹æ® API æ¥å£æ–¹æ³•çš„æ³¨è§£æ„é€ ç½‘ç»œè¯·æ±‚æ–¹æ³•ï¼›</li>
<li>æ ¹æ® API æ¥å£æ–¹æ³•å‚æ•°ä¸­çš„æ³¨è§£æ„é€ ç½‘ç»œè¯·æ±‚çš„å‚æ•°ï¼›</li>
<li>æ£€æŸ¥æœ‰æ— å¼‚å¸¸ï¼›</li>
</ol>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ç¬¬äºŒå¥é‡è¦çš„ä»£ç <code>OkHttpCall&lt;Object&gt; okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);</code></p>
<h4 id="OkHttpCall"><a href="#OkHttpCall" class="headerlink" title="OkHttpCall"></a>OkHttpCall</h4><p><code>OkHttpCall</code> å®ç°äº† <code>retrofit2.Call</code>ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å®ƒçš„ <code>execute()</code> å’Œ <code>enqueue(Callback&lt;T&gt; callback)</code> æ¥å£ã€‚å‰è€…ç”¨äºåŒæ­¥æ‰§è¡Œ HTTP è¯·æ±‚ï¼Œåè€…ç”¨äºå¼‚æ­¥æ‰§è¡Œã€‚æˆ‘ä»¬å…ˆçœ‹ <code>execute()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Response&lt;T&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    okhttp3.Call call;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Already executed."</span>);</span><br><span class="line">        executed = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (creationFailure != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (creationFailure <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (IOException) creationFailure;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (creationFailure <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (RuntimeException) creationFailure;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> (Error) creationFailure;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        call = rawCall;</span><br><span class="line">        <span class="keyword">if</span> (call == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ ¹æ® serviceMethod ä¸­çš„ä¼—å¤šæ•°æ®åˆ›å»ºå‡º Okhttp ä¸­çš„ Request å¯¹è±¡</span></span><br><span class="line">	            <span class="comment">// æ³¨æ„çš„ä¸€ç‚¹ï¼Œä¼šè°ƒç”¨ä¸Šé¢çš„ ParameterHandler.apply æ–¹æ³•æ¥å¡«å……ç½‘ç»œè¯·æ±‚å‚æ•°</span></span><br><span class="line">	            <span class="comment">// ç„¶åå†æ ¹æ® OkhttpClient åˆ›å»ºå‡º Okhttp ä¸­çš„ Call</span></span><br><span class="line">	            <span class="comment">// è¿™ä¸€æ­¥ä¹Ÿè¯´æ˜äº†åœ¨ Retrofit ä¸­çš„ OkHttpCall å†…éƒ¨è¯·æ±‚æœ€åä¼šè½¬æ¢ä¸º OkHttp çš„ Call</span></span><br><span class="line">                call = rawCall = createRawCall();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException | RuntimeException | Error e) &#123;</span><br><span class="line">                throwIfFatal(e); <span class="comment">//  Do not assign a fatal error to creationFailure.</span></span><br><span class="line">                creationFailure = e;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (canceled) &#123;</span><br><span class="line">        call.cancel();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œ call å¹¶è½¬æ¢æˆå“åº”çš„ response</span></span><br><span class="line">    <span class="keyword">return</span> parseResponse(call.execute());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>execute()</code> åšçš„å°±æ˜¯å°† Retrofit ä¸­çš„ call è½¬åŒ–ä¸º OkHttp ä¸­çš„ Call ã€‚æœ€åè®© OkHttp çš„ Call å»æ‰§è¡Œã€‚</p>
<p>ä¸»è¦åŒ…æ‹¬ä¸‰æ­¥ï¼š</p>
<ol>
<li>è°ƒç”¨<code>createRawCall()</code>åˆ›å»ºäº† <code>okhttp3.Call</code>ï¼ŒåŒ…æ‹¬æ„é€ å‚æ•°ï¼›</li>
<li>ä½¿ç”¨<code>call.execute()</code>æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼›</li>
<li>è§£æç½‘ç»œè¯·æ±‚è¿”å›çš„æ•°æ®ï¼›</li>
</ol>
<p>æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹çœ‹<code>createRawCall()</code>å’Œ<code>parseResponse()</code>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// OkHttpCallç±»ä¸­</span></span><br><span class="line"><span class="keyword">private</span> okhttp3.<span class="function">Call <span class="title">createRawCall</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    okhttp3.Call call = serviceMethod.toCall(args);</span><br><span class="line">    <span class="keyword">if</span> (call == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"Call.Factory returned null."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> call;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>createRawCall()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>serviceMethod.toCall(args)</code> æ¥åˆ›å»º <code>okhttp3.Call</code>ï¼Œè€Œåœ¨åè€…ä¸­ï¼Œæˆ‘ä»¬ä¹‹å‰å‡†å¤‡å¥½çš„ <code>parameterHandlers</code> å°±æ´¾ä¸Šäº†ç”¨åœºã€‚</p>
<p>ç„¶åæˆ‘ä»¬å†è°ƒç”¨ <code>serviceMethod.callFactory.newCall(request)</code> æ¥åˆ›å»º <code>okhttp3.Call</code>ï¼Œè¿™é‡Œä¹‹å‰å‡†å¤‡å¥½çš„ <code>callFactory</code> åŒæ ·ä¹Ÿæ´¾ä¸Šäº†ç”¨åœºï¼Œç”±äºå·¥å‚åœ¨æ„é€  <code>Retrofit</code> å¯¹è±¡æ—¶å¯ä»¥æŒ‡å®šï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–çš„å·¥å‚ï¼ˆä¾‹å¦‚ä½¿ç”¨è¿‡æ—¶çš„ <code>HttpURLConnection</code> çš„å·¥å‚ï¼‰ï¼Œæ¥ä½¿ç”¨å…¶å®ƒçš„åº•å±‚ HttpClient å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Response&lt;T&gt; <span class="title">parseResponse</span><span class="params">(okhttp3.Response rawResponse)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ResponseBody rawBody = rawResponse.body();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove the body's source (the only stateful object) so we can pass the response along.</span></span><br><span class="line">    rawResponse = rawResponse.newBuilder()</span><br><span class="line">            .body(<span class="keyword">new</span> NoContentResponseBody(rawBody.contentType(), rawBody.contentLength()))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœè¿”å›çš„å“åº”ç ä¸æ˜¯æˆåŠŸçš„è¯ï¼Œè¿”å›é”™è¯¯ Response</span></span><br><span class="line">    <span class="keyword">int</span> code = rawResponse.code();</span><br><span class="line">    <span class="keyword">if</span> (code &lt; <span class="number">200</span> || code &gt;= <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Buffer the entire body to avoid future I/O.</span></span><br><span class="line">            ResponseBody bufferedBody = Utils.buffer(rawBody);</span><br><span class="line">            <span class="keyword">return</span> Response.error(bufferedBody, rawResponse);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rawBody.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœè¿”å›çš„å“åº”ç æ˜¯204æˆ–è€…205ï¼Œè¿”å›æ²¡æœ‰ body çš„æˆåŠŸ Response</span></span><br><span class="line">    <span class="keyword">if</span> (code == <span class="number">204</span> || code == <span class="number">205</span>) &#123;</span><br><span class="line">        rawBody.close();</span><br><span class="line">        <span class="keyword">return</span> Response.success(<span class="keyword">null</span>, rawResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ExceptionCatchingRequestBody catchingBody = <span class="keyword">new</span> ExceptionCatchingRequestBody(rawBody);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å°† body è½¬æ¢ä¸ºå¯¹åº”çš„æ³›å‹ï¼Œç„¶åè¿”å›æˆåŠŸ Response</span></span><br><span class="line">        T body = serviceMethod.toResponse(catchingBody);</span><br><span class="line">        <span class="keyword">return</span> Response.success(body, rawResponse);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">        <span class="comment">// If the underlying source threw an exception, propagate that rather than indicating it was</span></span><br><span class="line">        <span class="comment">// a runtime exception.</span></span><br><span class="line">        catchingBody.throwIfCaught();</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è°ƒç”¨ <code>okhttp3.Call#execute()</code> æ¥æ‰§è¡Œç½‘ç»œè¯·æ±‚ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œæ‰§è¡Œå®Œæ¯•ä¹‹åå°†è¿”å›æ”¶åˆ°çš„å“åº”æ•°æ®ã€‚æ”¶åˆ°å“åº”æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬è¿›è¡Œäº†çŠ¶æ€ç çš„æ£€æŸ¥ï¼Œé€šè¿‡æ£€æŸ¥ä¹‹åæˆ‘ä»¬è°ƒç”¨äº† <code>serviceMethod.toResponse(catchingBody)</code> æ¥æŠŠå“åº”æ•°æ®è½¬åŒ–ä¸ºäº†æˆ‘ä»¬éœ€è¦çš„æ•°æ®ç±»å‹å¯¹è±¡Tã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServiceMethodç±»ä¸­</span></span><br><span class="line"><span class="function">R <span class="title">toResponse</span><span class="params">(ResponseBody body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> responseConverter.convert(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>serviceMethod</code> çš„<code>toResponse</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¹‹å‰å‡†å¤‡å¥½çš„ <code>responseConverter</code> ä¹Ÿæ´¾ä¸Šäº†ç”¨åœºã€‚æˆ‘ä»¬åˆ†åˆ«çœ‹ä¸‹ï¼š</p>
<ol>
<li><code>responseConverter</code>è¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ</li>
<li><code>ResponseConverter</code>çš„<code>convert()</code>æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ</li>
</ol>
<h4 id="é»˜è®¤çš„Converter"><a href="#é»˜è®¤çš„Converter" class="headerlink" title="é»˜è®¤çš„Converter"></a>é»˜è®¤çš„Converter</h4><h5 id="1-responseConverterè¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ"><a href="#1-responseConverterè¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ" class="headerlink" title="#1. responseConverterè¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ"></a>#1. <code>responseConverter</code>è¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ</h5><p>åœ¨<code>ServiceMethod.Builder</code>ç±»ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å®ƒçš„èµ‹å€¼çš„åœ°æ–¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ServiceMethod.Builderç±»ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServiceMethod <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ›å»ºé»˜è®¤çš„CallAdapter</span></span><br><span class="line">      callAdapter = createCallAdapter();</span><br><span class="line">      responseType = callAdapter.responseType();</span><br><span class="line">      <span class="keyword">if</span> (responseType == Response.class || responseType == okhttp3.Response.class) &#123;</span><br><span class="line">        <span class="keyword">throw</span> methodError(<span class="string">"'"</span></span><br><span class="line">            + Utils.getRawType(responseType).getName()</span><br><span class="line">            + <span class="string">"' is not a valid response body type. Did you mean ResponseBody?"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// åˆ›å»ºé»˜è®¤çš„ResponseConverter</span></span><br><span class="line">      responseConverter = createResponseConverter();</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾ï¼Œåœ¨<code>build()</code>æ–¹æ³•ä¸­åŒæ—¶åˆ›å»ºäº†é»˜è®¤çš„CallAdapterå’ŒResponseConverterã€‚æˆ‘ä»¬å…ˆç»§ç»­å‰å¾€<code>createResponseConverter</code>å…³æ³¨ResponseConverterï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Converter&lt;ResponseBody, T&gt; <span class="title">createResponseConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Annotation[] annotations = method.getAnnotations();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.responseBodyConverter(responseType, annotations);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123; <span class="comment">// Wide exception range because factories are user code.</span></span><br><span class="line">        <span class="keyword">throw</span> methodError(e, <span class="string">"Unable to create converter for %s"</span>, responseType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸæ¥æ˜¯æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„æ¥å£æ–¹æ³•çš„è¿”å›ç±»å‹å’Œæ³¨è§£ï¼Œäº¤ç»™äº†Retrofitçš„<code>responseBodyConverter(Type type, Annotation[] annotations)</code>å»æ‰¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Converter&lt;ResponseBody, T&gt; <span class="title">responseBodyConverter</span><span class="params">(Type type, Annotation[] annotations)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nextResponseBodyConverter(<span class="keyword">null</span>, type, annotations);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Converter&lt;ResponseBody, T&gt; <span class="title">nextResponseBodyConverter</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @Nullable Converter.Factory skipPast, Type type, Annotation[] annotations)</span> </span>&#123;</span><br><span class="line">    checkNotNull(type, <span class="string">"type == null"</span>);</span><br><span class="line">    checkNotNull(annotations, <span class="string">"annotations == null"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ¥å£æ–¹æ³•çš„è¿”å›ç±»å‹ã€æ³¨è§£ç­‰ä¿¡æ¯æ‰¾åˆ°å¯¹åº”çš„ResponseConverter</span></span><br><span class="line">    <span class="keyword">int</span> start = converterFactories.indexOf(skipPast) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = converterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">        Converter&lt;ResponseBody, ?&gt; converter =</span><br><span class="line">                converterFactories.get(i).responseBodyConverter(type, annotations, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (converter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//noinspection unchecked</span></span><br><span class="line">            <span class="keyword">return</span> (Converter&lt;ResponseBody, T&gt;) converter;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾ä¸åˆ°ä»»ä½•ResponseConverterçš„è¯ï¼Œå°±æŠ›å¼‚å¸¸</span></span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"Could not locate ResponseBody converter for "</span>)</span><br><span class="line">            .append(type)</span><br><span class="line">            .append(<span class="string">".\n"</span>);</span><br><span class="line">    <span class="keyword">if</span> (skipPast != <span class="keyword">null</span>) &#123;</span><br><span class="line">        builder.append(<span class="string">"  Skipped:"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; start; i++) &#123;</span><br><span class="line">            builder.append(<span class="string">"\n   * "</span>).append(converterFactories.get(i).getClass().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(<span class="string">'\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    builder.append(<span class="string">"  Tried:"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = converterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">        builder.append(<span class="string">"\n   * "</span>).append(converterFactories.get(i).getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(builder.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>Retrofit</code> ç±»å†…éƒ¨ï¼Œå°†éå†ä¸€ä¸ª <code>converterFactories</code> åˆ—è¡¨ï¼Œè®©å·¥å‚ä»¬æä¾›ï¼Œå¦‚æœæœ€ç»ˆæ²¡æœ‰å·¥å‚èƒ½ï¼ˆæ ¹æ® <code>returnType</code> å’Œ <code>annotations</code>ï¼‰æä¾›éœ€è¦çš„ <code>ResponseConverter</code>ï¼Œé‚£å°†æŠ›å‡ºå¼‚å¸¸ã€‚è€Œè¿™ä¸ªå·¥å‚åˆ—è¡¨æˆ‘ä»¬å¯ä»¥åœ¨æ„é€  <code>Retrofit</code> å¯¹è±¡æ—¶è¿›è¡Œæ·»åŠ ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä½¿ç”¨<code>Retrofit.Builder</code>æ„é€ Retrofitå¯¹è±¡çš„æ—¶å€™ï¼Œé»˜è®¤æ·»åŠ çš„<code>converterFactory</code>å—ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Retrofit <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add the built-in converter factory first. This prevents overriding its behavior but also</span></span><br><span class="line">      <span class="comment">// ensures correct behavior when using converters that consume all types.</span></span><br><span class="line">      converterFactories.add(<span class="keyword">new</span> BuiltInConverters());		<span class="comment">// é»˜è®¤çš„Converter</span></span><br><span class="line">      converterFactories.addAll(<span class="keyword">this</span>.converterFactories);   <span class="comment">// æˆ‘ä»¬è‡ªå®šä¹‰çš„Converter</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories),</span><br><span class="line">          unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-ResponseConverterçš„convert-æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ"><a href="#2-ResponseConverterçš„convert-æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="#2. ResponseConverterçš„convert()æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ"></a>#2. <code>ResponseConverter</code>çš„<code>convert()</code>æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ</h5><p>æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå†…ç½®è½¬æ¢å™¨ï¼ˆ<code>BuildInConverters</code>ï¼‰æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BuiltInConverters</span> <span class="keyword">extends</span> <span class="title">Converter</span>.<span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Converter&lt;ResponseBody, ?&gt; responseBodyConverter(Type type, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">        <span class="comment">// å†…ç½®çš„BuiltInConvertersç›´æ¥è¿”å›ResponseBodyæˆ–è€…Voidç±»å‹</span></span><br><span class="line">        <span class="keyword">if</span> (type == ResponseBody.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> Utils.isAnnotationPresent(annotations, Streaming.class)</span><br><span class="line">                    ? StreamingResponseBodyConverter.INSTANCE</span><br><span class="line">                    : BufferingResponseBodyConverter.INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type == Void.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> VoidResponseBodyConverter.INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Converter&lt;?, RequestBody&gt; requestBodyConverter(Type type,</span><br><span class="line">                                                          Annotation[] parameterAnnotations, Annotation[] methodAnnotations, Retrofit retrofit) &#123;</span><br><span class="line">        <span class="keyword">if</span> (RequestBody.class.isAssignableFrom(Utils.getRawType(type))) &#123;</span><br><span class="line">            <span class="keyword">return</span> RequestBodyConverter.INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamingResponseBodyConverter</span></span></span><br><span class="line"><span class="class">      <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">ResponseBody</span>, <span class="title">ResponseBody</span>&gt; </span>&#123;</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> StreamingResponseBodyConverter INSTANCE = <span class="keyword">new</span> StreamingResponseBodyConverter();</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> ResponseBody <span class="title">convert</span><span class="params">(ResponseBody value)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œä»»ä½•å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†…ç½®çš„<code>BuiltInConverters</code>ä¼šç›´æ¥è¿”å›<code>ResponseBody</code>æˆ–è€…<code>Void</code>ç±»å‹ï¼Œä¸åšå…¶ä»–ä»»ä½•çš„è½¬æ¢æ“ä½œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æ·»åŠ ä»»ä½•ConverterFactoryçš„é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®šä¹‰çš„æ¥å£æ–¹æ³•è¿”å›ç±»å‹åªèƒ½æ¥å—<code>ResponseBody</code>æˆ–è€…<code>Void</code>è¿™ä¸¤ç§ç±»å‹ã€‚</p>
<h4 id="é»˜è®¤çš„CallAdapter"><a href="#é»˜è®¤çš„CallAdapter" class="headerlink" title="é»˜è®¤çš„CallAdapter"></a>é»˜è®¤çš„CallAdapter</h4><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é‚£ä¸‰å¥é‡è¦ä»£ç ä¸­çš„æœ€åä¸€å¥<code>return serviceMethod.adapt(okHttpCall);</code>ã€‚ServiceMethodç±»ä¸­çš„<code>adapt()</code>æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServiceMethodç±»ä¸­</span></span><br><span class="line"><span class="function">T <span class="title">adapt</span><span class="params">(Call&lt;R&gt; call)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> callAdapter.adapt(call);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬åˆ†åˆ«çœ‹ä¸‹ï¼š</p>
<ol>
<li>è¿™ä¸ª<code>callAdapter</code>å®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ</li>
<li><code>CallAdapter</code>ç±»çš„<code>adapt()</code>æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ</li>
</ol>
<h5 id="1-è¿™ä¸ªcallAdapterå®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ"><a href="#1-è¿™ä¸ªcallAdapterå®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ" class="headerlink" title="#1. è¿™ä¸ªcallAdapterå®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ"></a>#1. è¿™ä¸ª<code>callAdapter</code>å®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ</h5><p>è¿™ä¸ª<code>callAdapter</code>å®ä¾‹æ˜¯åœ¨å“ªé‡Œèµ‹å€¼çš„å‘¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†<code>ServiceMethod.Builder</code>çš„<code>build()</code>æ–¹æ³•ï¼Œå¯ä»¥å›åˆ°ä¸Šé¢çœ‹çœ‹è¿™ä¸ªæ–¹æ³•çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯è°ƒç”¨äº†<code>createCallAdapter</code>è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„ï¼Œå¦‚ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServiceMethod.Builderç±»ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> CallAdapter&lt;T, R&gt; <span class="title">createCallAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Type returnType = method.getGenericReturnType();</span><br><span class="line">    <span class="keyword">if</span> (Utils.hasUnresolvableType(returnType)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> methodError(</span><br><span class="line">                <span class="string">"Method return type must not include a type variable or wildcard: %s"</span>, returnType);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¥å£æ–¹æ³•è¿”å›çš„ç±»å‹ä¸èƒ½æ˜¯void</span></span><br><span class="line">    <span class="keyword">if</span> (returnType == <span class="keyword">void</span>.class) &#123;</span><br><span class="line">        <span class="keyword">throw</span> methodError(<span class="string">"Service methods cannot return void."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Annotation[] annotations = method.getAnnotations();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//noinspection unchecked</span></span><br><span class="line">        <span class="keyword">return</span> (CallAdapter&lt;T, R&gt;) retrofit.callAdapter(returnType, annotations);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123; <span class="comment">// Wide exception range because factories are user code.</span></span><br><span class="line">        <span class="keyword">throw</span> methodError(e, <span class="string">"Unable to create call adapter for %s"</span>, returnType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>callAdapter</code> è¿˜æ˜¯ç”± <code>Retrofit</code> ç±»æä¾›çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> CallAdapter&lt;?, ?&gt; callAdapter(Type returnType, Annotation[] annotations) &#123;</span><br><span class="line">    <span class="keyword">return</span> nextCallAdapter(<span class="keyword">null</span>, returnType, annotations);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> CallAdapter&lt;?, ?&gt; nextCallAdapter(<span class="meta">@Nullable</span> CallAdapter.Factory skipPast, Type returnType,</span><br><span class="line">                                         Annotation[] annotations) &#123;</span><br><span class="line">    checkNotNull(returnType, <span class="string">"returnType == null"</span>);</span><br><span class="line">    checkNotNull(annotations, <span class="string">"annotations == null"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®æ¥å£æ–¹æ³•çš„è¿”å›ç±»å‹ã€æ³¨è§£ç­‰ä¿¡æ¯æ‰¾åˆ°å¯¹åº”çš„CallAdapter</span></span><br><span class="line">    <span class="keyword">int</span> start = callAdapterFactories.indexOf(skipPast) + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = callAdapterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">        CallAdapter&lt;?, ?&gt; adapter = callAdapterFactories.get(i).get(returnType, annotations, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (adapter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> adapter;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰¾ä¸åˆ°ä»»ä½•CallAdapterï¼ŒæŠ›å¼‚å¸¸</span></span><br><span class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"Could not locate call adapter for "</span>)</span><br><span class="line">            .append(returnType)</span><br><span class="line">            .append(<span class="string">".\n"</span>);</span><br><span class="line">    <span class="keyword">if</span> (skipPast != <span class="keyword">null</span>) &#123;</span><br><span class="line">        builder.append(<span class="string">"  Skipped:"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; start; i++) &#123;</span><br><span class="line">            builder.append(<span class="string">"\n   * "</span>).append(callAdapterFactories.get(i).getClass().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        builder.append(<span class="string">'\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    builder.append(<span class="string">"  Tried:"</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = start, count = callAdapterFactories.size(); i &lt; count; i++) &#123;</span><br><span class="line">        builder.append(<span class="string">"\n   * "</span>).append(callAdapterFactories.get(i).getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(builder.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>Retrofit</code> ç±»å†…éƒ¨ï¼Œå°†éå†ä¸€ä¸ª <code>CallAdapter.Factory</code> åˆ—è¡¨ï¼Œè®©å·¥å‚ä»¬æä¾›ï¼Œå¦‚æœæœ€ç»ˆæ²¡æœ‰å·¥å‚èƒ½ï¼ˆæ ¹æ® <code>returnType</code> å’Œ <code>annotations</code>ï¼‰æä¾›éœ€è¦çš„ <code>CallAdapter</code>ï¼Œé‚£å°†æŠ›å‡ºå¼‚å¸¸ã€‚è€Œè¿™ä¸ªå·¥å‚åˆ—è¡¨æˆ‘ä»¬å¯ä»¥åœ¨æ„é€  <code>Retrofit</code> å¯¹è±¡æ—¶è¿›è¡Œæ·»åŠ ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä½¿ç”¨<code>Retrofit.Builder</code>æ„é€ Retrofitå¯¹è±¡çš„æ—¶å€™ï¼Œé»˜è®¤æ·»åŠ çš„<code>CallAdapterFactory</code>å—ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Retrofit.Builderç±»</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Retrofit <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Make a defensive copy of the adapters and add the default Call adapter.</span></span><br><span class="line">      List&lt;CallAdapter.Factory&gt; callAdapterFactories = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="keyword">this</span>.callAdapterFactories);</span><br><span class="line">      <span class="comment">// æ·»åŠ é»˜è®¤çš„CallAdapterFactory</span></span><br><span class="line">      callAdapterFactories.add(platform.defaultCallAdapterFactory(callbackExecutor));</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">      <span class="comment">//...çœç•¥å…¶ä»–ä»£ç ...</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories),</span><br><span class="line">          unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œæ­¤æ—¶çš„Platformæ˜¯<code>Android</code>ï¼Œå›é¡¾ä¸€ä¸‹Androidçš„é»˜è®¤CallAdapterFactoryï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Android</span> <span class="keyword">extends</span> <span class="title">Platform</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">defaultCallbackExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MainThreadExecutor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°äº†é»˜è®¤çš„CallAdapterFactory</span></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    CallAdapter.<span class="function">Factory <span class="title">defaultCallAdapterFactory</span><span class="params">(@Nullable Executor callbackExecutor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (callbackExecutor == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ExecutorCallAdapterFactory(callbackExecutor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MainThreadExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> Handler handler = <span class="keyword">new</span> Handler(Looper.getMainLooper());</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        handler.post(r);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°é»˜è®¤çš„æ˜¯<code>ExecutorCallAdapterFactory</code>è¿™ä¸ªå·¥å‚ç±»ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorCallAdapterFactory</span> <span class="keyword">extends</span> <span class="title">CallAdapter</span>.<span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Executor callbackExecutor;</span><br><span class="line"></span><br><span class="line">    ExecutorCallAdapterFactory(Executor callbackExecutor) &#123;</span><br><span class="line">        <span class="keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³æ³¨ä¸€ä¸‹è¿™ä¸ªget()æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CallAdapter&lt;?, ?&gt; get(Type returnType, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">        <span class="keyword">if</span> (getRawType(returnType) != Call.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> Type responseType = Utils.getCallResponseType(returnType);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CallAdapter&lt;Object, Call&lt;?&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Type <span class="title">responseType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> responseType;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Call&lt;Object&gt; <span class="title">adapt</span><span class="params">(Call&lt;Object&gt; call)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ExecutorCallbackCall&lt;&gt;(callbackExecutor, call);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>ExecutorCallAdapterFactory</code>è¿™ä¸ªå·¥å‚ç±»é€šè¿‡<code>get()</code>æ–¹æ³•newäº†ä¸€ä¸ª<code>CallAdapter</code>ã€‚ç„¶åæ¥çœ‹çœ‹ç¬¬äºŒä¸ªé—®é¢˜ã€‚</p>
<h5 id="2-CallAdapterç±»çš„adapt-æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ"><a href="#2-CallAdapterç±»çš„adapt-æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="#2. CallAdapterç±»çš„adapt()æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ"></a>#2. <code>CallAdapter</code>ç±»çš„<code>adapt()</code>æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ</h5><p>å¥½äº†ï¼Œææ¸…æ¥šäº†<code>callAdapter</code>çš„æ¥å†ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒçš„<code>adapt()</code>æ–¹æ³•ã€‚ä»ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼Œè¿™ä¸ª<code>CallAdapter</code>ç±»çš„<code>adapt()</code>æ–¹æ³•è¿”å›äº†ä¸€ä¸ª<code>ExecutorCallbackCall</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorCallbackCall</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Call</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Executor callbackExecutor;</span><br><span class="line">    <span class="keyword">final</span> Call&lt;T&gt; delegate;  <span class="comment">// delegate å°±æ˜¯æ„é€ å™¨ä¸­ä¼ è¿›æ¥çš„ OkHttpCall</span></span><br><span class="line"></span><br><span class="line">    ExecutorCallbackCall(Executor callbackExecutor, Call&lt;T&gt; delegate) &#123;</span><br><span class="line">        <span class="keyword">this</span>.callbackExecutor = callbackExecutor;</span><br><span class="line">        <span class="keyword">this</span>.delegate = delegate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(<span class="keyword">final</span> Callback&lt;T&gt; callback)</span> </span>&#123;</span><br><span class="line">        checkNotNull(callback, <span class="string">"callback == null"</span>);</span><br><span class="line"></span><br><span class="line">        delegate.enqueue(<span class="keyword">new</span> Callback&lt;T&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span> </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call&lt;T&gt; call, <span class="keyword">final</span> Response&lt;T&gt; response)</span> </span>&#123;</span><br><span class="line">                callbackExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span> </span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">if</span> (delegate.isCanceled()) &#123;</span><br><span class="line">                            <span class="comment">// Emulate OkHttp's behavior of throwing/delivering an IOException on cancellation.</span></span><br><span class="line">                            callback.onFailure(ExecutorCallbackCall.<span class="keyword">this</span>, <span class="keyword">new</span> IOException(<span class="string">"Canceled"</span>));</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            callback.onResponse(ExecutorCallbackCall.<span class="keyword">this</span>, response);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call&lt;T&gt; call, <span class="keyword">final</span> Throwable t)</span> </span>&#123;</span><br><span class="line">                callbackExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                    <span class="meta">@Override</span> </span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        callback.onFailure(ExecutorCallbackCall.<span class="keyword">this</span>, t);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response&lt;T&gt; <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> delegate.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹è§è¿™ä¸ªé»˜è®¤çš„<code>ExecutorCallbackCall</code>ä»…ä»…æ˜¯æŠŠç»“æœå›è°ƒCallBackæ”¾åˆ°äº†å¯¹åº”çš„<code>CallbackExecutor</code>å»æ‰§è¡Œï¼Œå¹¶æ²¡æœ‰å¯¹ç»“æœè¿›è¡Œä»»ä½•åŠ å·¥ã€‚</p>
<h3 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h3><p>ä¸€èˆ¬å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚APIï¼Œæ€»å…±åˆ†ä¸‰æ­¥ï¼š</p>
<ol>
<li>build request(APIå‚æ•°é…ç½®)</li>
<li>executor(è¿™é‡Œå¯ä»¥æœ‰å¾ˆå¤šå˜ä½“ï¼Œæ¯”å¦‚æœ‰æ— é˜Ÿåˆ—ï¼Œè¿›å‡ºé¡ºåºï¼Œçº¿ç¨‹ç®¡ç†)</li>
<li>parse callback(è§£ææ•°æ®ï¼Œè¿”å›Tç»™ä¸Šå±‚)</li>
</ol>
<p>å¦‚ä»Šçš„retrofitä¹Ÿæ˜¯æ¢æ±¤ä¸æ¢è¯çš„ã€‚ä¹Ÿæ˜¯è¿™ä¸‰æ­¥ï¼š</p>
<ol>
<li>é€šè¿‡å®šä¹‰interfaceå’Œä½¿ç”¨æ³¨è§£æ¥é…ç½®APIå‚æ•°</li>
<li><code>CallAdapter</code>(ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆexecutor)</li>
<li><code>Converter</code>(è§£ææ•°æ®å¹¶è½¬æ¢æˆT)</li>
</ol>
<p><img src="/gallery/android_common/625299-29a632638d9f518f.png" alt=""></p>
<p>Retrofité‡‡ç”¨äº†<strong>å¤–è§‚æ¨¡å¼</strong>ç»Ÿä¸€è°ƒç”¨åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹å’Œç½‘ç»œè¯·æ±‚å‚æ•°é…ç½®çš„æ–¹æ³•ï¼Œå…·ä½“ç»†èŠ‚æ˜¯ï¼š</p>
<ul>
<li>åŠ¨æ€åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£çš„å®ä¾‹<strong>ï¼ˆä»£ç†æ¨¡å¼ - åŠ¨æ€ä»£ç†ï¼‰</strong></li>
<li>åˆ›å»º <code>serviceMethod</code> å¯¹è±¡<strong>ï¼ˆå»ºé€ è€…æ¨¡å¼ &amp; å•ä¾‹æ¨¡å¼ï¼ˆç¼“å­˜æœºåˆ¶ï¼‰ï¼‰</strong></li>
<li>å¯¹ <code>serviceMethod</code> å¯¹è±¡è¿›è¡Œç½‘ç»œè¯·æ±‚å‚æ•°é…ç½®ï¼šé€šè¿‡è§£æç½‘ç»œè¯·æ±‚æ¥å£æ–¹æ³•çš„å‚æ•°ã€è¿”å›å€¼å’Œæ³¨è§£ç±»å‹ï¼Œä»Retrofitå¯¹è±¡ä¸­è·å–å¯¹åº”çš„ç½‘ç»œè¯·æ±‚çš„urlåœ°å€ã€ç½‘ç»œè¯·æ±‚æ‰§è¡Œå™¨ã€ç½‘ç»œè¯·æ±‚é€‚é…å™¨ &amp; æ•°æ®è½¬æ¢å™¨ã€‚<strong>ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰</strong></li>
<li>å¯¹ <code>serviceMethod</code> å¯¹è±¡åŠ å…¥çº¿ç¨‹åˆ‡æ¢çš„æ“ä½œï¼Œä¾¿äºæ¥æ”¶æ•°æ®åé€šè¿‡Handlerä»å­çº¿ç¨‹åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ä»è€Œå¯¹è¿”å›æ•°æ®ç»“æœè¿›è¡Œå¤„ç†<strong>ï¼ˆè£…é¥°æ¨¡å¼ï¼‰</strong></li>
<li>æœ€ç»ˆåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª<code>OkHttpCall</code>ç±»å‹çš„ç½‘ç»œè¯·æ±‚å¯¹è±¡</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul>
<li><a href="https://gist.github.com/hachy/82d0f7f1a93d80b12fd8" target="_blank" rel="noopener">Retrofit - Sample</a></li>
<li><a href="https://blog.piasy.com/2016/06/25/Understand-Retrofit/" target="_blank" rel="noopener">æ‹†è½®å­ç³»åˆ—ï¼šæ‹† Retrofit</a></li>
<li><a href="http://wensibo.top/2017/09/05/retrofit/" target="_blank" rel="noopener">Retrofit2.0æºç è§£æ</a></li>
<li><a href="https://www.jianshu.com/p/45cb536be2f4" target="_blank" rel="noopener">Retrofitåˆ†æ-æ¼‚äº®çš„è§£è€¦å¥—è·¯</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/21662195" target="_blank" rel="noopener">ã€ŒAndroidæŠ€æœ¯æ±‡ã€Retrofit2 æºç è§£æå’Œæ¡ˆä¾‹è¯´æ˜</a></li>
<li><a href="https://segmentfault.com/a/1190000005638577" target="_blank" rel="noopener">æ·±å…¥æµ…å‡º Retrofitï¼Œè¿™ä¹ˆç‰›é€¼çš„æ¡†æ¶ä½ ä»¬è¿˜ä¸æ¥çœ‹çœ‹ï¼Ÿ</a></li>
<li><a href="https://www.jianshu.com/p/308f3c54abdd" target="_blank" rel="noopener">ä½ çœŸçš„ä¼šç”¨Retrofit2å—?Retrofit2å®Œå…¨æ•™ç¨‹</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="../../../../js/vdonate.js"></script>
<script>
var a = new Donate({
  title: 'å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæ ‡é¢˜
  btnText: 'æ‰“èµæ”¯æŒ', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæŒ‰é’®æ–‡å­—
  el: document.getElementById('donation_div'),
  wechatImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/WeChanQR.png',
  alipayImage: 'https://raw.githubusercontent.com/iTimeTraveler/iTimeTraveler.github.io/site/source/about/donate/images/AliPayQR.jpg'
});
</script>
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>æœ¬æ–‡ä½œè€…:  </strong>Mr.Seven</a>
          </li>
          <li class="post-copyright-link">
          <strong>æœ¬æ–‡é“¾æ¥:  </strong>
          <a href="/2018/04/10/ã€Androidã€‘Retrofitæºç åˆ†æ/" target="_blank" title="ã€Androidã€‘Retrofitæºç åˆ†æ">http://github.com/2018/04/10/ã€Androidã€‘Retrofitæºç åˆ†æ/</a>
          </li>
          <li class="post-copyright-license">
            <strong>ç‰ˆæƒå£°æ˜:   </strong>
            æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„
          </li>
         
        </ul>
<div>

      
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>



      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/æºç åˆ†æ/">æºç åˆ†æ</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../../05/04/ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          ã€Javaã€‘Threadç±»ä¸­çš„join()æ–¹æ³•åŸç†
        
      </div>
    </a>
  
  
    <a href="../../06/ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">ã€Androidã€‘Appåº”ç”¨å‰åå°åˆ‡æ¢çš„ä¸€ç§ç›‘å¬æ–¹æ³•</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
    
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Retrofitç®€ä»‹"><span class="nav-number">1.</span> <span class="nav-text">Retrofitç®€ä»‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä½¿ç”¨æ­¥éª¤"><span class="nav-number">2.</span> <span class="nav-text">ä½¿ç”¨æ­¥éª¤</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-å®šä¹‰Interface"><span class="nav-number">2.1.</span> <span class="nav-text">1. å®šä¹‰Interface</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-åˆ›å»ºRetrofitå®ä¾‹"><span class="nav-number">2.2.</span> <span class="nav-text">2. åˆ›å»ºRetrofitå®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-å‘èµ·è¯·æ±‚"><span class="nav-number">2.3.</span> <span class="nav-text">3. å‘èµ·è¯·æ±‚</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æºç åˆ†æ"><span class="nav-number">3.</span> <span class="nav-text">æºç åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Retrofit-Builder"><span class="nav-number">3.1.</span> <span class="nav-text">Retrofit.Builder</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CallAdapterå’ŒConverteråˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ"><span class="nav-number">3.2.</span> <span class="nav-text">CallAdapterå’ŒConverteråˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Retrofitæä¾›çš„CallAdapterï¼š"><span class="nav-number">3.2.1.</span> <span class="nav-text">Retrofitæä¾›çš„CallAdapterï¼š</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Retrofitæä¾›çš„Converter"><span class="nav-number">3.2.2.</span> <span class="nav-text">Retrofitæä¾›çš„Converter</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Platform"><span class="nav-number">3.3.</span> <span class="nav-text">Platform</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Retrofit"><span class="nav-number">3.4.</span> <span class="nav-text">Retrofit</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ServiceMethod"><span class="nav-number">3.5.</span> <span class="nav-text">ServiceMethod</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OkHttpCall"><span class="nav-number">3.6.</span> <span class="nav-text">OkHttpCall</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é»˜è®¤çš„Converter"><span class="nav-number">3.7.</span> <span class="nav-text">é»˜è®¤çš„Converter</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-responseConverterè¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ"><span class="nav-number">3.7.1.</span> <span class="nav-text">#1. responseConverterè¿™ä¸ªå®ä¾‹å“ªé‡Œæ¥ï¼Ÿ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-ResponseConverterçš„convert-æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ"><span class="nav-number">3.7.2.</span> <span class="nav-text">#2. ResponseConverterçš„convert()æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é»˜è®¤çš„CallAdapter"><span class="nav-number">3.8.</span> <span class="nav-text">é»˜è®¤çš„CallAdapter</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-è¿™ä¸ªcallAdapterå®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ"><span class="nav-number">3.8.1.</span> <span class="nav-text">#1. è¿™ä¸ªcallAdapterå®ä¾‹å“ªé‡Œæ¥çš„ï¼Ÿ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-CallAdapterç±»çš„adapt-æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ"><span class="nav-number">3.8.2.</span> <span class="nav-text">#2. CallAdapterç±»çš„adapt()æ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾è®¡æ¨¡å¼"><span class="nav-number">4.</span> <span class="nav-text">è®¾è®¡æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚è€ƒèµ„æ–™"><span class="nav-number">5.</span> <span class="nav-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2019 iTimeTraveler All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				è®¿å®¢æ•° : <span id="busuanzi_value_site_uv"></span> |  
				è®¿é—®é‡ : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="../../../../funnysite" class="mobile-nav-link">é…·ç«™</a>
  
    <a href="../../../../collection" class="mobile-nav-link">æ”¶è—</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
    <a href="../../../../mybooks" class="mobile-nav-link">ğŸ</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/scripts.js"></script>




  <script src="../../../../js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            iTimeTraveler
          </div>
          <div class="panel-body">
            Copyright Â© 2019 Mr.Seven All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>